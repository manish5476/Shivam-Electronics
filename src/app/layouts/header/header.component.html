<div class="w-full mx-auto flex h-12 items-center justify-between px-4 sm:px-6 lg:px-8">
  <div class="flex items-center gap-4">
    <button type="button"
      class="flex items-center justify-center w-10 h-10 rounded-lg bg-[var(--theme-bg-secondary)] hover:bg-[var(--theme-hover-bg)] transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[var(--theme-accent-primary)] focus:ring-opacity-75"
      (click)="toggleSidebar.emit()">
      <i class="pi pi-bars text-[var(--theme-text-secondary)] text-xl"></i>
    </button>
    <a href="/" class="text-[var(--theme-text-primary)] text-xl font-bold tracking-tight">Shivam Electronics</a>
  </div>

  <div class="flex items-center gap-4">
    <!-- Main user display area -->
    <ng-container *ngIf="currentUser$ | async as user; else loggedOutView">
      <button type="button"
        class="flex h-10 items-center gap-3 group focus:outline-none focus:ring-2 focus:ring-[var(--theme-accent-primary)] focus:ring-opacity-75 rounded-full p-1 pr-3 hover:bg-[var(--theme-hover-bg)]"
        (click)="op.toggle($event)">
        <p-avatar [label]="user.name ? getInitials(user.name) : 'U'" styleClass="mr-2" shape="circle"></p-avatar>
        <span class="hidden md:inline-block font-medium text-sm">{{ user.name }}</span>
        <i
          class="hidden md:inline-block pi pi-angle-down text-[var(--theme-text-secondary)] group-hover:text-[var(--theme-text-primary)] transition-colors duration-200"></i>
      </button>

      <!-- Popover content with theme controls -->
      <p-popover #op>
        <div
          class="p-4 bg-[var(--theme-bg-secondary)] border border-[var(--theme-border-primary)] rounded-lg shadow-xl min-w-[250px]">
          <!-- User Info Section -->
          <div class="flex items-center gap-3 pb-3 mb-3 border-b border-[var(--theme-border-primary)]">
            <p-avatar [label]="user.name ? getInitials(user.name) : 'U'" shape="circle" size="large"></p-avatar>
            <div class="text-left">
              <div class="font-bold text-base text-[var(--theme-text-primary)]">{{ user.name }}</div>
              <div class="text-[var(--theme-text-secondary)] text-xs">{{ user.email }}</div>
            </div>
          </div>

          <!-- Theme Customization Section -->
          <div class="py-2">
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm font-medium text-[var(--theme-text-label)]">Appearance</span>
              <p-selectButton [options]="themeOptions" [(ngModel)]="isDarkMode"
                (onChange)="onThemeModeChange($event.value)" optionValue="value">
                <ng-template let-item>
                  <i [class]="item.icon"></i>
                </ng-template>
              </p-selectButton>
            </div>
            <div class="grid grid-cols-6 gap-2 mt-3">
              <div *ngFor="let theme of colorThemes" pTooltip="{{theme.name}}" tooltipPosition="top"
                class="w-8 h-8 rounded-full cursor-pointer border-2 transition-all"
                [style.backgroundColor]="theme.color"
                [ngClass]="{'border-[var(--theme-accent-primary)]': accentColor === theme.color, 'border-transparent': accentColor !== theme.color}"
                (click)="onAccentColorChange(theme.class, theme.color)">
              </div>
            </div>
          </div>

          <!-- Actions Section -->
          <div class="flex flex-col gap-1 pt-2 border-t border-[var(--theme-border-primary)]">
            <a routerLink="/user/profile" (click)="op.hide()"
              class="flex items-center gap-2 py-2 px-3 rounded-md text-[var(--theme-text-secondary)] hover:text-[var(--theme-text-primary)] hover:bg-[var(--theme-hover-bg)] transition-colors duration-200">
              <i class="pi pi-user text-base"></i>
              <span class="text-sm">My Profile</span>
            </a>
            <a (click)="logout(); op.hide()"
              class="flex items-center gap-2 py-2 px-3 rounded-md text-red-500 hover:bg-red-500/10 transition-colors duration-200 cursor-pointer">
              <i class="pi pi-sign-out text-base"></i>
              <span class="text-sm">Logout</span>
            </a>
          </div>
        </div>
      </p-popover>
    </ng-container>

    <ng-template #loggedOutView>
      <a routerLink="/auth/login"
        class="flex items-center gap-2 py-2 px-3 rounded-md text-[var(--theme-text-secondary)] hover:text-[var(--theme-text-primary)] hover:bg-[var(--theme-hover-bg)] transition-colors duration-200">
        <i class="pi pi-sign-in text-base"></i>
        <span class="font-medium">Login</span>
      </a>
    </ng-template>

    <button type="button"
      class="md:hidden w-10 h-10 rounded-full bg-[var(--theme-bg-secondary)] hover:bg-[var(--theme-hover-bg)] flex items-center justify-center"
      (click)="mobileMenuToggle.emit()">
      <i class="pi pi-bars text-[var(--theme-text-secondary)] text-xl"></i>
    </button>
  </div>
</div>

<!-- 
<div class="w-full mx-auto flex h-12 items-center justify-between px-3 sm:px-4 lg:px-6">
  <div class="flex items-center gap-4">
    <button type="button"
      class="flex items-center justify-center w-10 h-8 rounded-lg bg-[var(--theme-bg-primary)] hover:bg-[var(--theme-hover-bg)] transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[var(--theme-accent-primary)] focus:ring-opacity-75"
      (click)="toggleSidebar.emit()">
      <i class="pi pi-bars text-[var(--theme-bg-primary)] text-xl"></i>
    </button>
    <a href="/" class="text-[var(--theme-accent-primary)] text-2xl font-bold tracking-tight">Shivam Electronics</a>
  </div>

  <div class="flex items-center gap-4">
    <ng-container *ngIf="currentUser$ | async as user; else loggedOutView">
      <button type="button"
        class="flex h-9 items-center gap-2 group focus:outline-none focus:ring-2 focus:ring-[var(--theme-accent-primary)] focus:ring-opacity-75 rounded-full"
        (click)="op.toggle($event)">
        <p-avatar [label]="user.name ? user.name.charAt(0).toUpperCase() : 'U'" styleClass="mr-2" 
          shape="circle"></p-avatar>
        <span class="hidden md:inline-block">Welcome, {{ user.name }}</span>
        <i
          class="hidden md:inline-block pi pi-angle-down text-[var(--theme-text-secondary)] group-hover:text-[var(--theme-accent-primary)] transition-colors duration-200"></i>
      </button>

      <p-popover #op>
        <div
          class="p-4 bg-[var(--theme-bg-secondary)] border border-[var(--theme-border-primary)] rounded-lg shadow-xl min-w-[200px]">
          <div class="flex flex-col items-center gap-3 pb-3 mb-3 border-b border-[var(--theme-border-primary)]">
            <p-avatar [image]="'https://primefaces.org/cdn/primeng/images/demo/avatar/amyelsner.png'"
              shape="circle" class="w-12 h-12 border-2 border-[var(--theme-accent-primary)]"></p-avatar>
            <div class="text-center">
              <div class="font-bold text-lg text-[var(--theme-text-primary)]">{{ user.name }}</div>
              <div class="text-[var(--theme-text-secondary)] text-sm">{{ user.email }}</div>
              <div class="text-[var(--theme-accent-primary)] text-xs font-semibold uppercase tracking-wide mt-1">{{
                user.role }}</div>
            </div>
          </div>
          <div class="flex flex-col gap-2">
            <a routerLink="/user/profile" (click)="op.hide()"
              class="flex items-center gap-2 py-2 px-3 rounded-md text-[var(--theme-text-secondary)] hover:text-[var(--theme-accent-primary)] hover:bg-[var(--theme-hover-bg)] transition-colors duration-200">
              <i class="pi pi-user text-base"></i>
              <span>My Profile</span>
            </a>
            <a routerLink="/user/settings" (click)="op.hide()"
              class="flex items-center gap-2 py-2 px-3 rounded-md text-[var(--theme-text-secondary)] hover:text-[var(--theme-accent-primary)] hover:bg-[var(--theme-hover-bg)] transition-colors duration-200">
              <i class="pi pi-cog text-base"></i>
              <span>Settings</span>
            </a>
            <a (click)="logout(); op.hide()"
              class="flex items-center gap-2 py-2 px-3 rounded-md text-red-500 hover:bg-red-100 hover:text-red-700 transition-colors duration-200 mt-2 cursor-pointer">
              <i class="pi pi-sign-out text-base"></i>
              <span>Logout</span>
            </a>
          </div>
        </div>
      </p-popover>
    </ng-container>

    <ng-template #loggedOutView>
      <a routerLink="/auth/login"
        class="flex items-center gap-2 py-2 px-3 rounded-md text-[var(--theme-text-secondary)] hover:text-[var(--theme-accent-primary)] hover:bg-[var(--theme-hover-bg)] transition-colors duration-200">
        <i class="pi pi-sign-in text-base"></i>
        <span>Login</span>
      </a>
    </ng-template>

    <button type="button"
      class="md:hidden w-10 h-10 rounded-full bg-[var(--theme-bg-tertiary)] hover:bg-[var(--theme-hover-bg)] flex items-center justify-center transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[var(--theme-accent-primary)] focus:ring-opacity-75"
      (click)="mobileMenuToggle.emit()">
      <i class="pi pi-bars text-[var(--theme-accent-primary)] text-xl"></i>
    </button>
  </div>
</div> -->