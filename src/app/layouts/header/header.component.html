<div
  class="w-full mx-auto flex h-10 items-center justify-between px-4 sm:px-6 lg:px-8 border-b border-[var(--theme-border-primary)]">
  <div class="flex items-center gap-3">
    <button type="button"
      class="flex items-center justify-center w-8 h-8 rounded-lg bg-[var(--theme-bg-secondary)] hover:bg-[var(--theme-hover-bg)] transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[var(--theme-accent-primary)] focus:ring-opacity-75"
      (click)="toggleSidebar.emit()">
      <i class="pi pi-bars text-[var(--theme-text-secondary)] text-lg"></i>
    </button>
    <a href="/" class="text-[var(--theme-text-primary)] text-lg font-bold tracking-tight">Shivam Electronics</a>
  </div>

  <div class="flex items-center gap-3">
    <!-- Main user display area -->
    <ng-container *ngIf="currentUser$ | async as user; else loggedOutView">
      <button type="button"
        class="flex h-8 items-center bg-[var(--theme-bg-ternary)] gap-2 group focus:outline-none focus:ring-2 focus:ring-[var(--theme-accent-primary)] focus:ring-opacity-75 rounded-full p-1 pr-3 hover:bg-[var(--theme-hover-bg)]"
        (click)="op.toggle($event)">
        <p-avatar [label]="user.name ? getInitials(user.name) : 'U'"
          image="https://imgs.search.brave.com/E0qQWdzT8_8gkjaYBKZjg8zeuJWOxsPwlim2wn2WvW4/rs:fit:500:0:1:0/g:ce/aHR0cHM6Ly9pbWcu/ZnJlZXBpay5jb20v/cHJlbWl1bS1waG90/by9jdXRlLWxpdHRs/ZS1sb3JkLWtyaXNo/bmFfMzk0NDYyLTI5/MzYuanBnP3NlbXQ9/YWlzX2h5YnJpZCZ3/PTc0MCZxPTgw"
          styleClass="w-6 h-6 text-xs" shape="circle"></p-avatar>
        <span class="hidden md:inline-block font-medium text-sm bg-[var(--theme-bg-ternary)]">{{ user.name }}</span>
        <i
          class="hidden md:inline-block pi pi-angle-down text-xs text-[var(--theme-text-secondary)] group-hover:text-[var(--theme-text-primary)] transition-colors duration-200"></i>
      </button>

      <!-- Popover content with theme controls -->
      <p-popover #op appendTo="body" [showTransitionOptions]="'150ms ease-out'"
        [hideTransitionOptions]="'150ms ease-in'">
        <div
          class="p-4 bg-[var(--theme-bg-ternary)] border border-[var(--theme-border-primary)] rounded-lg shadow-xl min-w-[250px]">
          <!-- User Info Section -->
          <div class="flex items-center gap-3 pb-3 mb-3 border-b border-[var(--theme-border-primary)]">
            <p-avatar [label]="user.name ? getInitials(user.name) : 'U'" shape="circle" size="large"></p-avatar>
            <div class="text-left">
              <div class="font-bold text-base text-[var(--theme-text-primary)]">{{ user.name }}</div>
              <div class="text-[var(--theme-text-secondary)] text-xs">{{ user.email }}</div>
            </div>
          </div>

          <!-- Theme Customization Section -->
          <div class="py-2">
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm font-medium text-[var(--theme-text-label)]">Appearance</span>
              <p-toggleButton [(ngModel)]="isDarkMode" onLabel="" offLabel="" [onIcon]="'pi pi-moon'"
                offIcon="pi pi-sun" (onChange)="onThemeModeChange(isDarkMode)" styleClass="theme-toggle-btn">
              </p-toggleButton>
            </div>
            <div class="grid grid-cols-6 gap-2 mt-3">
              <div *ngFor="let theme of colorThemes" pTooltip="{{theme.name}}" tooltipPosition="top"
                class="w-6 h-6 rounded-full cursor-pointer border-2 transition-all"
                [style.backgroundColor]="theme.color"
                [ngClass]="{'border-[var(--theme-accent-primary)]': accentColor === theme.color, 'border-transparent': accentColor !== theme.color}"
                (click)="onAccentColorChange(theme.class, theme.color)">
              </div>
            </div>
          </div>

          <!-- Actions Section -->
          <div class="flex flex-col gap-1 pt-2 border-t border-[var(--theme-border-primary)]">
            <a routerLink="/admin/profile" (click)="op.hide()"
              class="flex items-center gap-2 py-2 px-3 rounded-md text-[var(--theme-text-secondary)] hover:text-[var(--theme-text-primary)] hover:bg-[var(--theme-hover-bg)] transition-colors duration-200">
              <i class="pi pi-user text-base"></i>
              <span class="text-sm">My Profile</span>
            </a>
            <a (click)="logout(); op.hide()"
              class="flex items-center gap-2 py-2 px-3 rounded-md text-red-500 hover:bg-red-500/10 transition-colors duration-200 cursor-pointer">
              <i class="pi pi-sign-out text-base"></i>
              <span class="text-sm">Logout</span>
            </a>

            <a routerLink="/auth/update-password"
              class="flex items-center gap-2 py-2 px-3 rounded-md text-red-500 hover:bg-red-500/10 transition-colors duration-200 cursor-pointer">
              <i class="pi pi-sign-out text-base"></i>
              <span class="text-sm">Update Passoword </span>
            </a>
          </div>
        </div>
      </p-popover>
    </ng-container>

    <ng-template #loggedOutView>
      <a routerLink="/auth/login"
        class="flex items-center gap-2 py-2 px-3 rounded-md text-[var(--theme-text-secondary)] hover:text-[var(--theme-text-primary)] hover:bg-[var(--theme-hover-bg)] transition-colors duration-200">
        <i class="pi pi-sign-in text-base"></i>
        <span class="font-medium">Login</span>
      </a>
    </ng-template>

    <button type="button"
      class="md:hidden w-8 h-8 rounded-full bg-[var(--theme-bg-secondary)] hover:bg-[var(--theme-hover-bg)] flex items-center justify-center"
      (click)="mobileMenuToggle.emit()">
      <i class="pi pi-bars text-[var(--theme-text-secondary)] text-lg"></i>
    </button>
  </div>
</div>