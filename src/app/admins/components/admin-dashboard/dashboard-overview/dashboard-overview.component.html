<div *ngIf="data; else noDataOrLoading">
  <!-- KPI Row (unchanged) -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2 md:gap-4 mb-4">
    <div class="se-kpi-card">
      <div class="kpi-icon-wrapper bg-[var(--theme-success-light)]">
        <i class="pi pi-dollar text-[var(--theme-success-primary)]"></i>
      </div>
      <div class="kpi-content">
        <h3 class="kpi-title">Total Revenue</h3>
        <p class="kpi-value">{{ data.totalRevenue | currency:'INR':'symbol':'1.0-0' }}</p>
      </div>
    </div>

    <div class="se-kpi-card">
      <div class="kpi-icon-wrapper bg-[var(--theme-accent-primary-light)]">
        <i class="pi pi-chart-line text-[var(--theme-accent-primary)]"></i>
      </div>
      <div class="kpi-content">
        <h3 class="kpi-title">Gross Profit</h3>
        <p class="kpi-value">{{ data.grossProfit | currency:'INR':'symbol':'1.0-0' }}</p>
      </div>
    </div>

    <div class="se-kpi-card">
      <div class="kpi-icon-wrapper bg-[var(--theme-info-light)]">
        <i class="pi pi-shopping-cart text-[var(--theme-info-primary)]"></i>
      </div>
      <div class="kpi-content">
        <h3 class="kpi-title">Average Order Value</h3>
        <p class="kpi-value">{{ data.averageOrderValue | currency:'INR':'symbol':'1.0-0' }}</p>
      </div>
    </div>

    <div class="se-kpi-card">
      <div class="kpi-icon-wrapper bg-[var(--theme-warning-light)]">
        <i class="pi pi-users text-[var(--theme-warning-primary)]"></i>
      </div>
      <div class="kpi-content">
        <h3 class="kpi-title">New Customers</h3>
        <p class="kpi-value">{{ data.newCustomers }}</p>
      </div>
    </div>
  </div>

  <!-- Top Selling Products - Refactored to Responsive Card Grid -->
  <h3 class="card-header">Top Selling Products</h3>
  <div class="product-grid">
    <!-- Added safe operator ?. -->
    <div *ngFor="let product of data?.topSellingProducts; " class="product-card">
      <!-- trackBy: trackByProduct -->
      <div class="product-image-wrapper">
        <img [src]="product.thumbnail" [alt]="product.productName" class="product-image" loading="lazy">
        <!-- Optional: Overlay badge for units sold preview -->
        <div class="product-badge">
          <i class="pi pi-shopping-cart mr-1"></i>
          {{ product.totalQuantity }}
        </div>
      </div>
      <div class="product-content">
        <h4 class="product-name">{{ product.productName }}</h4>
        <div class="product-stats">
          <span class="product-units">
            <i class="pi pi-tag mr-1 text-[var(--theme-success-primary)]"></i>
            {{ product.totalQuantity }} Units Sold
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #noDataOrLoading>
  <div class="flex justify-center items-center h-48">
    <p class="text-sm text-[var(--theme-text-secondary)]">
      No overview data available.
    </p>
  </div>
</ng-template>