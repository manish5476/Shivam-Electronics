<p-toast position="top-right"></p-toast>

<div class="admin-dashboard min-h-screen p-4 md:p-6" [style]="{'background': 'var(--theme-bg-primary)'}"
     [@fadeIn]="true">

    <p-toolbar styleClass="sticky top-0 z-20 shadow-md rounded-2xl mb-2 md:mb-4 se-filter-bar"
               [style]="{'background': 'var(--theme-bg-secondary)', 'padding': '0.5rem 1rem'}">
        <div class="p-toolbar-group-left flex items-center">
            <h2 class="text-lg md:text-xl font-bold tracking-tight"
                [style]="{'color': 'var(--theme-text-primary)', 'font-family': 'var(--font-primary)'}">
                Admin Dashboard
            </h2>
        </div>

        <div class="p-toolbar-group-center flex flex-wrap gap-2 items-center justify-center flex-1 px-1 mt-2 md:mt-0">
            <p-select appendTo="body" [options]="periodOptions" [(ngModel)]="selectedPeriod" optionLabel="label" optionValue="value"
                      styleClass="p-inputtext-xs w-full sm:w-40 rounded-full"
                      [style]="{'background': 'var(--theme-bg-ternary)', 'border-color': 'var(--theme-border-secondary)', 'font-family': 'var(--font-body)', 'font-size': '0.875rem'}"
                      (onChange)="onFilterChange()"></p-select>

            <p-select appendTo="body" [options]="limitOptions" [(ngModel)]="dataLimit" optionLabel="label" optionValue="value"
                      styleClass="p-inputtext-xs w-full sm:w-32 rounded-full"
                      [style]="{'background': 'var(--theme-bg-ternary)', 'border-color': 'var(--theme-border-secondary)', 'font-family': 'var(--font-body)', 'font-size': '0.875rem'}"
                      (onChange)="onFilterChange()"></p-select>

            <div *ngIf="selectedPeriod === 'custom'" class="flex gap-2 items-center w-full md:w-auto">
                <p-calendar [(ngModel)]="customDateRange" selectionMode="range" [readonlyInput]="true"
                            placeholder="Select Date Range" dateFormat="dd/mm/yy" styleClass="p-inputtext-xs w-full sm:w-64 rounded-full"
                            [style]="{'background': 'var(--theme-bg-ternary)', 'border-color': 'var(--theme-border-secondary)', 'font-family': 'var(--font-body)', 'font-size': '0.875rem'}"></p-calendar>
                <button pButton type="button" label="Apply" icon="pi pi-check" class="p-button-xs rounded-full"
                        [style]="{'background': 'var(--theme-accent-primary)', 'color': 'var(--theme-accent-text-color)', 'border': 'none', 'padding': '0.25rem 0.75rem'}"
                        (click)="onApplyCustomRange()"></button>
            </div>
            
            </div>

        <div class="p-toolbar-group-right flex gap-1 md:gap-2 mt-2 md:mt-0">
            <button pButton type="button" icon="pi pi-refresh" label="Reload" class="p-button-xs rounded-full"
                    [style]="{'background': 'var(--theme-bg-ternary)', 'color': 'var(--theme-text-primary)', 'border-color': 'var(--theme-border-secondary)', 'font-family': 'var(--font-body)', 'padding': '0.25rem 0.75rem'}"
                    (click)="triggerRefresh()"></button>
        </div>
    </p-toolbar>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6 mb-4">
        <app-notification-calendar></app-notification-calendar> 
        <app-enhanced-kpi-summary [loading]="(isLoading$ | async) ?? false" [title]="'Enhanced KPI Summary'"
                                  [data]="(enhancedKpiSummary$ | async)?.data">
        </app-enhanced-kpi-summary>
        <app-kpi-summary [loading]="(isLoading$ | async) ?? false" [title]="'KPI Summary'"
                         [data]="(kpiSummary$ | async)?.data">
        </app-kpi-summary>
        <app-dashboard-overview [title]="'Overview'" [data]="(overview$ | async)?.data">
        </app-dashboard-overview>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6 mb-6">
        <app-dashboard-chart-combo [selectedPeriod]="selectedPeriod" [startDate]="startDate" [endDate]="endDate"></app-dashboard-chart-combo>
        
        <app-sales-trends [title]="'Sales Trends'"
                          [data]="[(salesTrends$ | async)?.data, (monthlySales$ | async)?.data, (yearlySales$ | async)?.data]">
        </app-sales-trends>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6 mb-6">
        <app-yearly-sales [title]="'Yearly Sales'" [data]="(yearlySales$ | async)?.data">
        </app-yearly-sales>
        
        <app-sales-charts [title]="'Sales Charts'" [data]="(salesCharts$ | async)?.data">
        </app-sales-charts>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 mb-6">
        <app-product-analytics [title]="'Top Categories'" [data]="(productAnalytics$ | async)?.data">
        </app-product-analytics>

        <app-customer-analytics [title]="'Top Customers'" [data]="(customerAnalytics$ | async)?.data"
                                (openDetail)="openDialog('Customer Details', $event)">
        </app-customer-analytics>

        <app-payment-analytics [title]="'Payment Analytics'" [data]="(paymentAnalytics$ | async)?.data"
                               (openDetail)="openDialog('Payment Details', $event)">
        </app-payment-analytics>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6 mb-8">
        <app-sales-forecast [title]="'Sales Forecast'" [data]="(salesForecast$ | async)?.data">
        </app-sales-forecast>

        <app-inventory-turnover [title]="'Inventory Turnover'" [data]="(inventoryTurnover$ | async)?.data">
        </app-inventory-turnover>
    </div>

    <div *ngIf="isLoading$ | async" class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
        <p-skeleton *ngFor="let i of [1,2,3,4]" width="100%" height="8rem md:10rem"
                    styleClass="mb-4 rounded-2xl"></p-skeleton>
        <p-skeleton width="100%" height="16rem md:20rem" styleClass="mb-4 rounded-2xl"></p-skeleton>
        <p-skeleton width="100%" height="16rem md:20rem" styleClass="mb-4 rounded-2xl"></p-skeleton>
    </div>

    <p-dialog header="{{ selectedTitle }}" [(visible)]="showDialog" [modal]="true" styleClass="responsive-dialog">
        <pre class="dialog-content">{{ selectedData | json }}</pre>
    </p-dialog>
</div>

<!-- <p-toast position="top-right"></p-toast>

<div class="admin-dashboard min-h-screen p-4 md:p-6" [style]="{'background': 'var(--theme-bg-primary)'}"
  [@fadeIn]="true">

  <p-toolbar styleClass="sticky top-0 z-20 shadow-md rounded-2xl mb-2 md:mb-4 se-filter-bar"
    [style]="{'background': 'var(--theme-bg-secondary)', 'padding': '0.25rem 0.75rem'}">
    <div class="p-toolbar-group-left flex items-center">
      <h2 class="text-lg md:text-xl font-bold tracking-tight"
        [style]="{'color': 'var(--theme-text-primary)', 'font-family': 'var(--font-primary)'}">
        Admin Dashboard
      </h2>
    </div>

    <div class="p-toolbar-group-center flex flex-wrap gap-1 md:gap-2 items-center justify-center flex-1 px-1">
     <p-select appendTo="body"  [options]="periodOptions" [(ngModel)]="selectedPeriod" optionLabel="label" optionValue="value"
        styleClass="p-inputtext-xs w-32 md:w-40 rounded-full"
        [style]="{'background': 'var(--theme-bg-ternary)', 'border-color': 'var(--theme-border-secondary)', 'font-family': 'var(--font-body)', 'font-size': '0.875rem'}"
        (onChange)="onFilterChange()"></p-select>

     <p-select appendTo="body"  [options]="limitOptions" [(ngModel)]="dataLimit" optionLabel="label" optionValue="value"
        styleClass="p-inputtext-xs w-24 md:w-32 rounded-full"
        [style]="{'background': 'var(--theme-bg-ternary)', 'border-color': 'var(--theme-border-secondary)', 'font-family': 'var(--font-body)', 'font-size': '0.875rem'}"
        (onChange)="onFilterChange()"></p-select>

      <div *ngIf="selectedPeriod === 'custom'" class="flex gap-1 items-center w-full md:w-auto">
        <p-calendar [(ngModel)]="customDateRange" selectionMode="range" [readonlyInput]="true"
          placeholder="Select Date Range" dateFormat="dd/mm/yy" styleClass="p-inputtext-xs w-full md:w-64 rounded-full"
          [style]="{'background': 'var(--theme-bg-ternary)', 'border-color': 'var(--theme-border-secondary)', 'font-family': 'var(--font-body)', 'font-size': '0.875rem'}"></p-calendar>
        <button pButton type="button" label="Apply" icon="pi pi-check" class="p-button-xs rounded-full"
          [style]="{'background': 'var(--theme-accent-primary)', 'color': 'var(--theme-accent-text-color)', 'border': 'none', 'padding': '0.25rem 0.75rem'}"
          (click)="onApplyCustomRange()"></button>
      </div>

      <p-progressSpinner *ngIf="isLoading$ | async" styleClass="w-4 h-4 md:w-5 md:h-5" strokeWidth="4"></p-progressSpinner>
    </div>

    <div class="p-toolbar-group-right flex gap-1 md:gap-2">
      <button pButton type="button" icon="pi pi-refresh" label="Reload" class="p-button-xs rounded-full"
        [style]="{'background': 'var(--theme-bg-ternary)', 'color': 'var(--theme-text-primary)', 'border-color': 'var(--theme-border-secondary)', 'font-family': 'var(--font-body)', 'padding': '0.25rem 0.75rem'}"
        (click)="triggerRefresh()"></button>
    </div>
  </p-toolbar>

  KPI Row (full width stacked)
  <div class="grid grid-cols-1 gap-4 md:gap-6 mb-4">
    <app-notification-calendar></app-notification-calendar>
    
    <app-dashboard-chart-combo [selectedPeriod]="selectedPeriod" [startDate]="startDate" [endDate]="endDate"></app-dashboard-chart-combo>
    <app-enhanced-kpi-summary [loading]="(isLoading$ | async) ?? false" [title]="'Enhanced KPI Summary'"
      [data]="(enhancedKpiSummary$ | async)?.data">
    </app-enhanced-kpi-summary>

    <app-kpi-summary [loading]="(isLoading$ | async) ?? false" [title]="'KPI Summary'"
      [data]="(kpiSummary$ | async)?.data">
    </app-kpi-summary>

    <app-dashboard-overview [title]="'Overview'" [data]="(overview$ | async)?.data">
    </app-dashboard-overview>

     <app-product-analytics [title]="'Product Analytics'" [data]="(productAnalytics$ | async)?.data">
    </app-product-analytics> 
  </div>

  Charts & Tables (full width stacked)
  <div class="grid grid-cols-1 gap-4 md:gap-6 mb-6">


    <app-sales-trends [title]="'Sales Trends'"
      [data]="[(salesTrends$ | async)?.data, (monthlySales$ | async)?.data, (yearlySales$ | async)?.data]">
    </app-sales-trends>


    <app-yearly-sales [title]="'Yearly Sales'" [data]="(yearlySales$ | async)?.data">
    </app-yearly-sales>
    
    <app-sales-charts [title]="'Sales Charts'" [data]="(salesCharts$ | async)?.data">
    </app-sales-charts>

  </div>

  Product, Customers & Payments (full width stacked)
  <div class="grid grid-cols-1 gap-4 md:gap-6 mb-6">
    <app-product-analytics [title]="'Top Categories'" [data]="(productAnalytics$ | async)?.data">
    </app-product-analytics>

    <app-customer-analytics [title]="'Top Customers'" [data]="(customerAnalytics$ | async)?.data"
      (openDetail)="openDialog('Customer Details', $event)">
    </app-customer-analytics>

    <app-payment-analytics [title]="'Payment Analytics'" [data]="(paymentAnalytics$ | async)?.data"
      (openDetail)="openDialog('Payment Details', $event)">
    </app-payment-analytics>
  </div>

  Forecast & Inventory (full width stacked)
  <div class="grid grid-cols-1 gap-4 md:gap-6 mb-8">
    <app-sales-forecast [title]="'Sales Forecast'" [data]="(salesForecast$ | async)?.data">
    </app-sales-forecast>

    <app-inventory-turnover [title]="'Inventory Turnover'" [data]="(inventoryTurnover$ | async)?.data">
    </app-inventory-turnover>
  </div>

  Loading Skeleton (stacked full width)
  <div *ngIf="isLoading$ | async" class="grid grid-cols-1 gap-4 md:gap-6">
    <p-skeleton *ngFor="let i of [1,2,3,4]" width="100%" height="8rem md:10rem"
      styleClass="mb-4 rounded-2xl"></p-skeleton>
    <p-skeleton width="100%" height="16rem md:20rem" styleClass="mb-4 rounded-2xl"></p-skeleton>
    <p-skeleton width="100%" height="16rem md:20rem" styleClass="mb-4 rounded-2xl"></p-skeleton>
  </div>

  Detail Dialog
  <p-dialog header="{{ selectedTitle }}" [(visible)]="showDialog" [modal]="true" [style]="{ width: '70vw' }">
    <pre class="p-4 font-mono text-sm overflow-auto max-h-[60vh]">{{ selectedData | json }}</pre>
  </p-dialog>
</div> -->