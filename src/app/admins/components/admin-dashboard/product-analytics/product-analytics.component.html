<div *ngIf="data; else noDataOrLoading" class="product-analytics-widget">

  <!-- Header -->
  <header class="widget-header">
    <h1 class="widget-title">Product & Inventory Analytics</h1>
  </header>

  <!-- KPI Cards Row -->
  <div class="inventory-kpi-row">
    <div class="inventory-kpi-card" *ngFor="let kpi of [
      {icon:'pi pi-database', color:'var(--theme-accent-primary)', value: data.inventorySummary.totalValue | currency:'INR':'symbol':'1.0-0', label:'Total Value'},
      {icon:'pi pi-tags', color:'var(--theme-info-primary)', value: data.inventorySummary.totalItems, label:'Total Items'},
      {icon:'pi pi-exclamation-triangle', color:'var(--theme-warning-primary)', value: data.inventorySummary.lowStockCount, label:'Low Stock'},
      {icon:'pi pi-times-circle', color:'var(--theme-error-primary)', value: data.inventorySummary.outOfStockCount, label:'Out of Stock'}
    ]">
      <i [ngClass]="kpi.icon" [style.color]="kpi.color"></i>
      <div class="kpi-details">
        <span class="kpi-value">{{ kpi.value }}</span>
        <span class="kpi-label">{{ kpi.label }}</span>
      </div>
    </div>
  </div>

  <hr class="widget-divider" />

  <!-- Top Performing Products Section -->
<section class="analytics-section">
  <h3 class="section-header">Top Performing Products</h3>

  <p-tabView styleClass="se-tabview">
    <p-tabPanel header="By Profit">
      <div class="product-card-grid">
        <div *ngFor="let product of data.topPerformingProducts.topByProfit" class="product-card">
          <img [src]="product.thumbnail" [alt]="product.title" class="product-image"
            onerror="this.src='https://i.pinimg.com/736x/72/8a/69/728a69b420c64aad866be3fbe409965e.jpg'">
          <div class="product-card-body">
            <h4 class="product-title">{{ product.title }}</h4>
            <p class="product-metric">{{ product.grossProfit | currency:'INR':'symbol':'1.0-0' }} Profit</p>
            <p class="product-quantity">{{ product.totalQuantity }} sold</p>
          </div>
        </div>
      </div>
    </p-tabPanel>

    <p-tabPanel header="By Revenue">
      <div class="product-card-grid">
        <div *ngFor="let product of data.topPerformingProducts.topByRevenue" class="product-card">
          <img [src]="product.thumbnail" [alt]="product.title" class="product-image"
            onerror="this.src='https://i.pinimg.com/736x/72/8a/69/728a69b420c64aad866be3fbe409965e.jpg'">
          <div class="product-card-body">
            <h4 class="product-title">{{ product.title }}</h4>
            <p class="product-metric">{{ product.totalRevenue | currency:'INR':'symbol':'1.0-0' }} Revenue</p>
            <p class="product-quantity">{{ product.totalQuantity }} sold</p>
          </div>
        </div>
      </div>
    </p-tabPanel>

    <p-tabPanel header="By Quantity">
      <div class="product-card-grid">
        <div *ngFor="let product of data.topPerformingProducts.topByQuantity" class="product-card">
          <img [src]="product.thumbnail" [alt]="product.title" class="product-image"
            onerror="this.src='https://i.pinimg.com/736x/72/8a/69/728a69b420c64aad866be3fbe409965e.jpg'">
          <div class="product-card-body">
            <h4 class="product-title">{{ product.title }}</h4>
            <p class="product-metric">{{ product.totalQuantity }} units sold</p>
            <p class="product-quantity">{{ product.totalRevenue | currency:'INR':'symbol':'1.0-0' }}</p>
          </div>
        </div>
      </div>
    </p-tabPanel>
  </p-tabView>
</section>


  <!-- Performance by Category -->
  <section class="analytics-section">
    <h3 class="section-header">Performance by Category</h3>
    <div class="performance-carousel">
      <div *ngFor="let category of data.performanceByCategory" class="performance-card">
        <img [src]="category.thumbnails[0]" [alt]="category._id" class="performance-thumbnail"
          onerror="this.src='https://i.pinimg.com/736x/72/8a/69/728a69b420c64aad866be3fbe409965e.jpg'">
        <div class="performance-overlay">
          <span class="performance-title">{{ formatCategoryName(category._id) }}</span>
          <span class="performance-metric">{{ category.totalRevenue | currency:'INR':'symbol':'1.0-0' }}</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Performance by Brand -->
  <section class="analytics-section">
    <h3 class="section-header">Performance by Brand</h3>
    <div class="performance-carousel">
      <div *ngFor="let brand of data.performanceByBrand" class="performance-card">
        <img [src]="brand.thumbnails[0]" [alt]="brand._id" class="performance-thumbnail"
          onerror="this.src='https://i.pinimg.com/736x/72/8a/69/728a69b420c64aad866be3fbe409965e.jpg'">
        <div class="performance-overlay">
          <span class="performance-title">{{ brand._id }}</span>
          <span class="performance-metric">{{ brand.totalRevenue | currency:'INR':'symbol':'1.0-0' }}</span>
        </div>
      </div>
    </div>
  </section>

</div>

<!-- No Data State -->
<ng-template #noDataOrLoading>
  <div class="no-data-message">
    <p>Product analytics are currently unavailable.</p>
  </div>
</ng-template>
