<div *ngIf="data; else noDataOrLoading" class="product-analytics-widget">

  <!-- Header -->
  <header class="widget-header">
    <h1 class="widget-title">Product & Inventory Analytics</h1>
  </header>

  <!-- KPI Cards Row -->
  <div class="inventory-kpi-row">
    <div class="inventory-kpi-card" *ngFor="let kpi of [
      {icon:'pi pi-database', color:'var(--theme-accent-primary)', value: data.inventorySummary.totalValue | currency:'INR':'symbol':'1.0-0', label:'Total Value'},
      {icon:'pi pi-tags', color:'var(--theme-info-primary)', value: data.inventorySummary.totalItems, label:'Total Items'},
      {icon:'pi pi-exclamation-triangle', color:'var(--theme-warning-primary)', value: data.inventorySummary.lowStockCount, label:'Low Stock'},
      {icon:'pi pi-times-circle', color:'var(--theme-error-primary)', value: data.inventorySummary.outOfStockCount, label:'Out of Stock'}
    ]">
      <i [ngClass]="kpi.icon" [style.color]="kpi.color"></i>
      <div class="kpi-details">
        <span class="kpi-value">{{ kpi.value }}</span>
        <span class="kpi-label">{{ kpi.label }}</span>
      </div>
    </div>
  </div>

  <hr class="widget-divider">

  <!-- Main Grid -->
  <div class="grid lg:grid-cols-5 gap-6">

    <!-- Top Performing Products -->
    <div class="lg:col-span-3">
      <h3 class="section-header">Top Performing Products</h3>
      <p-tabView styleClass="se-tabview">
        <p-tabPanel header="By Profit">
          <ul class="product-list">
            <li *ngFor="let product of data.topPerformingProducts.topByProfit" class="product-list-item">
              <img [src]="product.thumbnail" [alt]="product.title" class="product-thumbnail" onerror="this.src='https://i.pinimg.com/736x/72/8a/69/728a69b420c64aad866be3fbe409965e.jpg'">
              <div class="product-info">
                <span class="product-title">{{ product.title }}</span>
                <span class="product-metric">{{ product.grossProfit | currency:'INR':'symbol':'1.0-0' }} Profit</span>
              </div>
              <span class="product-quantity">{{ product.totalQuantity }} sold</span>
            </li>
          </ul>
        </p-tabPanel>

        <p-tabPanel header="By Revenue">
          <ul class="product-list">
            <li *ngFor="let product of data.topPerformingProducts.topByRevenue" class="product-list-item">
              <img [src]="product.thumbnail" [alt]="product.title" class="product-thumbnail" onerror="this.src='https://i.pinimg.com/736x/72/8a/69/728a69b420c64aad866be3fbe409965e.jpg'">
              <div class="product-info">
                <span class="product-title">{{ product.title }}</span>
                <span class="product-metric">{{ product.totalRevenue | currency:'INR':'symbol':'1.0-0' }} Revenue</span>
              </div>
              <span class="product-quantity">{{ product.totalQuantity }} sold</span>
            </li>
          </ul>
        </p-tabPanel>

        <p-tabPanel header="By Quantity">
          <ul class="product-list">
            <li *ngFor="let product of data.topPerformingProducts.topByQuantity" class="product-list-item">
              <img [src]="product.thumbnail" [alt]="product.title" class="product-thumbnail" onerror="this.src='https://i.pinimg.com/736x/72/8a/69/728a69b420c64aad866be3fbe409965e.jpg'">
              <div class="product-info">
                <span class="product-title">{{ product.title }}</span>
                <span class="product-metric">{{ product.totalQuantity }} units sold</span>
              </div>
              <span class="product-quantity">{{ product.totalRevenue | currency:'INR':'symbol':'1.0-0' }}</span>
            </li>
          </ul>
        </p-tabPanel>
      </p-tabView>
    </div>

    <!-- Performance by Category & Brand -->
    <div class="lg:col-span-2 space-y-6">
      <div>
        <h3 class="section-header">Performance by Category</h3>
        <div class="performance-carousel">
          <div *ngFor="let category of data.performanceByCategory" class="performance-card">
            <img [src]="category.thumbnails[0]" [alt]="category._id" class="performance-thumbnail" onerror="this.src='https://i.pinimg.com/736x/72/8a/69/728a69b420c64aad866be3fbe409965e.jpg'">
            <div class="performance-overlay">
              <span class="performance-title">{{ formatCategoryName(category._id) }}</span>
              <span class="performance-metric">{{ category.totalRevenue | currency:'INR':'symbol':'1.0-0' }}</span>
            </div>
          </div>
        </div>
      </div>

      <div>
        <h3 class="section-header">Performance by Brand</h3>
        <div class="performance-carousel">
          <div *ngFor="let brand of data.performanceByBrand" class="performance-card">
            <img [src]="brand.thumbnails[0]" [alt]="brand._id" class="performance-thumbnail" onerror="this.src='https://i.pinimg.com/736x/72/8a/69/728a69b420c64aad866be3fbe409965e.jpg'">
            <div class="performance-overlay">
              <span class="performance-title">{{ brand._id }}</span>
              <span class="performance-metric">{{ brand.totalRevenue | currency:'INR':'symbol':'1.0-0' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<ng-template #noDataOrLoading>
  <div class="no-data-message">
    <p>Product analytics are currently unavailable.</p>
  </div>
</ng-template>
