<div class="calendar-container">
  <main class="calendar-main">
    <div class="calendar-panel">
      <div class="calendar-header">
        <h2 class="month-title">{{ displayedMonth() }}</h2>
        <div class="calendar-nav">
          <button (click)="goToToday()" class="btn btn-today">Today</button>
          <button (click)="changeMonth(-1)" aria-label="Previous month" class="btn btn-icon">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
          </button>
          <button (click)="changeMonth(1)" aria-label="Next month" class="btn btn-icon">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </button>
        </div>
      </div>

      <div class="calendar-grid">
        @for (day of weekDays; track day) {
        <div class="weekday-header">{{ day }}</div>
        }

        @for (day of calendarGrid(); track day.date.getTime()) {
        <div class="day-cell" [class.inactive]="!day.isCurrentMonth" [class.selectable]="day.heatmapData"
          [class.selected]="isDaySelected(day)" [class.level-0]="day.isCurrentMonth && !day.heatmapData"
          [class.level-1]="day.heatmapData?.level === 1" [class.level-2]="day.heatmapData?.level === 2"
          [class.level-3]="day.heatmapData?.level === 3" [class.level-4]="day.heatmapData?.level === 4"
          (click)="selectDay(day)">
          <div class="day-actions" (click)="$event.stopPropagation()">
            <button class="action-btn add" (click)="addNoteForDay(day, $event)" pTooltip="Add Note">
              <i class="pi pi-plus"></i>
            </button>
          </div>

          <span class="day-number">{{ day.dayOfMonth }}</span>
          <span class="today-marker" *ngIf="day.isToday && !isDaySelected(day)"></span>
        </div>
        }
      </div>
    </div>
  </main>

  <p-dialog [(visible)]="showSummaryDialog" maskStyleClass="backdrop-blur-sm" [modal]="true" [draggable]="false"
    [resizable]="false" [styleClass]="'summary-dialog glass-card dialog-fullscreen'">
    <ng-template pTemplate="header">
      <div class="dialog-header">
        <i class="pi pi-chart-bar dialog-header-icon"></i>
        <div class="dialog-header-text">
          <span class="dialog-title">Daily Business Summary</span>
          <span class="dialog-subtitle">{{ calanderDay | date: "fullDate" }}</span>
        </div>
      </div>
    </ng-template>

    <div class="summary-content">
      @if (isLoadingSummary()) {
      <div class="loading-state">
        <p-progressSpinner aria-label="Loading"></p-progressSpinner>
        <h3 class="loading-text">Analyzing Daily Data...</h3>
      </div>
      } @else { @if (selectedDaySummary(); as summary) {
      <div class="summary-metrics-row">
        <div class="metric-card revenue">
          <div class="metric-icon-wrapper">
            <i class="pi pi-wallet metric-icon"></i>
          </div>
          <div class="metric-details">
            <p class="metric-label">Total Revenue</p>
            <p class="metric-value">{{ summary.keyMetrics.revenue.value | currency: "INR" }}</p>
          </div>
          @if(summary.keyMetrics.revenue.changeVsYesterday; as change) {
          <div class="metric-change" [class.positive]="change > 0" [class.negative]="change < 0">
            <i class="pi" [ngClass]="change > 0 ? 'pi-arrow-up' : 'pi-arrow-down'"></i>
            <span>{{ change | number:'1.2-2' }}%</span>
          </div>
          }
        </div>
        <div class="metric-card sales">
          <div class="metric-icon-wrapper">
            <i class="pi pi-shopping-cart metric-icon"></i>
          </div>
          <div class="metric-details">
            <p class="metric-label">Total Sales</p>
            <p class="metric-value">{{ summary.keyMetrics.salesCount.value }}</p>
          </div>
          @if(summary.keyMetrics.salesCount.changeVsYesterday; as change) {
          <div class="metric-change" [class.positive]="change > 0" [class.negative]="change < 0">
            <i class="pi" [ngClass]="change > 0 ? 'pi-arrow-up' : 'pi-arrow-down'"></i>
            <span>{{ change | number:'1.2-2' }}%</span>
          </div>
          }
        </div>
        <div class="metric-card purchases">
          <div class="metric-icon-wrapper">
            <i class="pi pi-receipt metric-icon"></i>
          </div>
          <div class="metric-details">
            <p class="metric-label">Total Purchases</p>
            <p class="metric-value">{{ summary.keyMetrics.totalPurchases.value }}</p>
          </div>
          @if(summary.keyMetrics.totalPurchases.changeVsYesterday; as change) {
          <div class="metric-change" [class.positive]="change > 0" [class.negative]="change < 0">
            <i class="pi" [ngClass]="change > 0 ? 'pi-arrow-up' : 'pi-arrow-down'"></i>
            <span>{{ change | number:'1.2-2' }}%</span>
          </div>
          }
        </div>
        <div class="metric-card payments">
          <div class="metric-icon-wrapper">
            <i class="pi pi-money-bill metric-icon"></i>
          </div>
          <div class="metric-details">
            <p class="metric-label">Payments Received</p>
            <p class="metric-value">{{ summary.keyMetrics.paymentsReceived.value | currency: "INR" }}</p>
          </div>
          @if(summary.keyMetrics.paymentsReceived.changeVsYesterday; as change) {
          <div class="metric-change" [class.positive]="change > 0" [class.negative]="change < 0">
            <i class="pi" [ngClass]="change > 0 ? 'pi-arrow-up' : 'pi-arrow-down'"></i>
            <span>{{ change | number:'1.2-2' }}%</span>
          </div>
          }
        </div>
      </div>

      <p-tabView styleClass="summary-tabview">
        <p-tabPanel>
          <ng-template pTemplate="header">
            <i class="pi pi-tag mr-2"></i>
            <span>Sales</span>
            <p-badge [value]="summary.transactionDetails.sales.count" styleClass="ml-2"></p-badge>
          </ng-template>
          <div class="scroll-list">
            @for (invoice of summary.transactionDetails.sales.invoices; track invoice._id) {
            <div class="list-card">
              <div class="avatar-icon-wrapper sales-bg"><i class="pi pi-file-export"></i></div>
              <div class="item-details">
                <p class="item-title">{{ invoice.invoiceNumber }}</p>
                <p class="item-subtitle"><i class="pi pi-user text-xs"></i> {{ invoice.buyerDetails.fullname }}</p>
              </div>
              <div class="item-status" [ngClass]="invoice.status">{{ invoice.status }}</div>
              <div class="item-amount">{{ invoice.totalAmount | currency: "INR" }}</div>
            </div>
            } @empty {
            <div class="empty-state">
              <i class="pi pi-inbox empty-icon"></i>
              <p>No sales were recorded on this day.</p>
            </div>
            }
          </div>
        </p-tabPanel>

        <p-tabPanel>
          <ng-template pTemplate="header">
            <i class="pi pi-credit-card mr-2"></i>
            <span>Payments</span>
            <p-badge [value]="summary.transactionDetails.payments.count" styleClass="ml-2"></p-badge>
          </ng-template>
          <div class="scroll-list">
            @for (payment of summary.transactionDetails.payments.transactions; track payment._id) {
            <div class="list-card">
              <img class="avatar-img" [src]="payment.customerId.profileImg || 'assets/default-avatar.png'"
                alt="Customer Avatar" />
              <div class="item-details">
                <p class="item-title">{{ payment.customerId.fullname }}</p>
                <p class="item-subtitle">{{ payment.transactionId }}</p>
              </div>
              <div class="item-status">{{ payment.paymentMethod | titlecase }}</div>
              <div class="item-amount">{{ payment.amount | currency: "INR" }}</div>
            </div>
            } @empty {
            <div class="empty-state">
              <i class="pi pi-money-bill empty-icon"></i>
              <p>No payments were received.</p>
            </div>
            }
          </div>
        </p-tabPanel>

        <p-tabPanel>
          <ng-template pTemplate="header">
            <i class="pi pi-sparkles mr-2"></i>
            <span>Insights</span>
          </ng-template>

          <div class="insights-grid">
            <div class="list-section">
              <h4 class="section-title">Top Customers Today</h4>
              <div class="scroll-list">
                @for (customer of summary.actionableInsights.topCustomersToday; track customer._id) {
                <div class="list-card">
                  <img class="avatar-img" [src]="customer.profileImg" alt="Customer Avatar" />
                  <div class="item-details">
                    <p class="item-title">{{ customer.fullname }}</p>
                    <p class="item-subtitle">{{ customer.mobileNumber }}</p>
                  </div>
                  <div class="item-amount">{{ customer.amount | currency: "INR" }}</div>
                </div>
                } @empty {
                <div class="empty-state">
                  <i class="pi pi-users empty-icon"></i>
                  <p>No significant customer activity.</p>
                </div>
                }
              </div>
            </div>
            <div class="list-section">
              <h4 class="section-title">Most Profitable Items</h4>
              <div class="scroll-list">
                @for (product of summary.actionableInsights.mostProfitableToday; track product._id) {
                <div class="list-card">
                  <img class="avatar-img is-product" [src]="product.thumbnail" alt="Product Thumbnail" />
                  <div class="item-details">
                    <p class="item-title">{{ product.title }}</p>
                    <p class="item-subtitle">Profit Generated</p>
                  </div>
                  <div class="item-amount profit-text">{{ product.totalProfit | currency: "INR" }}</div>
                </div>
                } @empty {
                <div class="empty-state">
                  <i class="pi pi-dollar empty-icon"></i>
                  <p>No profitable items to show.</p>
                </div>
                }
              </div>
            </div>
          </div>
        </p-tabPanel>

        <p-tabPanel>
          <ng-template pTemplate="header">
            <i class="pi pi-box mr-2"></i>
            <span>Stock Alerts</span>
            <p-badge [value]="summary.actionableInsights.stockAlertsToday.length" styleClass="ml-2"></p-badge>
          </ng-template>
          <div class="scroll-list">
            @for (product of summary.actionableInsights.stockAlertsToday; track product._id) {
            <div class="list-card">
              <img class="avatar-img is-product" [src]="product.thumbnail" alt="Product Thumbnail" />
              <div class="item-details">
                <p class="item-title">{{ product.title }}</p>
                <p class="item-subtitle">SKU: {{ product.sku }}</p>
              </div>
              <div class="item-amount font-bold">Stock: {{ product.stock }}</div>
            </div>
            } @empty {
            <div class="empty-state">
              <i class="pi pi-check-circle empty-icon"></i>
              <p>All stock levels are healthy.</p>
            </div>
            }
          </div>
        </p-tabPanel>
        <p-tabPanel>
          <ng-template pTemplate="header">
            <i class="pi pi-plus-circle mr-2"></i>
            <span>New Products</span>
            <p-badge [value]="summary.actionableInsights.newProducts.length" severity="info"
              styleClass="ml-2"></p-badge>
          </ng-template>
          <div class="list-section">
            <h4 class="section-title">
              <i class="pi pi-plus-circle mr-2"></i>Products Added Today
            </h4>
            <div class="scroll-list">
              @for (product of summary.actionableInsights.newProducts; track product._id) {
              <div class="list-card">
                <img class="avatar-img is-product" [src]="product.thumbnail" alt="Product Thumbnail" />
                <div class="item-details">
                  <p class="item-title">{{ product.title }}</p>
                  <p class="item-subtitle">SKU: {{ product.sku }}</p>
                </div>
                <div class="item-amount">Initial Stock: {{ product.stock }}</div>
              </div>
              } @empty {
              <div class="empty-state">
                <i class="pi pi-box empty-icon"></i>
                <p>No new products were added.</p>
              </div>
              }
            </div>
          </div>
        </p-tabPanel>
      </p-tabView>
      } @else {
      <div class="empty-state-full">
        <i class="pi pi-calendar-times placeholder-icon"></i>
        <h3 class="placeholder-title">No Summary Available</h3>
        <p class="placeholder-text">
          There was no business activity for the selected day.
        </p>
      </div>
      } }
    </div>
  </p-dialog>


  <p-dialog maskStyleClass="backdrop-blur-sm" [(visible)]="showNotesDialog" [modal]="true" [draggable]="false"
    [resizable]="false" [styleClass]="'notes-dialog glass-card dialog-fullscreen'">
    <ng-template pTemplate="header">
      <div class="dialog-header">
        <i class="pi pi-pencil dialog-header-icon"></i>
        <div class="dialog-header-text">
          <span class="dialog-title">Daily Notes</span>
          <span class="dialog-subtitle">{{
            calanderDay | date: "fullDate"
            }}</span>
        </div>
      </div>
    </ng-template>
    <app-notes-manager [date]="calanderDay"></app-notes-manager>
  </p-dialog>
</div>

<!-- <div class="calendar-container">
  <main class="calendar-main">
    <div class="calendar-panel">
      <div class="calendar-header">
        <h2 class="month-title">{{ displayedMonth() }}</h2>
        <div class="calendar-nav">
          <button (click)="goToToday()" class="btn btn-today">Today</button>
          <button (click)="changeMonth(-1)" aria-label="Previous month" class="btn btn-icon">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
          </button>
          <button (click)="changeMonth(1)" aria-label="Next month" class="btn btn-icon">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </button>
        </div>
      </div>

      <div class="calendar-grid">
        @for (day of weekDays; track day) {
        <div class="weekday-header">{{ day }}</div>
        }

        @for (day of calendarGrid(); track day.date.getTime()) {
        <div class="day-cell" [class.inactive]="!day.isCurrentMonth" [class.selectable]="day.heatmapData"
          [class.selected]="isDaySelected(day)" [class.level-0]="day.isCurrentMonth && !day.heatmapData"
          [class.level-1]="day.heatmapData?.level === 1" [class.level-2]="day.heatmapData?.level === 2"
          [class.level-3]="day.heatmapData?.level === 3" [class.level-4]="day.heatmapData?.level === 4"
          (click)="selectDay(day)">
          <div class="day-actions" (click)="$event.stopPropagation()">
            <button class="action-btn add" (click)="addNoteForDay(day, $event)" pTooltip="Add Note">
              <i class="pi pi-plus"></i>
            </button>
          </div>

          <span class="day-number">{{ day.dayOfMonth }}</span>
          <span class="today-marker" *ngIf="day.isToday && !isDaySelected(day)"></span>
        </div>
        }
      </div>
    </div>
  </main>

  <p-dialog [(visible)]="showSummaryDialog" maskStyleClass="backdrop-blur-sm" [modal]="true" [draggable]="false"
    [resizable]="false" [styleClass]="'summary-dialog glass-card dialog-fullscreen'">
    <ng-template pTemplate="header">
      <div class="dialog-header">
        <i class="pi pi-chart-bar dialog-header-icon"></i>
        <div class="dialog-header-text">
          <span class="dialog-title">Daily Business Summary</span>
          <span class="dialog-subtitle">{{ calanderDay | date: "fullDate" }}</span>
        </div>
      </div>
    </ng-template>

    <div class="summary-content">
      @if (isLoadingSummary()) {
      <div class="loading-state">
        <p-progressSpinner aria-label="Loading"></p-progressSpinner>
        <h3 class="loading-text">Analyzing Daily Data...</h3>
      </div>
      } @else { @if (selectedDaySummary(); as summary) {
      <div class="summary-metrics-row">
        <div class="metric-card revenue">
          <div class="metric-icon-wrapper">
            <i class="pi pi-wallet metric-icon"></i>
          </div>
          <div class="metric-details">
            <p class="metric-label">Total Revenue</p>
            <p class="metric-value">{{ summary.keyMetrics.revenue.value | currency: "INR" }}</p>
          </div>
          @if(summary.keyMetrics.revenue.changeVsYesterday; as change) {
          <div class="metric-change" [class.positive]="change > 0" [class.negative]="change < 0">
            <i class="pi" [ngClass]="change > 0 ? 'pi-arrow-up' : 'pi-arrow-down'"></i>
            <span>{{ change | number:'1.2-2' }}%</span>
          </div>
          }
        </div>
        <div class="metric-card sales">
          <div class="metric-icon-wrapper">
            <i class="pi pi-shopping-cart metric-icon"></i>
          </div>
          <div class="metric-details">
            <p class="metric-label">Total Sales</p>
            <p class="metric-value">{{ summary.keyMetrics.salesCount.value }}</p>
          </div>
          @if(summary.keyMetrics.salesCount.changeVsYesterday; as change) {
          <div class="metric-change" [class.positive]="change > 0" [class.negative]="change < 0">
            <i class="pi" [ngClass]="change > 0 ? 'pi-arrow-up' : 'pi-arrow-down'"></i>
            <span>{{ change | number:'1.2-2' }}%</span>
          </div>
          }
        </div>
        <div class="metric-card purchases">
          <div class="metric-icon-wrapper">
            <i class="pi pi-receipt metric-icon"></i>
          </div>
          <div class="metric-details">
            <p class="metric-label">Total Purchases</p>
            <p class="metric-value">{{ summary.keyMetrics.totalPurchases.value }}</p>
          </div>
          @if(summary.keyMetrics.totalPurchases.changeVsYesterday; as change) {
          <div class="metric-change" [class.positive]="change > 0" [class.negative]="change < 0">
            <i class="pi" [ngClass]="change > 0 ? 'pi-arrow-up' : 'pi-arrow-down'"></i>
            <span>{{ change | number:'1.2-2' }}%</span>
          </div>
          }
        </div>
        <div class="metric-card payments">
          <div class="metric-icon-wrapper">
            <i class="pi pi-money-bill metric-icon"></i>
          </div>
          <div class="metric-details">
            <p class="metric-label">Payments Received</p>
            <p class="metric-value">{{ summary.keyMetrics.paymentsReceived.value | currency: "INR" }}</p>
          </div>
          @if(summary.keyMetrics.paymentsReceived.changeVsYesterday; as change) {
          <div class="metric-change" [class.positive]="change > 0" [class.negative]="change < 0">
            <i class="pi" [ngClass]="change > 0 ? 'pi-arrow-up' : 'pi-arrow-down'"></i>
            <span>{{ change | number:'1.2-2' }}%</span>
          </div>
          }
        </div>
      </div>

      <p-tabView styleClass="summary-tabview">
        <p-tabPanel>
          <ng-template pTemplate="header">
            <i class="pi pi-tag mr-2"></i>
            <span>Sales</span>
            <p-badge [value]="summary.transactionDetails.sales.count" styleClass="ml-2"></p-badge>
          </ng-template>
          <div class="scroll-list">
            @for (invoice of summary.transactionDetails.sales.invoices; track invoice._id) {
            <div class="list-card">
              <div class="avatar-icon-wrapper sales-bg"><i class="pi pi-file-export"></i></div>
              <div class="item-details">
                <p class="item-title">{{ invoice.invoiceNumber }}</p>
                <p class="item-subtitle"><i class="pi pi-user text-xs"></i> {{ invoice.buyerDetails.fullname }}</p>
              </div>
              <div class="item-status" [ngClass]="invoice.status">{{ invoice.status }}</div>
              <div class="item-amount">{{ invoice.totalAmount | currency: "INR" }}</div>
            </div>
            } @empty {
            <div class="empty-state">
              <i class="pi pi-inbox empty-icon"></i>
              <p>No sales were recorded on this day.</p>
            </div>
            }
          </div>
        </p-tabPanel>

        <p-tabPanel>
          <ng-template pTemplate="header">
            <i class="pi pi-credit-card mr-2"></i>
            <span>Payments</span>
            <p-badge [value]="summary.transactionDetails.payments.count" styleClass="ml-2"></p-badge>
          </ng-template>
          <div class="scroll-list">
            @for (payment of summary.transactionDetails.payments.transactions; track payment._id) {
            <div class="list-card">
              <img class="avatar-img" [src]="payment.customerId.profileImg || 'assets/default-avatar.png'"
                alt="Customer Avatar" />
              <div class="item-details">
                <p class="item-title">{{ payment.customerId.fullname }}</p>
                <p class="item-subtitle">{{ payment.transactionId }}</p>
              </div>
              <div class="item-status">{{ payment.paymentMethod | titlecase }}</div>
              <div class="item-amount">{{ payment.amount | currency: "INR" }}</div>
            </div>
            } @empty {
            <div class="empty-state">
              <i class="pi pi-money-bill empty-icon"></i>
              <p>No payments were received.</p>
            </div>
            }
          </div>
        </p-tabPanel>

        <p-tabPanel>
          <ng-template pTemplate="header">
            <i class="pi pi-sparkles mr-2"></i>
            <span>Insights</span>
          </ng-template>

          <div class="insights-grid">
            <div class="list-section">
              <h4 class="section-title">Top Customers Today</h4>
              <div class="scroll-list">
                @for (customer of summary.actionableInsights.topCustomersToday; track customer._id) {
                <div class="list-card">
                  <img class="avatar-img" [src]="customer.profileImg" alt="Customer Avatar" />
                  <div class="item-details">
                    <p class="item-title">{{ customer.fullname }}</p>
                    <p class="item-subtitle">{{ customer.mobileNumber }}</p>
                  </div>
                  <div class="item-amount">{{ customer.amount | currency: "INR" }}</div>
                </div>
                } @empty {
                <div class="empty-state">
                  <i class="pi pi-users empty-icon"></i>
                  <p>No significant customer activity.</p>
                </div>
                }
              </div>
            </div>
            <div class="list-section">
              <h4 class="section-title">Most Profitable Items</h4>
              <div class="scroll-list">
                @for (product of summary.actionableInsights.mostProfitableToday; track product._id) {
                <div class="list-card">
                  <img class="avatar-img is-product" [src]="product.thumbnail" alt="Product Thumbnail" />
                  <div class="item-details">
                    <p class="item-title">{{ product.title }}</p>
                    <p class="item-subtitle">Profit Generated</p>
                  </div>
                  <div class="item-amount profit-text">{{ product.totalProfit | currency: "INR" }}</div>
                </div>
                } @empty {
                <div class="empty-state">
                  <i class="pi pi-dollar empty-icon"></i>
                  <p>No profitable items to show.</p>
                </div>
                }
              </div>
            </div>
          </div>
        </p-tabPanel>

        <p-tabPanel>
          <ng-template pTemplate="header">
            <i class="pi pi-box mr-2"></i>
            <span>Stock Alerts</span>
            <p-badge [value]="summary.actionableInsights.stockAlertsToday.length" styleClass="ml-2"></p-badge>
          </ng-template>
          <div class="scroll-list">
            @for (product of summary.actionableInsights.stockAlertsToday; track product._id) {
            <div class="list-card">
              <img class="avatar-img is-product" [src]="product.thumbnail" alt="Product Thumbnail" />
              <div class="item-details">
                <p class="item-title">{{ product.title }}</p>
                <p class="item-subtitle">SKU: {{ product.sku }}</p>
              </div>
              <div class="item-amount font-bold">Stock: {{ product.stock }}</div>
            </div>
            } @empty {
            <div class="empty-state">
              <i class="pi pi-check-circle empty-icon"></i>
              <p>All stock levels are healthy.</p>
            </div>
            }
          </div>
        </p-tabPanel>
        <p-tabPanel>
          <ng-template pTemplate="header">
            <i class="pi pi-plus-circle mr-2"></i>
            <span>New Products</span>
            <p-badge [value]="summary.actionableInsights.newProducts.length" severity="info"
              styleClass="ml-2"></p-badge>
          </ng-template>
          <div class="list-section">
            <h4 class="section-title">
              <i class="pi pi-plus-circle mr-2"></i>Products Added Today
            </h4>
            <div class="scroll-list">
              @for (product of summary.actionableInsights.newProducts; track product._id) {
              <div class="list-card">
                <img class="avatar-img is-product" [src]="product.thumbnail" alt="Product Thumbnail" />
                <div class="item-details">
                  <p class="item-title">{{ product.title }}</p>
                  <p class="item-subtitle">SKU: {{ product.sku }}</p>
                </div>
                <div class="item-amount">Initial Stock: {{ product.stock }}</div>
              </div>
              } @empty {
              <div class="empty-state">
                <i class="pi pi-box empty-icon"></i>
                <p>No new products were added.</p>
              </div>
              }
            </div>
          </div>
        </p-tabPanel>
      </p-tabView>
      } @else {
      <div class="empty-state-full">
        <i class="pi pi-calendar-times placeholder-icon"></i>
        <h3 class="placeholder-title">No Summary Available</h3>
        <p class="placeholder-text">
          There was no business activity for the selected day.
        </p>
      </div>
      } }
    </div>
  </p-dialog>


  <p-dialog maskStyleClass="backdrop-blur-sm" [(visible)]="showNotesDialog" [modal]="true" [draggable]="false"
    [resizable]="false" [styleClass]="'notes-dialog glass-card dialog-fullscreen'">
    <ng-template pTemplate="header">
      <div class="dialog-header">
        <i class="pi pi-pencil dialog-header-icon"></i>
        <div class="dialog-header-text">
          <span class="dialog-title">Daily Notes</span>
          <span class="dialog-subtitle">{{
            calanderDay | date: "fullDate"
            }}</span>
        </div>
      </div>
    </ng-template>
    <app-notes-manager [date]="calanderDay"></app-notes-manager>
  </p-dialog>
</div>

<!-- <p-dialog [(visible)]="showSummaryDialog" maskStyleClass="backdrop-blur-sm" [modal]="true" [draggable]="false"
    [resizable]="false" [styleClass]="'summary-dialog glass-card dialog-fullscreen'">
    <ng-template pTemplate="header">
      <div class="dialog-header">
        <i class="pi pi-chart-bar dialog-header-icon"></i>
        <div class="dialog-header-text">
          <span class="dialog-title">Daily Business Summary</span>
          <span class="dialog-subtitle">{{
            calanderDay | date: "fullDate"
            }}</span>
        </div>
      </div>
    </ng-template>

    <div class="summary-content">
      @if (isLoadingSummary()) {
      <div class="loading-state">
        <p-progressSpinner aria-label="Loading"></p-progressSpinner>
        <h3 class="loading-text">Analyzing Daily Data...</h3>
      </div>
      } @else {
      @if (selectedDaySummary(); as summary) {
      <div class="summary-metrics-row">
        <div class="metric-card">
          <i class="pi pi-wallet metric-icon revenue"></i>
          <div>
            <p class="metric-label">Total Revenue</p>
            <p class="metric-value">
              {{ summary.keyMetrics.revenue.value | currency: "INR" }}
            </p>
          </div>
        </div>
        <div class="metric-card">
          <i class="pi pi-shopping-cart metric-icon sales"></i>
          <div>
            <p class="metric-label">Total Sales</p>
            <p class="metric-value">
              {{ summary.keyMetrics.salesCount.value }}
            </p>
          </div>
        </div>
        <div class="metric-card">
          <i class="pi pi-receipt metric-icon purchases"></i>
          <div>
            <p class="metric-label">Total Purchases</p>
            <p class="metric-value">
              {{ summary.keyMetrics.totalPurchases.value }}
            </p>
          </div>
        </div>
        <div class="metric-card">
          <i class="pi pi-money-bill metric-icon payments"></i>
          <div>
            <p class="metric-label">Payments Received</p>
            <p class="metric-value">
              {{
              summary.keyMetrics.paymentsReceived.value | currency: "INR"
              }}
            </p>
          </div>
        </div>
      </div>

      <p-tabView styleClass="summary-tabview">
        <p-tabPanel>
          <ng-template pTemplate="header">
            <i class="pi pi-tag mr-2"></i>
            <span>Sales Invoices</span>
            <p-badge [value]="summary.transactionDetails.sales.count" styleClass="ml-2"></p-badge>
          </ng-template>
          <div class="scroll-list">
            @for (
            invoice of summary.transactionDetails.sales.invoices;
            track invoice._id
            ) {
            <div class="list-card invoice-card">
              <div class="avatar-icon-wrapper sales-bg">
                <i class="pi pi-file-export"></i>
              </div>
              <div class="item-details">
                <p class="item-title">{{ invoice.invoiceNumber }}</p>
                <p class="item-subtitle">
                  <i class="pi pi-user text-xs"></i>
                  {{ invoice.buyerDetails.fullname }}
                </p>
              </div>
              <div class="item-status" [ngClass]="invoice.status">
                {{ invoice.status }}
              </div>
              <div class="item-amount">
                {{ invoice.totalAmount | currency: "INR" }}
              </div>
            </div>
            } @empty {
            <div class="empty-state">
              <i class="pi pi-inbox empty-icon"></i>
              <p>No sales were recorded on this day.</p>
            </div>
            }
          </div>
        </p-tabPanel>

        <p-tabPanel header="Actionable Insights">
          <ng-template pTemplate="header">
            <i class="pi pi-sparkles mr-2"></i>
            <span>Insights</span>
          </ng-template>
          <div class="insights-grid">
            <div class="list-section">
              <h4 class="section-title">Top Customers Today</h4>
              <div class="scroll-list">
                @for (
                customer of summary.actionableInsights.topCustomersToday;
                track customer._id
                ) {
                <div class="list-card">
                  <img class="avatar-img" [src]="customer.profileImg" alt="Customer Avatar" />
                  <div class="item-details">
                    <p class="item-title">{{ customer.fullname }}</p>
                    <p class="item-subtitle">
                      {{ customer.mobileNumber }}
                    </p>
                  </div>
                  <div class="item-amount">
                    {{ customer.amount | currency: "INR" }}
                  </div>
                </div>
                } @empty {
                <div class="empty-state">
                  <i class="pi pi-users empty-icon"></i>
                  <p>No significant customer activity.</p>
                </div>
                }
              </div>
            </div>
            <div class="list-section">
              <h4 class="section-title">Most Profitable Items</h4>
              <div class="scroll-list">
                @for (
                product of summary.actionableInsights.mostProfitableToday;
                track product._id
                ) {
                <div class="list-card">
                  <img class="avatar-img is-product" [src]="product.thumbnail" alt="Product Thumbnail" />
                  <div class="item-details">
                    <p class="item-title">{{ product.title }}</p>
                    <p class="item-subtitle">Profit Generated</p>
                  </div>
                  <div class="item-amount profit-text">
                    {{ product.totalProfit | currency: "INR" }}
                  </div>
                </div>
                } @empty {
                <div class="empty-state">
                  <i class="pi pi-dollar empty-icon"></i>
                  <p>No profitable items to show.</p>
                </div>
                }
              </div>
            </div>
          </div>
        </p-tabPanel>
      </p-tabView>
      } @else {
      <div class="empty-state-full">
        <i class="pi pi-calendar-times placeholder-icon"></i>
        <h3 class="placeholder-title">No Summary Available</h3>
        <p class="placeholder-text">
          There was no business activity for the selected day.
        </p>
      </div>
      }
      }
    </div>
  </p-dialog> -->



<!-- <p-dialog [(visible)]="showSummaryDialog" maskStyleClass="backdrop-blur-sm" [modal]="true" [draggable]="false"
    [resizable]="false" [styleClass]="'summary-dialog glass-card dialog-fullscreen'">

    <ng-template pTemplate="header">
      <div class="dialog-header">
        <i class="pi pi-calendar-check dialog-header-icon"></i>
        <div class="dialog-header-text">
          <span class="dialog-title">Daily Summary</span>
          <span class="dialog-subtitle">{{ calanderDay | date:'fullDate' }}</span>
        </div>
      </div>
    </ng-template>

    CONTENT
    <div class="summary-content">
      @if(isLoadingSummary()) {
      <div class="loading-state">
        <h3 class="loading-text">Fetching Summary...</h3>
      </div>
      } @else {
      @if (selectedDaySummary(); as summary) {

      TOP METRICS ROW
      <div class="summary-metrics-row">
        <div class="metric-card revenue">
          <i class="pi pi-chart-line metric-icon"></i>
          <div>
            <p class="metric-label">Revenue</p>
            <p class="metric-value">{{ summary.revenue | currency:'INR':'symbol':'1.0-0' }}</p>
          </div>
        </div>
        <div class="metric-card sales">
          <i class="pi pi-shopping-cart metric-icon"></i>
          <div>
            <p class="metric-label">Sales</p>
            <p class="metric-value">{{ summary.salesCount }}</p>
          </div>
        </div>
        <div class="metric-card customers">
          <i class="pi pi-users metric-icon"></i>
          <div>
            <p class="metric-label">New Customers</p>
            <p class="metric-value">{{ summary.newCustomers.length }}</p>
          </div>
        </div>
        <div class="metric-card products">
          <i class="pi pi-box metric-icon"></i>
          <div>
            <p class="metric-label">New Products</p>
            <p class="metric-value">{{ summary.newProducts.length }}</p>
          </div>
        </div>
      </div>

      DETAILS GRID
      <div class="summary-details-grid">
        CUSTOMERS
        <div class="list-section">
          <h4 class="section-title"><i class="pi pi-users mr-2"></i>New Customers</h4>
          <div class="scroll-list">
            @for(customer of summary.newCustomers; track customer._id) {
            <div class="list-card customer-card">
              <img class="avatar-img" [src]="'https://i.pravatar.cc/40?u=' + customer._id" alt="Customer Avatar">
              <div class="item-details">
                <p class="item-title">{{ customer.fullname }}</p>
                <p class="item-subtitle">{{ customer.mobileNumber }}</p>
              </div>
            </div>
            } @empty {
            <p class="empty-text">No new customers</p>
            }
          </div>
        </div>

        PRODUCTS
        <div class="list-section">
          <h4 class="section-title"><i class="pi pi-box mr-2"></i>New Products</h4>
          <div class="scroll-list">
            @for(product of summary.newProducts; track product._id) {
            <div class="list-card product-card">
              <div class="avatar-icon-wrapper"><i class="pi pi-box"></i></div>
              <div class="item-details">
                <p class="item-title">{{ product.title }}</p>
                <p class="item-subtitle">Stock: {{ product.stock }}</p>
              </div>
            </div>
            } @empty {
            <p class="empty-text">No new products</p>
            }
          </div>
        </div>
      </div>

      } @else {
      <div class="placeholder-state">
        <i class="pi pi-info-circle placeholder-icon"></i>
        <h3 class="placeholder-title">No Summary Available</h3>
        <p class="placeholder-text">No activity for the selected day.</p>
      </div>
      }
      }
    </div>
  </p-dialog>
 -->


<!-- <div class="calendar-container">
  <main class="calendar-main">
    Calendar Section
    <div class="calendar-panel">
      Calendar Header
      <div class="calendar-header">
        <h2 class="month-title">{{ displayedMonth() }}</h2>
        <div class="calendar-nav">
          <button (click)="goToToday()" class="btn btn-today">Today</button>
          <button (click)="changeMonth(-1)" aria-label="Previous month" class="btn btn-icon">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
          </button>
          <button (click)="changeMonth(1)" aria-label="Next month" class="btn btn-icon">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </button>
        </div>
      </div>

      Calendar Grid
      <div class="calendar-grid">
        Day Headers
        @for(day of weekDays; track day) {
        <div class="weekday-header">{{ day }}</div>
        }

        Calendar Day Cells
        @for(day of calendarGrid(); track day.date.getTime()) {
        <div class="day-cell" 
             [class.inactive]="!day.isCurrentMonth" 
             [class.selectable]="day.heatmapData"
             [class.selected]="isDaySelected(day)" 
             [class.level-0]="day.isCurrentMonth && !day.heatmapData"
             [class.level-1]="day.heatmapData?.level === 1" 
             [class.level-2]="day.heatmapData?.level === 2"
             [class.level-3]="day.heatmapData?.level === 3" 
             [class.level-4]="day.heatmapData?.level === 4"
             (click)="selectDay(day)">
          
          Top-right actions
          <div class="day-actions" (click)="$event.stopPropagation()">
            <button class="action-btn add" (click)="addNoteForDay(day, $event)" pTooltip="Add Note">
              <i class="pi pi-plus"></i>
            </button>
          </div>

          <span class="day-number">{{ day.dayOfMonth }}</span>
          <span class="today-marker" *ngIf="day.isToday && !isDaySelected(day)"></span>
        </div>
        }
      </div>
    </div>
  </main>

  REDESIGNED: Daily Summary Dialog with Glassmorphism Effect
  <p-dialog [(visible)]="showSummaryDialog" 
            [modal]="true" 
            [draggable]="false" 
            [resizable]="false"
            styleClass="summary-dialog glass-card">
    Custom Header
    <ng-template pTemplate="header">
      <div class="dialog-header">
        <i class="pi pi-calendar-check dialog-header-icon"></i>
        <div class="dialog-header-text">
          <span class="dialog-title">Daily Summary</span>
          <span class="dialog-subtitle">{{ calanderDay | date:'fullDate' }}</span>
        </div>
      </div>
    </ng-template>

    Dialog Content
    <div class="summary-content">
      CORRECTED: Restructured @if/@else block
      @if(isLoadingSummary()) {
      <div class="loading-state">
        <p-progressSpinner styleClass="w-12 h-12" strokeWidth="6"></p-progressSpinner>
        <h3 class="loading-text">Fetching Summary...</h3>
      </div>
      } @else {
        @if (selectedDaySummary(); as summary) {
        <div class="summary-grid">
          Left Column: Key Metrics
          <div class="summary-metrics">
            <div class="metric-card revenue">
              <div class="metric-icon-wrapper">
                <i class="pi pi-chart-line metric-icon"></i>
              </div>
              <div class="metric-text">
                <p class="metric-label">Total Revenue</p>
                <p class="metric-value">{{ summary.revenue | currency:'INR':'symbol':'1.0-0' }}</p>
              </div>
            </div>
            <div class="metric-card sales">
              <div class="metric-icon-wrapper">
                <i class="pi pi-shopping-cart metric-icon"></i>
              </div>
              <div class="metric-text">
                <p class="metric-label">Total Sales</p>
                <p class="metric-value">{{ summary.salesCount }}</p>
              </div>
            </div>
          </div>

          Right Column: Lists
          <div class="summary-lists">
            New Customers List
            <div class="list-section">
              <h4 class="section-title">
                <i class="pi pi-users mr-2"></i>New Customers ({{ summary.newCustomers.length }})
              </h4>
              <div class="scroll-list">
                @for(customer of summary.newCustomers; track customer._id) {
                <div class="list-card customer-card">
                  NEW: Image Placeholder
                  <img class="avatar-img" [src]="'https://i.pravatar.cc/40?u=' + customer._id" alt="Customer Avatar">
                  <div class="item-details">
                    <p class="item-title">{{ customer.fullname }}</p>
                    <p class="item-subtitle">{{ customer.mobileNumber }}</p>
                  </div>
                  <i class="pi pi-arrow-right list-card-arrow"></i>
                </div>
                } @empty {
                <div class="empty-list-placeholder">
                  <i class="pi pi-user-minus placeholder-icon"></i>
                  <p>No new customers recorded.</p>
                </div>
                }
              </div>
            </div>

            New Products List
            <div class="list-section">
              <h4 class="section-title">
                <i class="pi pi-box mr-2"></i>New Products ({{ summary.newProducts.length }})
              </h4>
              <div class="scroll-list">
                @for(product of summary.newProducts; track product._id) {
                <div class="list-card product-card">
                  NEW: Image Placeholder
                  <div class="avatar-icon-wrapper">
                    <i class="pi pi-box"></i>
                  </div>
                  <div class="item-details">
                    <p class="item-title">{{ product.title }}</p>
                    <p class="item-subtitle">Current Stock: {{ product.stock }}</p>
                  </div>
                  <i class="pi pi-arrow-right list-card-arrow"></i>
                </div>
                } @empty {
                <div class="empty-list-placeholder">
                  <i class="pi pi-box placeholder-icon"></i>
                  <p>No new products added.</p>
                </div>
                }
              </div>
            </div>
          </div>
        </div>
        } @else {
        <div class="placeholder-state">
          <i class="pi pi-info-circle placeholder-icon"></i>
          <h3 class="placeholder-title">No Summary Available</h3>
          <p class="placeholder-text">There is no activity summary for the selected day.</p>
        </div>
        }
      }
    </div>
  </p-dialog>

  Notes Dialog remains the same
  <p-dialog maskStyleClass="backdrop-blur-sm" [(visible)]="showNotesDialog" [modal]="true" [draggable]="false"
            [resizable]="false" [styleClass]="'notes-dialog'">
    <ng-template pTemplate="header">
      <div class="dialog-header">
        <i class="pi pi-pencil dialog-header-icon"></i>
        <div class="dialog-header-text">
          <span class="dialog-title">Daily Notes</span>
          <span class="dialog-subtitle">{{ calanderDay | date:'fullDate' }}</span>
        </div>
      </div>
    </ng-template>
    <app-notes-manager [date]="calanderDay"></app-notes-manager>
  </p-dialog>
</div>
 --> -->