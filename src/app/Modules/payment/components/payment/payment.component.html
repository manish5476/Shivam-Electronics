<div class="payment-container">
  <div class="main-card-v2">
    <header class="page-header">
      <h1 class="page-title"><i class="pi pi-credit-card"></i> Customer Payment</h1>
      <div class="header-controls">
        <p-select [(ngModel)]="customerId" (onChange)="fetchCustomerData()" [options]="customerIDDropdown"
          optionLabel="label" optionValue="_id" placeholder="Select a Customer" styleClass="w-full" [filter]="true">
        </p-select>
      </div>
    </header>

    <div class="content-grid">
      <section class="info-card">
        <h2 class="section-header"><i class="pi pi-user"></i> Customer Information</h2>
        <ng-container *ngIf="customer; else noCustomerSelected">
          <dl class="detail-list">
            <div class="detail-item">
              <dt>Name</dt>
              <dd>{{ customer.fullname }}</dd>
            </div>
            <div class="detail-item">
              <dt>Email</dt>
              <dd>{{ customer.email }}</dd>
            </div>
            <div class="detail-item">
              <dt>Phone</dt>
              <dd>{{ customer.phoneNumbers?.[0]?.number || 'N/A' }}</dd>
            </div>
            <div class="detail-item">
              <dt>Status</dt>
              <dd [ngClass]="customer.status === 'active' ? 'status-success' : 'status-danger'">
                {{ customer.status | titlecase }}
              </dd>
            </div>
            <div class="detail-item col-span-2">
              <dt>Address</dt>
              <dd>{{ customer.addresses?.[0]?.street || 'N/A' }}, {{ customer.addresses?.[0]?.city || '' }}</dd>
            </div>
            <div class="detail-item highlight-success">
              <dt>Total Purchased</dt>
              <dd>{{ customer.totalPurchasedAmount | currency:'INR' }}</dd>
            </div>
            <div class="detail-item highlight-danger">
              <dt>Remaining Amount</dt>
              <dd>{{ customer.remainingAmount | currency:'INR' }}</dd>
            </div>
          </dl>
        </ng-container>
        <ng-template #noCustomerSelected>
          <div class="placeholder-text">Select a customer to view their details.</div>
        </ng-template>
      </section>

      <section class="form-card">
        <h2 class="section-header"><i class="pi pi-dollar"></i> Process Payment</h2>
        <form #paymentForm="ngForm" (ngSubmit)="onSubmit()" class="payment-form">
          <div class="form-group amount-section">
            <label for="amount">Enter Amount to Pay</label>
            <p-inputNumber id="amount" [(ngModel)]="paymentData.amount" name="amount" mode="currency" currency="INR"
              locale="en-IN" required styleClass="w-full amount-input" inputStyleClass="p-3 text-3xl"></p-inputNumber>
          </div>

          <div class="form-group">
            <label>Select Payment Method</label>
            <div class="payment-method-selector">
              <div *ngFor="let method of paymentMethods" class="method-chip"
                [ngClass]="{'active': paymentData.paymentMethod === method.value}"
                (click)="selectPaymentMethod(method.value)">
                <i class="pi {{method.icon}}"></i>
                <span>{{ method.label }}</span>
              </div>
            </div>
          </div>

          <div class="details-section">
            <div class="form-group">
              <label for="status">Payment Status</label>
              <p-select id="status" [(ngModel)]="paymentData.status" name="status" [options]="statuses" required>
              </p-select>
            </div>
            <div class="form-group">
              <label for="description">Description / Notes</label>
              <textarea id="description" pInputTextarea [(ngModel)]="paymentData.description" name="description"
                rows="2" placeholder="Payment description (optional)" maxlength="200"></textarea>
            </div>
          </div>

          <div class="form-actions">
            <button pButton type="submit" [disabled]="paymentForm.invalid || !customerId" class="p-button-lg w-full">
              <div class="flex items-center justify-between w-full">
                <span>Process Payment</span>
                <span class="font-bold text-lg">{{ paymentData.amount | currency:'INR':'symbol':'1.2-2' }}</span>
              </div>
            </button>
          </div>
        </form>
      </section>
    </div>
  </div>
  <p-toast></p-toast>
</div>