<div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-6 bg-[var(--theme-bg-secondary)] p-4 rounded-xl border border-[var(--theme-border-primary)] shadow-sm">
  <div class="flex items-center gap-2">
    <i class="pi pi-users text-[var(--theme-accent-primary)] text-xl"></i>
    <label class="text-sm font-medium text-[var(--theme-text-secondary)]">Select Customer</label>
  </div>
  <p-select appendTo="body" [(ngModel)]="paymentFilter.customerId" (onChange)="getPaymentData()" [options]="customerIDDropdown"
    optionLabel="fullname" optionValue="_id" placeholder="Select Customer" class="w-full md:w-80">
    <ng-template let-option pTemplate="item">
      <div class="flex items-center gap-3 p-2">
        <div class="w-8 h-8 rounded-full bg-[var(--theme-accent-primary-light)] flex items-center justify-center">
          <i class="pi pi-user text-[var(--theme-accent-primary)] text-sm"></i>
        </div>
        <span class="font-medium text-[var(--theme-text-primary)]">{{ option.fullname }}</span>
      </div>
    </ng-template>
  </p-select>
</div>

<!-- Timeline -->
<div *ngIf="paymentFilter.data.length > 0; else elsepart" class="mb-8">
  <div class="flex items-center gap-2 mb-6">
    <i class="pi pi-history text-[var(--theme-accent-primary)] text-2xl"></i>
    <h3 class="text-xl font-semibold text-[var(--theme-text-primary)]">Payment History</h3>
    <p-badge [value]="paymentFilter.data.length" severity="info" class="ml-auto"></p-badge>
  </div>
  <p-timeline [value]="paymentFilter.data" align="alternate" styleClass="customized-timeline w-full">

    <!-- Marker -->
    <ng-template pTemplate="marker">
      <span class="flex w-12 h-12 items-center justify-center text-white rounded-full shadow-lg bg-gradient-to-r from-[var(--theme-accent-primary)] to-[var(--theme-accent-primary-hover)] transform hover:scale-110 transition-transform duration-200">
        <i class="pi pi-money-bill text-lg"></i>
      </span>
    </ng-template>

    <!-- Card Content -->
    <ng-template pTemplate="content" let-payment>
      <div class="relative bg-white dark:bg-[var(--theme-bg-secondary)] rounded-xl shadow-lg border border-gray-100 dark:border-[var(--theme-border-primary)] p-6 w-full max-w-lg mx-auto transform hover:shadow-2xl transition-all duration-300 overflow-hidden group">

        <!-- Gradient Overlay for Hover -->
        <div class="absolute inset-0 bg-gradient-to-t from-[var(--theme-accent-primary-light)] opacity-0 group-hover:opacity-10 transition-opacity duration-300"></div>

        <!-- Header Section -->
        <div class="flex justify-between items-start mb-5 relative z-10">
          <div class="flex items-center gap-3">
            <div class="w-16 h-16 rounded-xl bg-gradient-to-br from-[var(--theme-success-primary)] to-green-600 flex items-center justify-center shadow-lg">
              <i class="pi pi-wallet text-white text-2xl"></i>
            </div>
            <div>
              <h2 class="text-2xl font-bold text-[var(--theme-text-primary)]">Payment Received</h2>
              <p class="text-sm text-[var(--theme-text-muted)]">Transaction #{{ payment.transactionId | slice:0:8 }}...</p>
            </div>
          </div>
          <p-tag [value]="payment.status" [severity]="getStatusSeverity(payment.status)"
            styleClass="!text-sm !py-2 !px-4 !rounded-full font-semibold shadow-sm" />
        </div>

        <!-- Date and Quick Stats -->
        <div class="flex justify-between items-center mb-6 relative z-10">
          <span class="text-base text-[var(--theme-text-secondary)] font-medium">{{ payment.createdAt | date:'MMM d, yyyy â€¢ h:mm a' }}</span>
          <div class="flex gap-4">
            <div class="text-center">
              <p class="text-sm text-[var(--theme-text-muted)]">Method</p>
              <p class="font-semibold text-[var(--theme-accent-primary)]">{{ payment.paymentMethod }}</p>
            </div>
            <div class="text-center">
              <p class="text-sm text-[var(--theme-text-muted)]">Ref ID</p>
              <p class="font-mono text-xs text-[var(--theme-text-primary)] truncate max-w-20">{{ payment.transactionId }}</p>
            </div>
          </div>
        </div>

        <!-- Main Amount Section -->
        <div class="mb-6 relative z-10">
          <p class="text-sm text-[var(--theme-text-muted)] uppercase font-medium tracking-wide mb-2">Transaction Amount</p>
          <div class="flex items-baseline gap-2">
            <i class="pi pi-inr text-[var(--theme-success-primary)] text-3xl"></i>
            <p class="text-4xl font-bold text-[var(--theme-text-primary)] leading-none">
              {{ payment.amount | number:'1.0-0' }}
            </p>
            <span class="text-lg text-[var(--theme-text-secondary)]">.{{ payment.amount | number:'1.2-2' | slice:3 }}</span>
          </div>
        </div>

        <!-- Details Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 relative z-10">
          <div class="flex items-center gap-3 p-3 bg-[var(--theme-bg-ternary)] rounded-lg">
            <div class="w-10 h-10 rounded-lg bg-[var(--theme-accent-primary-light)] flex items-center justify-center">
              <i class="pi pi-user text-[var(--theme-accent-primary)]"></i>
            </div>
            <div>
              <p class="text-xs text-[var(--theme-text-muted)]">Customer</p>
              <p class="font-semibold text-[var(--theme-text-primary)]">{{ payment.customerName }}</p>
            </div>
          </div>
          <div class="flex items-center gap-3 p-3 bg-[var(--theme-bg-ternary)] rounded-lg">
            <div class="w-10 h-10 rounded-lg bg-[var(--theme-info-primary-light)] flex items-center justify-center">
              <i class="pi pi-phone text-[var(--theme-info-primary)]"></i>
            </div>
            <div>
              <p class="text-xs text-[var(--theme-text-muted)]">Contact</p>
              <p class="font-semibold text-[var(--theme-text-primary)]">{{ payment.phoneNumbers }}</p>
            </div>
          </div>
          <div *ngIf="payment.paymentMethod" class="flex items-center gap-3 p-3 bg-[var(--theme-bg-ternary)] rounded-lg md:col-span-2">
            <div class="w-10 h-10 rounded-lg" [ngClass]="{
              'bg-red-100': payment.paymentMethod === 'Card',
              'bg-green-100': payment.paymentMethod === 'UPI',
              'bg-purple-100': payment.paymentMethod === 'Wallet'
            }">
              <i [class]="payment.paymentMethod === 'Card' ? 'pi pi-credit-card' : payment.paymentMethod === 'UPI' ? 'pi pi-qrcode' : 'pi pi-wallet'" 
                 [ngClass]="{
                   'text-red-600': payment.paymentMethod === 'Card',
                   'text-green-600': payment.paymentMethod === 'UPI',
                   'text-purple-600': payment.paymentMethod === 'Wallet'
                 }" class="text-xl"></i>
            </div>
            <div>
              <p class="text-xs text-[var(--theme-text-muted)]">Payment Method</p>
              <p class="font-semibold text-[var(--theme-text-primary)]">{{ payment.paymentMethod }}</p>
            </div>
          </div>
        </div>

        <!-- Description -->
        <div *ngIf="payment.description" class="note-box relative z-10">
          <i class="pi pi-info-circle text-[var(--theme-accent-primary)] mr-3 inline-block align-middle"></i>
          <span class="align-middle">{{ payment.description }}</span>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-3 pt-4 border-t border-[var(--theme-border-secondary)] relative z-10">
          <p-button label="View Receipt" icon="pi pi-receipt" styleClass="p-button-outlined p-button-sm flex-1" (click)="viewReceipt(payment)"></p-button>
          <p-button label="Refund" icon="pi pi-undo" styleClass="p-button-secondary p-button-sm flex-1" [disabled]="payment.status !== 'completed'" (click)="refundPayment(payment)"></p-button>
        </div>

        <!-- Subtle footer line -->
        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-[var(--theme-accent-primary)] to-transparent opacity-20"></div>
      </div>
    </ng-template>
  </p-timeline>
</div>

<!-- Empty State -->
<ng-template #elsepart>
  <div class="empty-state flex flex-col items-center justify-center text-center py-20 bg-[var(--theme-bg-secondary)] rounded-xl border border-dashed border-[var(--theme-border-secondary)]">
    <div class="text-8xl mb-6 text-[var(--theme-text-muted)] animate-bounce">ðŸ’¸</div>
    <h3 class="text-2xl font-bold text-[var(--theme-text-primary)] mb-2">No Payment Records Found</h3>
    <p class="text-base text-[var(--theme-text-secondary)] mb-6 max-w-md">Select a customer above to view their payment history and transaction details.</p>
    <p-button label="Select a Customer" icon="pi pi-arrow-right" styleClass="p-button-outlined p-button-secondary" (click)="focusOnDropdown()"></p-button>
  </div>
</ng-template>