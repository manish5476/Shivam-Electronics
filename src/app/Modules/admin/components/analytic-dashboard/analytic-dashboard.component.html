<div class="analytics-container" *ngIf="data">

  <!-- KPI Grid -->
  <div class="kpi-grid">
    <div class="kpi-card" *ngFor="let kpi of kpis; let i = index" [style.animation-delay.ms]="i * 100">
      <div class="kpi-icon-wrapper">
        <i [class]="'pi ' + kpi.icon"></i>
      </div>
      <div class="kpi-info">
        <p class="kpi-title">{{ kpi.title }}</p>
        <p class="kpi-value">{{ kpi.value }}</p>
      </div>
    </div>
  </div>

  <!-- Top Row: Products + Category -->
  <div class="dashboard-grid top-row-grid">
    <!-- Top Performing Products -->
    <div class="dashboard-card top-products-card">
      <div class="card-header">
        <h3 class="section-title"><i class="pi pi-star-fill"></i> Top Performing Products</h3>
      </div>
      <div class="card-content">
        <div class="tab-container">
          <button class="tab-button" [class.active]="activeTab === 'profit'" (click)="activeTab='profit'">By Profit</button>
          <button class="tab-button" [class.active]="activeTab === 'revenue'" (click)="activeTab='revenue'">By Revenue</button>
          <button class="tab-button" [class.active]="activeTab === 'quantity'" (click)="activeTab='quantity'">By Quantity</button>
        </div>
        <div class="product-grid">
          <div class="product-card" *ngFor="let product of getTopProducts(activeTab)">
            <img [src]="product.thumbnail" (error)="onImageError($event)" [alt]="product.title" class="product-image" />
            <div class="product-info">
              <h4 class="product-title">{{ product.title }}</h4>
              <p class="product-meta">Brand: {{ product.brand }}</p>
              <p class="product-meta">Category: {{ formatCategoryName(product.category) }}</p>
              <div class="product-stats">
                <span>Revenue: {{ formatCurrency(product.totalRevenue) }}</span>
                <span>Profit: {{ formatCurrency(product.grossProfit) }}</span>
                <span>Quantity: {{ formatNumber(product.totalQuantity) }}</span>
              </div>
              <div class="product-tags" *ngIf="product.tags && product.tags[0]">
                <span *ngFor="let tag of product.tags[0]" class="tag">{{ tag }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance by Category -->
    <div class="dashboard-card category-card">
      <div class="card-header">
        <h3 class="section-title"><i class="pi pi-tags"></i> Performance by Category</h3>
      </div>
      <div class="card-content">
        <div class="list-grid">
          <div class="list-card" *ngFor="let category of data.performanceByCategory; let i=index">
            <img [src]="category.thumbnails[0]" (error)="onImageError($event)" [alt]="formatCategoryName(category._id)" class="list-image" />
            <div class="list-info">
              <h4 class="list-title">{{ formatCategoryName(category._id) }}</h4>
              <div class="progress-bar">
                <div class="progress" [style.width.%]="calculatePercentage(category.grossProfit, maxCategoryProfit)" [style.backgroundColor]="colors[i % colors.length]"></div>
              </div>
              <p class="list-value profit">Profit: {{ formatCurrency(category.grossProfit) }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Performance by Brand (Full Width Below) -->
  <div class="dashboard-card brand-card">
    <div class="card-header">
      <h3 class="section-title"><i class="pi pi-bookmark-fill"></i> Performance by Brand</h3>
    </div>
    <div class="card-content">
      <div class="list-grid brand-list-grid">
        <div class="list-card" *ngFor="let brand of data.performanceByBrand; let i=index">
          <img [src]="brand.thumbnails[0]" (error)="onImageError($event)" [alt]="brand._id" class="list-image" />
          <div class="list-info">
            <h4 class="list-title">{{ brand._id }}</h4>
            <div class="progress-bar">
              <div class="progress" [style.width.%]="calculatePercentage(brand.grossProfit, maxBrandProfit)" [style.backgroundColor]="colors[i % colors.length]"></div>
            </div>
            <p class="list-value profit">Profit: {{ formatCurrency(brand.grossProfit) }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>





<!-- <div class="analytics-container" *ngIf="data">
  <div class="kpi-grid">
    <div class="kpi-card" *ngFor="let kpi of kpis; let i = index" [style.animation-delay.ms]="i * 100">
      <div class="kpi-icon-wrapper" [ngClass]="kpi.iconClass">
        <i [class]="'pi ' + kpi.icon"></i>
      </div>
      <div class="kpi-info">
        <p class="kpi-title">{{ kpi.title }}</p>
        <p class="kpi-value">{{ kpi.value }}</p>
      </div>
    </div>
  </div>

  <div class="main-content-grid">
    <div class="section-card">
      <h3 class="section-title"><i class="pi pi-star-fill"></i> Top Performing Products</h3>
      <div class="tab-container">
        <button class="tab-button" [class.active]="activeTab === 'profit'" (click)="activeTab = 'profit'">By Profit</button>
        <button class="tab-button" [class.active]="activeTab === 'revenue'" (click)="activeTab = 'revenue'">By Revenue</button>
        <button class="tab-button" [class.active]="activeTab === 'quantity'" (click)="activeTab = 'quantity'">By Quantity</button>
      </div>
      <div class="content-wrapper">
        <div class="product-grid">
          <div class="product-card" *ngFor="let product of getTopProducts(activeTab)">
            <img [src]="product.thumbnail" (error)="onImageError($event)" [alt]="product.title" class="product-image" />
            <div class="product-info">
              <h4 class="product-title">{{ product.title }}</h4>
              <p class="product-meta">Brand: {{ product.brand }}</p>
              <p class="product-meta">Category: {{ formatCategoryName(product.category) }}</p>
              <div class="product-stats">
                <span>Revenue: {{ formatCurrency(product.totalRevenue) }}</span>
                <span>Profit: {{ formatCurrency(product.grossProfit) }}</span>
                <span>Quantity: {{ formatNumber(product.totalQuantity) }}</span>
              </div>
              <div class="product-tags" *ngIf="product.tags && product.tags[0]">
                <span *ngFor="let tag of product.tags[0]" class="tag">{{ tag }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="side-grid">
      <div class="section-card">
        <h3 class="section-title"><i class="pi pi-tags"></i> Performance by Category</h3>
        <div class="content-wrapper">
          <div class="list-grid">
            <div class="list-card" *ngFor="let category of data.performanceByCategory; let i = index">
              <img [src]="category.thumbnails[0]" (error)="onImageError($event)" [alt]="formatCategoryName(category._id)" class="list-image" />
              <div class="list-info">
                <h4 class="list-title">{{ formatCategoryName(category._id) }}</h4>
                <div class="progress-bar">
                  <div class="progress" [style.width.%]="calculatePercentage(category.grossProfit, maxCategoryProfit)" [style.backgroundColor]="colors[i % colors.length]"></div>
                </div>
                <p class="list-value profit">Profit: {{ formatCurrency(category.grossProfit) }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="section-card">
        <h3 class="section-title"><i class="pi pi-bookmark-fill"></i> Performance by Brand</h3>
        <div class="content-wrapper">
          <div class="list-grid">
            <div class="list-card" *ngFor="let brand of data.performanceByBrand; let i = index">
              <img [src]="brand.thumbnails[0]" (error)="onImageError($event)" [alt]="brand._id" class="list-image" />
              <div class="list-info">
                <h4 class="list-title">{{ brand._id }}</h4>
                <div class="progress-bar">
                  <div class="progress" [style.width.%]="calculatePercentage(brand.grossProfit, maxBrandProfit)" [style.backgroundColor]="colors[i % colors.length]"></div>
                </div>
                <p class="list-value profit">Profit: {{ formatCurrency(brand.grossProfit) }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> -->
<!-- <div class="analytics-container" *ngIf="data">
  KPI Summary Grid
  <div class="kpi-grid">
    <div class="kpi-card" *ngFor="let kpi of kpis">
      <div class="kpi-icon-wrapper" [ngClass]="kpi.iconClass">
        <i [class]="'pi ' + kpi.icon"></i>
      </div>
      <div class="kpi-info">
        <p class="kpi-title">{{ kpi.title }}</p>
        <p class="kpi-value">{{ kpi.value }}</p>
      </div>
    </div>
  </div>

  Top Performing Products Section
  <div class="section-card">
    <h3 class="section-title"><i class="pi pi-star-fill"></i> Top Performing Products</h3>
    <div class="tab-container">
      <button class="tab-button" [class.active]="activeTab === 'profit'" (click)="activeTab = 'profit'">By Profit</button>
      <button class="tab-button" [class.active]="activeTab === 'revenue'" (click)="activeTab = 'revenue'">By Revenue</button>
      <button class="tab-button" [class.active]="activeTab === 'quantity'" (click)="activeTab = 'quantity'">By Quantity</button>
    </div>
    <div class="product-grid">
      <div class="product-card" *ngFor="let product of getTopProducts(activeTab)">
        <img [src]="product.thumbnail" (error)="onImageError($event)" [alt]="product.title" class="product-image" />
        <div class="product-info">
          <h4 class="product-title">{{ product.title }}</h4>
          <p class="product-meta">Brand: {{ product.brand }}</p>
          <p class="product-meta">Category: {{ formatCategoryName(product.category) }}</p>
          <div class="product-stats">
            <span>Revenue: {{ formatCurrency(product.totalRevenue) }}</span>
            <span>Profit: {{ formatCurrency(product.grossProfit) }}</span>
            <span>Quantity: {{ formatNumber(product.totalQuantity) }}</span>
          </div>
          <div class="product-tags">
            <span *ngFor="let tag of product.tags[0]" class="tag">{{ tag }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  Performance By Category Section
  <div class="section-card">
    <h3 class="section-title"><i class="pi pi-tags"></i> Performance by Category</h3>
    <div class="category-grid">
      <div class="category-card" *ngFor="let category of data.performanceByCategory; let i = index">
        <img [src]="category.thumbnails[0]" (error)="onImageError($event)" [alt]="formatCategoryName(category._id)" class="category-image" />
        <div class="category-info">
          <h4 class="category-title">{{ formatCategoryName(category._id) }}</h4>
          <div class="progress-bar">
            <div class="progress" [style.width.%]="calculatePercentage(category.grossProfit, maxCategoryProfit)" [style.backgroundColor]="colors[i % colors.length]"></div>
          </div>
          <p class="category-value">Revenue: {{ formatCurrency(category.totalRevenue) }}</p>
          <p class="category-value profit">Profit: {{ formatCurrency(category.grossProfit) }}</p>
          <div class="category-tags">
            <span *ngFor="let tag of category.tags[0]" class="tag">{{ tag }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  Performance By Brand Section
  <div class="section-card">
    <h3 class="section-title"><i class="pi pi-bookmark-fill"></i> Performance by Brand</h3>
    <div class="brand-grid">
      <div class="brand-card" *ngFor="let brand of data.performanceByBrand; let i = index">
        <img [src]="brand.thumbnails[0]" (error)="onImageError($event)" [alt]="brand._id" class="brand-image" />
        <div class="brand-info">
          <h4 class="brand-title">{{ brand._id }}</h4>
          <div class="progress-bar">
            <div class="progress" [style.width.%]="calculatePercentage(brand.grossProfit, maxBrandProfit)" [style.backgroundColor]="colors[i % colors.length]"></div>
          </div>
          <p class="brand-value">Revenue: {{ formatCurrency(brand.totalRevenue) }}</p>
          <p class="brand-value profit">Profit: {{ formatCurrency(brand.grossProfit) }}</p>
          <div class="brand-tags">
            <span *ngFor="let tag of brand.tags[0]" class="tag">{{ tag }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> -->