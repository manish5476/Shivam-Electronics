<!-- 
<p-toast></p-toast>
<div class="admin-dashboard" [@fadeIn]="true">
  Header with Filters
  <div class="dashboard-header flex items-center justify-between mb-4">
    <div class="left">
      <h2 class="page-title">Admin Dashboard</h2>
      <div class="filters flex gap-3 items-center">
        <p-select [options]="periodOptions" [(ngModel)]="selectedPeriod" optionLabel="label" optionValue="value" styleClass="p-inputtext-sm"
          (onChange)="onFilterChange()"></p-select>

        <p-select [options]="limitOptions" [(ngModel)]="dataLimit" optionLabel="label" optionValue="value" styleClass="p-inputtext-sm"
          (onChange)="onFilterChange()"></p-select>

        <div *ngIf="selectedPeriod === 'custom'">
          <p-calendar [(ngModel)]="customDateRange" selectionMode="range" [readonlyInput]="true" placeholder="Select a date range"
            dateFormat="dd/mm/yy" styleClass="p-inputtext-sm"></p-calendar>
          <button pButton type="button" label="Apply" icon="pi pi-check" class="p-button-sm" (click)="onApplyCustomRange()"></button>
        </div>
      </div>
    </div>

    <div class="right flex gap-2">
      <button pButton pRipple type="button" (click)="toggleLockGrid()" [icon]="isGridLocked ? 'pi pi-lock' : 'pi pi-lock-open'"
        [label]="isGridLocked ? 'Unlock Grid' : 'Lock Grid'"></button>
      <button pButton type="button" icon="pi pi-save" label="Save Layout" class="p-button-info" (click)="saveLayout()"></button>
      <button pButton type="button" icon="pi pi-refresh" label="Reload All" class="p-button-plain" (click)="triggerRefresh()"></button>
    </div>
  </div>

  Main Dashboard Content
  <gridstack [options]="gridOptions" *ngIf="!isLoading">
    <gridstack-item *ngFor="let widget of widgets; trackBy: identify" [options]="widget">

      KPI Summary
      <p-panel *ngIf="widget.id === 'kpiSummary'" [toggleable]="true" styleClass="h-full">
        <ng-template pTemplate="header">
          <span class="font-bold">Key Performance Indicators</span>
          <div class="header-actions" style="float:right">
            <button pButton icon="pi pi-refresh" class="p-button-text p-button-sm" (click)="refreshKpi()" title="Refresh KPIs"></button>
            <button pButton icon="pi pi-external-link" class="p-button-text p-button-sm" (click)="openDialog('Dashboard Overview', enhancedKpiSummary)" title="Open"></button>
          </div>
        </ng-template>

        <app-dashboard-summary [summaryData]="enhancedKpiSummary" [isLoading]="isLoading"></app-dashboard-summary>
      </p-panel>

      Charts Overview
      <p-panel *ngIf="widget.id === 'chartsOverview'" [toggleable]="true" styleClass="h-full">
        <ng-template pTemplate="header">
          <span class="font-bold">Revenue Trends</span>
          <div class="header-actions" style="float:right">
            <button pButton icon="pi pi-refresh" class="p-button-text p-button-sm" (click)="refreshSalesTrends()" title="Refresh Sales Trends"></button>
            <button pButton icon="pi pi-external-link" class="p-button-text p-button-sm" (click)="openDialog('Charts Overview', { salesTrends, salesCharts })" title="Open Chart Dialog"></button>
          </div>
        </ng-template>

        <app-dashboard-chart-combo [selectedPeriod]="selectedPeriod" [startDate]="startDate" [endDate]="endDate"
         ></app-dashboard-chart-combo>
      </p-panel>
 [salesTrends]="salesTrends" [salesCharts]="salesCharts"
      Product Analytics
      <p-panel *ngIf="widget.id === 'productAnalytics'" [toggleable]="true" styleClass="h-full">
        <ng-template pTemplate="header">
          <span class="font-bold">Product & Inventory Insights</span>
          <div class="header-actions" style="float:right">
            <button pButton icon="pi pi-refresh" class="p-button-text p-button-sm" (click)="refreshProductAnalytics()" title="Refresh Products"></button>
            <button pButton icon="pi pi-external-link" class="p-button-text p-button-sm" (click)="openDialog('Product Analytics', productAnalytics)" title="Open"></button>
          </div>
        </ng-template>

        <app-analytic-dashboard [data]="productAnalytics"></app-analytic-dashboard>
      </p-panel>

      Customer Analytics
      <p-panel *ngIf="widget.id === 'customerAnalytics'" [toggleable]="true" styleClass="h-full">
        <ng-template pTemplate="header">
          <span class="font-bold">Customer Insights</span>
          <div class="header-actions" style="float:right">
            <button pButton icon="pi pi-refresh" class="p-button-text p-button-sm" (click)="refreshCustomerAnalytics()" title="Refresh Customers"></button>
            <button pButton icon="pi pi-external-link" class="p-button-text p-button-sm" (click)="openDialog('Customer Analytics', customerAnalytics)" title="Open"></button>
          </div>
        </ng-template>

        <app-dashboard-top-customer-view [data]="customerAnalytics"></app-dashboard-top-customer-view>
      </p-panel>

    </gridstack-item>
  </gridstack>

  Loading Skeleton
  <ng-template [ngIf]="isLoading">
    <div class="grid">
      <div class="col-12"><p-skeleton width="100%" height="8rem"></p-skeleton></div>
      <div class="col-12"><p-skeleton width="100%" height="15rem"></p-skeleton></div>
      <div class="col-6"><p-skeleton width="100%" height="20rem"></p-skeleton></div>
      <div class="col-6"><p-skeleton width="100%" height="20rem"></p-skeleton></div>
    </div>
  </ng-template>

</div>

Dialog for panel details
<p-dialog [(visible)]="showDialog" [modal]="true" [style]="{width: '80vw', height: '80vh'}"
  header="{{ selectedPanelTitle }}" [draggable]="true" [resizable]="true" class="perfect-dialog">
  <div class="p-4 overflow-auto h-full dialog-content">
    <ng-container [ngSwitch]="selectedPanelTitle">
      <app-dashboard-chart-combo *ngSwitchCase="'Charts Overview'" [selectedPeriod]="selectedPeriod"
        [startDate]="startDate" [endDate]="endDate" >
      </app-dashboard-chart-combo>
      [salesTrends]="salesTrends" [salesCharts]="salesCharts"
            <app-dashboard-chart-combo [selectedPeriod]="selectedPeriod" [startDate]="startDate" [endDate]="endDate"></app-dashboard-chart-combo>
      <app-dashboard-summary *ngSwitchCase="'Dashboard Overview'" [summaryData]="enhancedKpiSummary" [isLoading]="false">
      </app-dashboard-summary>

      <app-analytic-dashboard *ngSwitchCase="'Product Analytics'" [data]="selectedPanelData"></app-analytic-dashboard>

      <app-dashboard-top-customer-view *ngSwitchCase="'Customer Analytics'" [data]="selectedPanelData"></app-dashboard-top-customer-view>

      <app-paymentanalytics *ngSwitchCase="'Payment Analytics'" [data]="selectedPanelData"></app-paymentanalytics>
      <app-sales-performance *ngSwitchCase="'Sales Forecast'" [data]="selectedPanelData"></app-sales-performance>
      <pre *ngSwitchDefault class="json-viewer">{{ selectedPanelData | json }}</pre>
    </ng-container>
  </div>
</p-dialog> -->

<!-- admin-dashboard.component.html -->
<p-toast></p-toast>
<div class="admin-dashboard" [@fadeIn]="true">
  <!-- Header with Filters -->
  <div class="dashboard-header flex items-center justify-between mb-4">
    <div class="left">
      <h2 class="page-title">Admin Dashboard</h2>
      <div class="filters flex gap-3 items-center">
        <p-select [options]="periodOptions" [(ngModel)]="selectedPeriod" optionLabel="label" optionValue="value" styleClass="p-inputtext-sm"
          (onChange)="onFilterChange()"></p-select>

        <p-select [options]="limitOptions" [(ngModel)]="dataLimit" optionLabel="label" optionValue="value" styleClass="p-inputtext-sm"
          (onChange)="onFilterChange()"></p-select>

        <div *ngIf="selectedPeriod === 'custom'">
          <p-calendar [(ngModel)]="customDateRange" selectionMode="range" [readonlyInput]="true" placeholder="Select a date range"
            dateFormat="dd/mm/yy" styleClass="p-inputtext-sm"></p-calendar>
          <button pButton type="button" label="Apply" icon="pi pi-check" class="p-button-sm" (click)="onApplyCustomRange()"></button>
        </div>
      </div>
    </div>

    <div class="right flex gap-2">
      <button pButton pRipple type="button" (click)="toggleLockGrid()" [icon]="isGridLocked ? 'pi pi-lock' : 'pi pi-lock-open'"
        [label]="isGridLocked ? 'Unlock Grid' : 'Lock Grid'"></button>
      <button pButton type="button" icon="pi pi-save" label="Save Layout" class="p-button-info" (click)="saveLayout()"></button>
      <button pButton type="button" icon="pi pi-refresh" label="Reload All" class="p-button-plain" (click)="triggerRefresh()"></button>
      <button pButton type="button" icon="pi pi-code" label="Toggle JSON" (click)="showJson = !showJson"></button>
    </div>
  </div>

  <!-- Main Dashboard Content -->
  <gridstack [options]="gridOptions" *ngIf="!isLoading">
    <gridstack-item *ngFor="let widget of widgets; trackBy: identify" [options]="widget">

      <!-- KPI Summary -->
      <p-panel *ngIf="widget.id === 'kpiSummary'" [toggleable]="true" styleClass="h-full">
        <ng-template pTemplate="header">
          <span class="font-bold">Key Performance Indicators</span>
          <div class="header-actions" style="float:right">
            <button pButton icon="pi pi-refresh" class="p-button-text p-button-sm" (click)="refreshKpiPanel()" title="Refresh KPIs"></button>
            <button pButton icon="pi pi-external-link" class="p-button-text p-button-sm" (click)="openDialog('Key Performance Indicators', { enhancedKpiSummary, kpiSummary, overview })" title="Open"></button>
          </div>
        </ng-template>

        <app-dashboard-summary [summaryData]="enhancedKpiSummary" [isLoading]="isKpiLoading"></app-dashboard-summary>
        <div *ngIf="showJson" class="json-section">
          <pre class="json-viewer">{{ enhancedKpiSummary | json }}</pre>
          <pre class="json-viewer">{{ kpiSummary | json }}</pre>
          <pre class="json-viewer">{{ overview | json }}</pre>
        </div>
      </p-panel>

      <!-- Charts Overview -->
      <p-panel *ngIf="widget.id === 'chartsOverview'" [toggleable]="true" styleClass="h-full">
        <ng-template pTemplate="header">
          <span class="font-bold">Revenue Trends</span>
          <div class="header-actions" style="float:right">
            <button pButton icon="pi pi-refresh" class="p-button-text p-button-sm" (click)="refreshChartsPanel()" title="Refresh Charts"></button>
            <button pButton icon="pi pi-external-link" class="p-button-text p-button-sm" (click)="openDialog('Revenue Trends', { salesTrends, salesCharts, yearlySales, monthlySales, weeklySales })" title="Open Chart Dialog"></button>
          </div>
        </ng-template>

        <app-dashboard-chart-combo [selectedPeriod]="selectedPeriod" [startDate]="startDate" [endDate]="endDate">
        </app-dashboard-chart-combo>
             <!-- [salesTrends]="salesTrends" [salesCharts]="salesCharts" [yearlySales]="yearlySales"
          [monthlySales]="monthlySales" [weeklySales]="weeklySales" -->
        <div *ngIf="showJson" class="json-section">
          <pre class="json-viewer">{{ salesTrends | json }}</pre>
          <pre class="json-viewer">{{ salesCharts | json }}</pre>
          <pre class="json-viewer">{{ yearlySales | json }}</pre>
          <pre class="json-viewer">{{ monthlySales | json }}</pre>
          <pre class="json-viewer">{{ weeklySales | json }}</pre>
        </div>
      </p-panel>

      <!-- Product Analytics -->
      <p-panel *ngIf="widget.id === 'productAnalytics'" [toggleable]="true" styleClass="h-full">
        <ng-template pTemplate="header">
          <span class="font-bold">Product & Inventory Insights</span>
          <div class="header-actions" style="float:right">
            <button pButton icon="pi pi-refresh" class="p-button-text p-button-sm" (click)="refreshProductPanel()" title="Refresh Products"></button>
            <button pButton icon="pi pi-external-link" class="p-button-text p-button-sm" (click)="openDialog('Product & Inventory Insights', { productAnalytics, inventoryTurnover })" title="Open"></button>
          </div>
        </ng-template>

        <app-analytic-dashboard [data]="productAnalytics"></app-analytic-dashboard>
        <div *ngIf="showJson" class="json-section">
          <pre class="json-viewer">{{ productAnalytics | json }}</pre>
          <pre class="json-viewer">{{ inventoryTurnover | json }}</pre>
        </div>
      </p-panel>

      <!-- Customer Analytics -->
      <p-panel *ngIf="widget.id === 'customerAnalytics'" [toggleable]="true" styleClass="h-full">
        <ng-template pTemplate="header">
          <span class="font-bold">Customer Insights</span>
          <div class="header-actions" style="float:right">
            <button pButton icon="pi pi-refresh" class="p-button-text p-button-sm" (click)="refreshCustomerPanel()" title="Refresh Customers"></button>
            <button pButton icon="pi pi-external-link" class="p-button-text p-button-sm" (click)="openDialog('Customer Insights', customerAnalytics)" title="Open"></button>
          </div>
        </ng-template>

        <app-dashboard-top-customer-view [data]="customerAnalytics"></app-dashboard-top-customer-view>
        <div *ngIf="showJson" class="json-section">
          <pre class="json-viewer">{{ customerAnalytics | json }}</pre>
        </div>
      </p-panel>

      <!-- Payment Analytics -->
      <p-panel *ngIf="widget.id === 'paymentAnalytics'" [toggleable]="true" styleClass="h-full">
        <ng-template pTemplate="header">
          <span class="font-bold">Payment Analytics</span>
          <div class="header-actions" style="float:right">
            <button pButton icon="pi pi-refresh" class="p-button-text p-button-sm" (click)="refreshPaymentPanel()" title="Refresh Payments"></button>
            <button pButton icon="pi pi-external-link" class="p-button-text p-button-sm" (click)="openDialog('Payment Analytics', paymentAnalytics)" title="Open"></button>
          </div>
        </ng-template>

        <app-paymentanalytics [data]="paymentAnalytics"></app-paymentanalytics>
        <div *ngIf="showJson" class="json-section">
          <pre class="json-viewer">{{ paymentAnalytics | json }}</pre>
        </div>
      </p-panel>

      <!-- Sales Forecast -->
      <p-panel *ngIf="widget.id === 'salesForecast'" [toggleable]="true" styleClass="h-full">
        <ng-template pTemplate="header">
          <span class="font-bold">Sales Forecast</span>
          <div class="header-actions" style="float:right">
            <button pButton icon="pi pi-refresh" class="p-button-text p-button-sm" (click)="refreshForecastPanel()" title="Refresh Forecast"></button>
            <button pButton icon="pi pi-external-link" class="p-button-text p-button-sm" (click)="openDialog('Sales Forecast', salesForecast)" title="Open"></button>
          </div>
        </ng-template>

        <app-sales-performance [data]="salesForecast"></app-sales-performance>
        <div *ngIf="showJson" class="json-section">
          <pre class="json-viewer">{{ salesForecast | json }}</pre>
        </div>
      </p-panel>

    </gridstack-item>
  </gridstack>

  <!-- Loading Skeleton -->
  <ng-template [ngIf]="isLoading">
    <div class="grid">
      <div class="col-12"><p-skeleton width="100%" height="8rem"></p-skeleton></div>
      <div class="col-12"><p-skeleton width="100%" height="15rem"></p-skeleton></div>
      <div class="col-6"><p-skeleton width="100%" height="20rem"></p-skeleton></div>
      <div class="col-6"><p-skeleton width="100%" height="20rem"></p-skeleton></div>
      <div class="col-6"><p-skeleton width="100%" height="20rem"></p-skeleton></div>
      <div class="col-6"><p-skeleton width="100%" height="20rem"></p-skeleton></div>
    </div>
  </ng-template>

</div>

<!-- Dialog for panel details -->
<p-dialog [(visible)]="showDialog" [modal]="true" [style]="{width: '80vw', height: '80vh'}"
  header="{{ selectedPanelTitle }}" [draggable]="true" [resizable]="true" class="perfect-dialog">
  <div class="p-4 overflow-auto h-full dialog-content">
    <ng-container [ngSwitch]="selectedPanelTitle">
      <div *ngSwitchCase="'Revenue Trends'">
        <app-dashboard-chart-combo [selectedPeriod]="selectedPeriod"
          [startDate]="startDate" [endDate]="endDate"
        ></app-dashboard-chart-combo>
      </div>
        <!-- [salesTrends]="selectedPanelData.salesTrends" [salesCharts]="selectedPanelData.salesCharts"
          [yearlySales]="selectedPanelData.yearlySales" [monthlySales]="selectedPanelData.monthlySales"
          [weeklySales]="selectedPanelData.weeklySales" -->
      <div *ngSwitchCase="'Key Performance Indicators'">
        <app-dashboard-summary [summaryData]="selectedPanelData.enhancedKpiSummary" [isLoading]="false"></app-dashboard-summary>
        <pre class="json-viewer">{{ selectedPanelData.kpiSummary | json }}</pre>
        <pre class="json-viewer">{{ selectedPanelData.overview | json }}</pre>
      </div>
      <div *ngSwitchCase="'Product & Inventory Insights'">
        <app-analytic-dashboard [data]="selectedPanelData.productAnalytics"></app-analytic-dashboard>
        <pre class="json-viewer">{{ selectedPanelData.inventoryTurnover | json }}</pre>
      </div>
      <app-dashboard-top-customer-view *ngSwitchCase="'Customer Insights'" [data]="selectedPanelData"></app-dashboard-top-customer-view>
      <app-paymentanalytics *ngSwitchCase="'Payment Analytics'" [data]="selectedPanelData"></app-paymentanalytics>
      <app-sales-performance *ngSwitchCase="'Sales Forecast'" [data]="selectedPanelData"></app-sales-performance>
      <pre *ngSwitchDefault class="json-viewer">{{ selectedPanelData | json }}</pre>
    </ng-container>
  </div>
</p-dialog>