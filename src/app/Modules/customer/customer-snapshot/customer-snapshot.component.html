<div class="theme-blue p-6 md:p-8" *ngIf="customerData">
  <!-- Header -->
  <header class="customer-header">
  <!-- Avatar -->
  <div class="avatar-container">
    <img *ngIf="customerData.customer.profileImg" 
         [src]="customerData.customer.profileImg" 
         alt="Profile Image"
         class="avatar-img">
    <span *ngIf="!customerData.customer.profileImg">
      {{ customerData.customer.fullname.charAt(0) }}
    </span>
  </div>

  <!-- Name + Contact -->
  <div class="flex-grow">
    <h1 class="m-0 text-3xl font-bold">
      {{ customerData.customer.fullname | titlecase }}
    </h1>
    <div class="customer-subinfo">
      <span class="flex items-center gap-2">
        <i class="pi pi-envelope"></i> {{ customerData.customer.email }}
      </span>
      <span class="flex items-center gap-2">
        <i class="pi pi-phone"></i> {{ customerData.customer.mobileNumber }}
      </span>
    </div>
  </div>

  <!-- Metrics aligned to right -->
  <div class="flex items-center gap-8 pr-4">
    <div class="text-center">
      <div class="metric-label">Lifetime Value</div>
      <div class="metric-value">
        {{ customerData.lifetimeValue | currency:'INR':'symbol':'1.0-0' }}
      </div>
    </div>
    <div class="text-center">
      <div class="metric-label">Overdue Invoices</div>
      <div class="metric-value text-[var(--theme-error-primary)]">
        {{ customerData.overdueInvoices.length }}
      </div>
    </div>
    <div class="text-center">
      <div class="metric-label">Member Since</div>
      <div class="metric-value">
        {{ customerData.customer.createdAt | date: 'MMM yyyy' }}
      </div>
    </div>
    <p-tag [value]="customerData.customer.status" 
           [severity]="getStatusSeverity(customerData.customer.status)" 
           [rounded]="true">
    </p-tag>
  </div>
</header>


  <!-- Metrics -->
  <section class="grid grid-cols-1 gap-6 my-8">
    <div class="metric-card">
      <label class="metric-label">Product Preferences</label>
      <div class="flex flex-wrap gap-2 mt-3">
        <p-tag *ngFor="let pref of customerData.productPreferences" [value]="pref.product + ' (x' + pref.quantity + ')'"
          severity="info" [rounded]="true" class="px-3 py-1 text-sm">
        </p-tag>
      </div>
    </div>
  </section>
  <main>
    <p-tabView>
      <p-tabPanel header="Recent Activity">
        <p-table [value]="customerData.recentActivity.invoices" [paginator]="true" [rows]="5" responsiveLayout="scroll">
          <ng-template pTemplate="header">
            <tr>
              <th>Invoice #</th>
              <th>Date</th>
              <th>Due Date</th>
              <th class="text-right">Amount</th>
              <th class="text-center">Status</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-invoice>
            <tr>
              <td>{{ invoice.invoiceNumber }}</td>
              <td>{{ invoice.invoiceDate | date: 'mediumDate' }}</td>
              <td>{{ invoice.dueDate | date: 'mediumDate' }}</td>
              <td class="text-right font-semibold">{{ invoice.totalAmount | currency:'INR' }}</td>
              <td class="text-center">
                <p-tag [value]="invoice.status" [severity]="getStatusSeverity(invoice.status)" [rounded]="true"></p-tag>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </p-tabPanel>

      <!-- Overdue Invoices -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <i class="pi pi-exclamation-triangle mr-2 text-[var(--theme-error-primary)]"></i>
          <span class="font-bold text-[var(--theme-error-primary)]">Overdue Invoices</span>
          <p-tag [value]="customerData.overdueInvoices.length" severity="danger" class="ml-2"></p-tag>
        </ng-template>
        <p-table [value]="customerData.overdueInvoices" [paginator]="true" [rows]="5" responsiveLayout="scroll">
          <ng-template pTemplate="header">
            <tr>
              <th>Invoice #</th>
              <th>Due Date</th>
              <th class="text-right">Amount</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-invoice>
            <tr>
              <td>{{ invoice.invoiceNumber }}</td>
              <td>{{ invoice.dueDate | date: 'mediumDate' }}</td>
              <td class="text-right font-semibold">{{ invoice.totalAmount | currency:'INR' }}</td>
            </tr>
          </ng-template>
        </p-table>
      </p-tabPanel>

      <!-- Addresses -->
      <p-tabPanel header="Contact & Address">
        <div class="glass-card" *ngFor="let address of customerData.customer.addresses">
          <h3 class="m-0 font-semibold flex items-center gap-2">
            <i class="pi pi-map-marker text-[var(--theme-accent-primary)]"></i>
            {{ address.type | titlecase }} Address
          </h3>
          <p class="mt-2 text-[var(--theme-text-secondary)] text-sm leading-relaxed">
            {{ address.street }}, {{ address.city }}, {{ address.state }} <br>
            {{ address.country }} - {{ address.zipCode }}
          </p>
        </div>
      </p-tabPanel>
    </p-tabView>
  </main>
</div>