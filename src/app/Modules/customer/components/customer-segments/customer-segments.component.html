<p-toast></p-toast>
<div class="card">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-xl font-bold text-[var(--theme-text-primary)]">Customer Segments & Analytics</h1>
  </div>

  <p-tabView styleClass="modern-tabview">
    <!-- High Value Customers -->
    <p-tabPanel header="High Value">
      <app-shared-grid
        [rowSelectionMode]="'multiple'"
        gridHeight="35vh"
        [data]="customerSegments?.highValue"
        [column]="highValueColumns"
        (eventFromGrid)="eventFromGrid($event)">
      </app-shared-grid>
    </p-tabPanel>

    <!-- Recent Customers -->
    <p-tabPanel header="Recent">
      <app-shared-grid
        [rowSelectionMode]="'multiple'"
        gridHeight="35vh"
        [data]="customerSegments?.recentCustomers"
        [column]="recentColumns"
        (eventFromGrid)="eventFromGrid($event)">
      </app-shared-grid>
    </p-tabPanel>

    <!-- At Risk Customers -->
    <p-tabPanel>
      <ng-template pTemplate="header">
        <div class="flex items-center gap-2">
          <i class="pi pi-exclamation-triangle text-orange-500"></i>
          <span class="font-semibold text-orange-500">At Risk</span>
          <p-tag [value]="customerSegments?.atRisk?.length || 0" [severity]="'danger'"></p-tag>
        </div>
      </ng-template>

      <ng-container *ngIf="customerSegments?.atRisk?.length; else noRiskTpl">
        <app-shared-grid
          [rowSelectionMode]="'multiple'"
          gridHeight="35vh"
          [data]="customerSegments?.atRisk"
          [column]="atRiskColumns"
          (eventFromGrid)="eventFromGrid($event)">
        </app-shared-grid>
      </ng-container>

      <ng-template #noRiskTpl>
        <div class="no-data-template">
          <i class="pi pi-shield text-4xl text-green-500"></i>
          <h3 class="text-lg font-semibold mt-4">All Good!</h3>
          <p class="text-sm text-[var(--theme-text-secondary)]">No customers are currently at risk.</p>
        </div>
      </ng-template>
    </p-tabPanel>

    <!-- Sales Forecast -->
    <p-tabPanel header="Sales Forecast">
      <div class="mb-4">
        <p-tag severity="info" styleClass="text-lg" [value]="'ðŸ“ˆ Forecast Next Month: ' + (salesForecast?.forecast?.nextMonth | currency:'INR':'symbol':'1.0-0')"></p-tag>
      </div>
      <app-shared-grid
        gridHeight="35vh"
        [data]="salesForecast?.historicalData"
        [column]="salesColumns">
      </app-shared-grid>
    </p-tabPanel>
  </p-tabView>
</div>
