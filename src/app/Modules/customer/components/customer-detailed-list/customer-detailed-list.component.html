
<div class="customer-view-container">
  <p-toast></p-toast>

  <!-- Header -->
  <div class="card header-card">
    <div class="flex gap-6">
      <h2 class="page-title">Customer Details</h2>
      <div class="header-actions">
        <p-select appendTo="body" [(ngModel)]="customerId" (onChange)="getCustomerDetail()"
          [options]="customerIDDropdown" optionLabel="fullname" optionValue="_id" placeholder="Select a Customer"
          [filter]="true" filterBy="fullname" styleClass="filter-input filter-input-lg">
        </p-select>
      </div>
    </div>
  </div>

  <!-- Content -->
  <ng-container *ngIf="!isLoading && customer">

    <!-- Profile + Financials (side by side row) -->
    <div class="row-grid">
      <!-- Profile Card -->
      <div class="card profile-card">
        <div class="profile-header">
          <p-avatar [image]="customer.profileImg" [label]="commonMethod.getInitials(customer.fullname)" shape="circle"
            styleClass="profile-avatar">
          </p-avatar>
          <div>
            <h3 class="profile-name">{{ customer.fullname }}</h3>
            <p class="profile-email">{{ customer.email }}</p>
            <p-tag [value]="customer.status" [severity]="commonMethod.getInvoiceStatusSeverity(customer.status)"
              styleClass="status-tag">
            </p-tag>
          </div>
        </div>

        <!-- Contact Info -->
        <div class="profile-details grid-2col">
          <div class="detail-box">
            <span class="label">ğŸ“± Phone</span>
            <span class="value">{{ customer.mobileNumber || 'N/A' }}</span>
          </div>
          <div class="detail-box">
            <span class="label">ğŸ“§ Email</span>
            <span class="value">{{ customer.email }}</span>
          </div>
          <div class="detail-box" *ngIf="customer.addresses?.length">
            <span class="label">ğŸ  Address</span>
            <span class="value">
              {{ customer.addresses[0].street }}, {{ customer.addresses[0].city }},
              {{ customer.addresses[0].state }} - {{ customer.addresses[0].zipCode }},
              {{ customer.addresses[0].country }}
            </span>
          </div>
          <div class="detail-box">
            <span class="label">ğŸ“… Joined</span>
            <span class="value">{{ customer.createdAt | date:'mediumDate' }}</span>
          </div>
        </div>
      </div>

      <!-- Financial Overview Card -->
      <div class="card financial-card">
        <h3 class="section-header">ğŸ’° Financial Overview</h3>
        <div class="financial-stats">
          <div class="stat-box positive">
            <i class="pi pi-shopping-cart"></i>
            <div>
              <span class="label">Total Purchased</span>
              <span class="value">{{ commonMethod.formatCurrency(customer.totalPurchasedAmount) }}</span>
            </div>
          </div>
          <div class="stat-box negative">
            <i class="pi pi-exclamation-triangle"></i>
            <div>
              <span class="label">Amount Due</span>
              <span class="value">{{ commonMethod.formatCurrency(customer.remainingAmount) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- Purchase & Payment History (side by side row) -->
    <div class="row-grid">
      <!-- Purchases -->
      <div class="card">
        <h3 class="section-header">ğŸ›’ Purchase History</h3>
        <div class="timeline-container colorful-timeline card-container">
          <p-timeline [value]="customer.cart?.items" layout="vertical" align="alternate">
            <ng-template pTemplate="content" let-item>
              <div class="timeline-card purchase">
                <div class="font-bold">{{ item.productId?.title }}</div>
                <div class="timeline-subtext">
                  {{ commonMethod.formatCurrency(item.productId?.price) }}
                </div>
                <div class="timeline-meta">
                  Invoice: {{ item.invoiceIds?.[0]?.invoiceNumber }}
                </div>
              </div>
            </ng-template>
          </p-timeline>
        </div>
      </div>

      <!-- Payments -->
      <div class="card">
        <h3 class="section-header">ğŸ’³ Payment History</h3>
        <div class="timeline-container colorful-timeline card-container">
          <p-timeline [value]="customer.paymentHistory" layout="vertical" align="alternate">
            <ng-template pTemplate="content" let-payment>
              <span class="timeline-marker" [ngClass]="'bg-' + getStatusSeverity(payment.status) + '-500'">
                <i class="pi" [ngClass]="{
                    'pi-check': payment.status === 'completed',
                    'pi-wallet': payment.status !== 'completed'
                  }">
                </i>
              </span>
            </ng-template>
            <ng-template pTemplate="content" let-payment>
              <div class="timeline-card purchase" [ngClass]="getStatusSeverity(payment.status)">
                <div class="font-bold">{{ commonMethod.formatCurrency(payment.amount) }}</div>
                <div class="timeline-subtext">{{ payment.createdAt | date:'mediumDate' }}</div>
                <p-tag [value]="payment.status" [severity]="getStatusSeverity(payment.status)"
                  styleClass="status-tag"></p-tag>
              </div>
            </ng-template>
          </p-timeline>
        </div>
      </div>
    </div>
  </ng-container>
</div>