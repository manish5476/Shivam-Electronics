<div id="invoice-print-section" class="p-4"
     [style.backgroundColor]="'var(--theme-bg-main)'"
     [style.color]="'var(--theme-text-primary)'">

  <!-- Invoice Selection Dropdown -->
  <p-select appendTo="body" [(ngModel)]="Id" (onChange)="getCustomerdata()" [options]="invoiceDropDown"
    optionLabel="invoiceNumber" optionValue="_id" placeholder="Select Invoice"
    class="w-full mb-6 rounded-md overflow-hidden"
    [style.backgroundColor]="'var(--theme-bg-tertiary)'"
    [style.color]="'var(--theme-text-primary)'"
    [style.borderColor]="'var(--theme-border-secondary)'"
    panelStyleClass="bg-[var(--theme-bg-secondary)] border-[var(--theme-border-primary)] shadow-lg rounded-md">
  </p-select>

  <div  class="space-y-6 w-full max-w-screen-xl mx-auto">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
      <h1 class="text-3xl font-bold text-center sm:text-left"
          [style.color]="'var(--theme-text-heading)'">Invoice Details</h1>
      <button (click)="printInvoice()"
        class="px-6 py-2 rounded-md shadow-lg flex items-center gap-2 transition-all duration-300 ease-in-out"
        [style.backgroundColor]="'var(--theme-button-bg-primary)'"
        [style.color]="'var(--theme-button-text-primary-btn)'"
        (mouseenter)="onPrintButtonHover($event, true)"
        (mouseleave)="onPrintButtonHover($event, false)">
        <i class="pi pi-print"></i> Print Invoice
      </button>
    </div>

    <!-- Invoice Info -->
    <div class="rounded-lg border shadow-md"
         [style.backgroundColor]="'var(--theme-bg-secondary)'"
         [style.borderColor]="'var(--theme-border-primary)'"
         (mouseenter)="onCardHover($event, true)"
         (mouseleave)="onCardHover($event, false)">
      <div class="px-4 py-3 border-b"
           [style.borderColor]="'var(--theme-border-primary)'">
        <h2 class="text-lg font-semibold flex items-center gap-2"
            [style.color]="'var(--theme-text-heading)'">
          <i class="pi pi-file-invoice" [style.color]="'var(--theme-brand-primary)'"></i> Invoice Information
        </h2>
      </div>
      <div class="divide-y p-2" [style.borderColor]="'var(--theme-border-secondary)'">
        <div class="px-2 py-2 grid grid-cols-1 sm:grid-cols-3 gap-2">
          <dt class="font-medium" [style.color]="'var(--theme-text-secondary)'">Number</dt>
          <dd class="col-span-2" [style.color]="'var(--theme-text-primary)'">{{ invoiceData.invoiceNumber || 'N/A' }}</dd>
        </div>
        <div class="px-2 py-2 grid grid-cols-1 sm:grid-cols-3 gap-2">
          <dt class="font-medium" [style.color]="'var(--theme-text-secondary)'">Date</dt>
          <dd class="col-span-2" [style.color]="'var(--theme-text-primary)'">{{ invoiceData.invoiceDate | date:'longDate' }}</dd>
        </div>
        <div class="px-2 py-2 grid grid-cols-1 sm:grid-cols-3 gap-2">
          <dt class="font-medium" [style.color]="'var(--theme-text-secondary)'">Due Date</dt>
          <dd class="col-span-2" [style.color]="'var(--theme-text-primary)'">{{ invoiceData.dueDate | date:'longDate' }}</dd>
        </div>
        <div class="px-2 py-2 grid grid-cols-1 sm:grid-cols-3 gap-2 items-center">
          <dt class="font-medium" [style.color]="'var(--theme-text-secondary)'">Status</dt>
          <dd class="col-span-2">
            <p-tag [value]="invoiceData.status" [severity]="getStatusSeverity(invoiceData.status)"></p-tag>
          </dd>
        </div>
        <div class="px-2 py-2 grid grid-cols-1 sm:grid-cols-3 gap-2">
          <dt class="font-medium" [style.color]="'var(--theme-text-secondary)'">Place of Supply</dt>
          <dd class="col-span-2" [style.color]="'var(--theme-text-primary)'">{{ invoiceData.placeOfSupply || 'N/A' }}</dd>
        </div>
        <div class="px-2 py-2 grid grid-cols-1 sm:grid-cols-3 gap-2">
          <dt class="font-medium" [style.color]="'var(--theme-text-secondary)'">Payment Terms</dt>
          <dd class="col-span-2" [style.color]="'var(--theme-text-primary)'">{{ invoiceData.paymentTerms || 'N/A' }}</dd>
        </div>
        <div class="px-2 py-2 grid grid-cols-1 sm:grid-cols-3 gap-2">
          <dt class="font-medium" [style.color]="'var(--theme-text-secondary)'">Notes</dt>
          <dd class="col-span-2 whitespace-pre-line" [style.color]="'var(--theme-text-primary)'">{{ invoiceData.notes || 'N/A' }}</dd>
        </div>
      </div>
    </div>

    <!-- Seller and Buyer Details -->
    <div class="flex flex-col lg:flex-row gap-6">
      <div class="rounded-lg border shadow-md w-full"
           [style.backgroundColor]="'var(--theme-bg-secondary)'"
           [style.borderColor]="'var(--theme-border-primary)'"
           (mouseenter)="onCardHover($event, true)"
           (mouseleave)="onCardHover($event, false)">
        <div class="px-4 py-3 border-b"
             [style.borderColor]="'var(--theme-border-primary)'">
          <h2 class="text-lg font-semibold flex items-center gap-2"
              [style.color]="'var(--theme-text-heading)'">
            <i class="pi pi-user" [style.color]="'var(--theme-brand-primary)'"></i> Seller Details
          </h2>
        </div>
        <div class="divide-y p-2" [style.borderColor]="'var(--theme-border-secondary)'">
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 py-2"
            *ngFor="let key of ['name','shopname','gstin','pan','contactNumber','address','createdAt','updatedAt']">
            <dt class="font-medium capitalize" [style.color]="'var(--theme-text-secondary)'">{{ key }}</dt>
            <dd class="col-span-2 truncate" [style.color]="'var(--theme-text-primary)'">{{ invoiceData.sellerDetails?.[key] || 'N/A' }}</dd>
          </div>
        </div>
      </div>

      <div class="rounded-lg border shadow-md w-full"
           [style.backgroundColor]="'var(--theme-bg-secondary)'"
           [style.borderColor]="'var(--theme-border-primary)'"
           (mouseenter)="onCardHover($event, true)"
           (mouseleave)="onCardHover($event, false)">
        <div class="px-4 py-3 border-b"
             [style.borderColor]="'var(--theme-border-primary)'">
          <h2 class="text-lg font-semibold flex items-center gap-2"
              [style.color]="'var(--theme-text-heading)'">
            <i class="pi pi-user-plus" [style.color]="'var(--theme-accent-primary)'"></i> Buyer Details
          </h2>
        </div>
        <div class="divide-y p-2" [style.borderColor]="'var(--theme-border-secondary)'">
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 py-2">
            <dt class="font-medium" [style.color]="'var(--theme-text-secondary)'">Name</dt>
            <dd class="col-span-2" [style.color]="'var(--theme-text-primary)'">{{ invoiceData.buyerDetails?.fullname || 'N/A' }}</dd>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 py-2">
            <dt class="font-medium" [style.color]="'var(--theme-text-secondary)'">Address</dt>
            <dd class="col-span-2 whitespace-pre-line" [style.color]="'var(--theme-text-primary)'">
              {{ invoiceData.buyerDetails?.addresses?.[0]?.street || 'N/A' }},
              {{ invoiceData.buyerDetails?.addresses?.[0]?.city || '' }}
              {{ invoiceData.buyerDetails?.addresses?.[0]?.state || '' }}
              {{ invoiceData.buyerDetails?.addresses?.[0]?.zipCode || '' }}
            </dd>
          </div>
        </div>
      </div>
    </div>

    <!-- Items Table -->
    <div class="rounded-lg border shadow-md overflow-hidden"
         [style.backgroundColor]="'var(--theme-bg-secondary)'"
         [style.borderColor]="'var(--theme-border-primary)'"
         (mouseenter)="onCardHover($event, true)"
         (mouseleave)="onCardHover($event, false)">
      <div class="px-4 py-3 border-b"
           [style.borderColor]="'var(--theme-border-primary)'">
        <h2 class="text-lg font-semibold flex items-center gap-2"
            [style.color]="'var(--theme-text-heading)'">
          <i class="pi pi-list" [style.color]="'var(--theme-brand-primary)'"></i> Items
        </h2>
      </div>
      <div class="overflow-x-auto"> <!-- Added for responsiveness on small screens -->
        <p-table [value]="invoiceData.items"
                 styleClass="p-datatable-sm p-datatable-striped"
                 [tableStyle]="{ 'min-width': '65rem' }"
                 responsiveLayout="scroll">
          <ng-template pTemplate="header">
            <tr [style.backgroundColor]="'var(--theme-bg-tertiary)'"
                [style.color]="'var(--theme-text-label)'">
              <th class="p-2">Item</th>
              <th class="text-right p-2">Qty</th>
              <th class="text-right p-2">Rate</th>
              <th class="text-right p-2">Discount</th>
              <th class="text-right p-2">Taxable</th>
              <th class="text-right p-2">CGST</th>
              <th class="text-right p-2">SGST</th>
              <th class="text-right p-2">Amount</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-item>
            <tr [style.backgroundColor]="'var(--theme-bg-secondary)'"
                [style.color]="'var(--theme-text-primary)'">
              <td class="p-2">{{ item.itemDetails?.title || 'N/A' }}</td>
              <td class="text-right p-2">{{ item.quantity }}</td>
              <td class="text-right p-2">{{ item.rate | currency:'INR' }}</td>
              <td class="text-right p-2">{{ item.discount | currency:'INR' }}</td>
              <td class="text-right p-2">{{ item.taxableValue | currency:'INR' }}</td>
              <td class="text-right p-2">{{ item.cgstAmount | currency:'INR' }} ({{ item.cgstRate }}%)</td>
              <td class="text-right p-2">{{ item.sgstAmount | currency:'INR' }} ({{ item.sgstRate }}%)</td>
              <td class="text-right font-medium p-2">{{ item.amount | currency:'INR' }}</td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="8" class="text-center py-4" [style.color]="'var(--theme-text-secondary)'">No items found in this invoice.</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>

    <!-- Financial Summary -->
    <div class="rounded-lg border shadow-md"
         [style.backgroundColor]="'var(--theme-bg-secondary)'"
         [style.borderColor]="'var(--theme-border-primary)'"
         (mouseenter)="onCardHover($event, true)"
         (mouseleave)="onCardHover($event, false)">
      <div class="px-4 py-3 border-b"
           [style.borderColor]="'var(--theme-border-primary)'">
        <h2 class="text-lg font-semibold flex items-center gap-2"
            [style.color]="'var(--theme-text-heading)'">
          <i class="pi pi-wallet" [style.color]="'var(--theme-success-primary)'"></i> Financial Summary
        </h2>
      </div>
      <div class="divide-y px-4 py-2" [style.borderColor]="'var(--theme-border-secondary)'">
        <div class="flex justify-between py-2">
          <span [style.color]="'var(--theme-text-secondary)'">Sub Total</span>
          <span [style.color]="'var(--theme-text-primary)'">{{ invoiceData.subTotal | currency:'INR' }}</span>
        </div>
        <div class="flex justify-between py-2">
          <span [style.color]="'var(--theme-error-primary)'">Total Discount</span>
          <span [style.color]="'var(--theme-error-primary)'">({{ invoiceData.totalDiscount | currency:'INR' }})</span>
        </div>
        <div class="flex justify-between py-2">
          <span [style.color]="'var(--theme-text-primary)'">Total Tax (CGST+SGST/IGST)</span>
          <span [style.color]="'var(--theme-text-primary)'">{{ (invoiceData.igst || 0) + (invoiceData.totalCGST || 0) + (invoiceData.totalSGST || 0) | currency:'INR' }}</span>
        </div>
        <div class="flex justify-between py-2">
          <span [style.color]="'var(--theme-text-primary)'">CESS</span>
          <span [style.color]="'var(--theme-text-primary)'">{{ invoiceData.cess | currency:'INR' }}</span>
        </div>
        <div class="flex justify-between border-t pt-3 mt-3"
             [style.borderColor]="'var(--theme-border-primary)'">
          <span class="text-lg font-semibold" [style.color]="'var(--theme-text-heading)'">Grand Total</span>
          <span class="text-xl font-bold" [style.color]="'var(--theme-success-primary)'">{{ invoiceData.totalAmount | currency:'INR' }}</span>
        </div>
      </div>
    </div>
  </div>
</div>
