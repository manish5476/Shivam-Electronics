<div class="invoice-container" [formGroup]="invoiceForm">
  <div class="main-card-v2">
    <div class="form-header">
      <h2 class="form-title"><i class="pi pi-receipt"></i> GST Invoice</h2>
      <button (click)="resetForm()">refresh</button>
    </div>
    <div class="form-section-card">
      <div class="responsive-grid grid-cols-5">
        <div class="form-group">
          <label for="invoiceNumber">Invoice No*</label>
          <input id="invoiceNumber" type="text" pInputText class="themed-input" formControlName="invoiceNumber"
            readonly />
        </div>
        <div class="form-group">
          <label for="invoiceDate">Invoice Date*</label>
          <input id="invoiceDate" type="date" pInputText class="themed-input" formControlName="invoiceDate" readonly />
        </div>
        <div class="form-group">
          <label for="dueDate">Due Date</label>
          <input id="dueDate" type="date" pInputText class="themed-input" formControlName="dueDate" readonly />
        </div>
        <div class="form-group">
          <label for="seller">Billed By</label>
          <p-select id="seller" formControlName="seller" [options]="InvoiceObject.sellersDrop" optionLabel="name"
            optionValue="_id" placeholder="Select Seller" appendTo="body" styleClass="themed-select"
            panelStyleClass="themed-panel"></p-select>
        </div>
        <div class="form-group">
          <label for="buyer">Billed To</label>
          <p-select id="buyer" formControlName="buyer" [options]="InvoiceObject.customerIDDropdown"
            optionLabel="fullname" optionValue="_id" placeholder="Select Buyer" appendTo="body"
            styleClass="themed-select" panelStyleClass="themed-panel"></p-select>
        </div>
      </div>
    </div>

    <div class="form-section-card">
      <h3 class="section-header"><i class="pi pi-list"></i> Invoice Items</h3>
      <div class="table-wrapper">
        <table class="items-table">
          <thead>
            <tr>
              <th style="width: 25%;">Item</th>
              <th>GST (%)</th>
              <th>Qty</th>
              <th>Rate</th>
              <th>Discount (%)</th>
              <th>Taxable</th>
              <th>GST Amt</th>
              <th>Total</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody formArrayName="items">
            <tr *ngFor="let itemFormGroup of itemsFormArray.controls; let i = index" [formGroupName]="i">
              <td><p-select formControlName="product" [options]="InvoiceObject.productdrop" optionLabel="title"
                  class="w-full" optionValue="_id" (onChange)="onProductChange($event, i)"
                  (ngModelChange)="onItemValueChange(i)" appendTo="body" styleClass="themed-select"
                  panelStyleClass="themed-panel"></p-select></td>
              <td><input type="number" pInputText class="themed-input" formControlName="gstRate"
                  (ngModelChange)="onItemValueChange(i)" /></td>
              <td><input type="number" pInputText class="themed-input" formControlName="quantity"
                  (ngModelChange)="onItemValueChange(i)" /></td>
              <td><input type="number" pInputText class="themed-input" formControlName="rate"
                  (ngModelChange)="onItemValueChange(i)" /></td>
              <td><input type="number" pInputText class="themed-input" formControlName="discount"
                  (ngModelChange)="onItemValueChange(i)" /></td>
              <td><input type="number" pInputText class="themed-input" formControlName="taxableValue" readonly /></td>
              <td><input type="number" pInputText class="themed-input" formControlName="gstAmount" readonly /></td>
              <td><input type="number" pInputText class="themed-input" formControlName="amount" readonly /></td>
              <td class="actions-cell flex">
                <button pButton type="button" icon="pi pi-plus" (click)="addItem()" class="p-button-success p-button-sm"
                  pTooltip="Add Item"></button>
                <button pButton type="button" icon="pi pi-trash" (click)="removeItem(i)"
                  class="p-button-danger p-button-sm" pTooltip="Remove Item"></button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="summary-grid">
      <div class="summary-options">
        <div class="form-group">
          <label for="placeOfSupply">Place of Supply</label>
          <input id="placeOfSupply" type="text" pInputText class="themed-input" formControlName="placeOfSupply" />
        </div>
        <div class="form-group">
          <label>Rounding Options</label>
          <div class="checkbox-group">
            <div class="p-field-checkbox">
              <p-checkbox formControlName="roundUp" [binary]="true" inputId="roundUp"
                (onChange)="calculateInvoiceTotals()"></p-checkbox>
              <label for="roundUp">Round Up</label>
            </div>
            <div class="p-field-checkbox">
              <p-checkbox formControlName="roundDown" [binary]="true" inputId="roundDown"
                (onChange)="calculateInvoiceTotals()"></p-checkbox>
              <label for="roundDown">Round Down</label>
            </div>
          </div>
        </div>
      </div>

      <div class="summary-calculations">
        <div class="calc-row"><span class="calc-label">Sub Total</span><span class="calc-value">{{
            invoiceForm.get('subTotal')?.value | currency:'INR' }}</span></div>
        <div class="calc-row"><span class="calc-label">GST</span><span class="calc-value">{{
            invoiceForm.get('gst')?.value | currency:'INR' }}</span></div>
        <div class="calc-row"><span class="calc-label">CESS</span><span class="calc-value">{{
            invoiceForm.get('cess')?.value | currency:'INR' }}</span></div>
        <div class="calc-row"><span class="calc-label">Discount</span><span class="calc-value discount-value">{{
            invoiceForm.get('totalDiscount')?.value | currency:'INR' }}</span></div>
        <div class="calc-row"><span class="calc-label">Taxable Value</span><span class="calc-value">{{
            invoiceForm.get('taxableValue')?.value | currency:'INR' }}</span></div>
        <div class="total-row">
          <span class="total-label">Total Amount</span>
          <span class="total-value">{{ invoiceForm.get('totalAmount')?.value | currency:'INR' }}</span>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button pButton type="button" label="Save & Continue" icon="pi pi-save" (click)="saveInvoice()"></button>
    </div>
  </div>
</div>

<p-toast></p-toast>