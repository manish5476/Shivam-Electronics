<div class="invoice doc-surface" *ngIf="invoiceData">

  <!-- Header -->
  <div class="brandbar">
    <div class="brand-left">
      <div>
        <h2 class="brand-title">{{ invoiceData?.sellerDetails?.shopName }}</h2>
        <p class="brand-tag">{{ invoiceData?.sellerDetails?.name }}</p>
        <p class="brand-contact">GSTIN: {{ invoiceData?.sellerDetails?.gstin }}</p>
        <p class="brand-contact">Ph: {{ invoiceData?.sellerDetails?.contactNumber }}</p>
        <p class="brand-contact">
          {{ invoiceData?.sellerDetails?.address?.street }},
          {{ invoiceData?.sellerDetails?.address?.city }},
          {{ invoiceData?.sellerDetails?.address?.state }} - {{ invoiceData?.sellerDetails?.address?.pincode }}
        </p>
      </div>
    </div>

    <div class="invoice-pill">
      <div class="pill-row"><span class="pill-label">Invoice No:</span><span class="pill-value">{{
          invoiceData?.invoiceNumber }}</span></div>
      <div class="pill-row"><span class="pill-label">Date:</span><span class="pill-value">{{ invoiceData?.invoiceDate |
          date:'dd/MM/yyyy' }}</span></div>
      <div class="pill-row"><span class="pill-label">Due Date:</span><span class="pill-value">{{ invoiceData?.dueDate |
          date:'dd/MM/yyyy' }}</span></div>
      <div class="pill-row"><span class="pill-label">Status:</span><span class="pill-value">{{ invoiceData?.status |
          uppercase }}</span></div>
    </div>
  </div>

  <!-- Parties -->
  <div class="parties">
    <div class="party-card">
      <h4 class="card-head">Bill To</h4>
      <div class="card-body">
        <p class="party-name">{{ invoiceData?.buyerDetails?.fullname }}</p>
        <p class="muted">GSTIN: {{ invoiceData?.buyerDetails?.gstin || 'N/A' }}</p>
        <p class="muted">{{ invoiceData?.buyerDetails?.addresses?.[0]?.street }},
          {{ invoiceData?.buyerDetails?.addresses?.[0]?.city }},
          {{ invoiceData?.buyerDetails?.addresses?.[0]?.state }},
          {{ invoiceData?.buyerDetails?.addresses?.[0]?.zipCode }}</p>
        <p class="muted">Ph: {{ invoiceData?.buyerDetails?.phoneNumbers?.[0]?.number }}</p>
      </div>
    </div>

    <div class="party-card">
      <h4 class="card-head">Seller</h4>
      <div class="card-body">
        <p class="party-name">{{ invoiceData?.sellerDetails?.shopName }}</p>
        <p class="muted">PAN: {{ invoiceData?.sellerDetails?.pan }}</p>
        <p class="muted">Bank: {{ invoiceData?.sellerDetails?.bankDetails?.bankName }} ({{
          invoiceData?.sellerDetails?.bankDetails?.branch }})</p>
        <p class="muted">A/C: {{ invoiceData?.sellerDetails?.bankDetails?.accountNumber }}</p>
        <p class="muted">IFSC: {{ invoiceData?.sellerDetails?.bankDetails?.ifscCode }}</p>
      </div>
    </div>
  </div>

  <!-- Items -->
  <div class="items">
    <table class="items-table">
      <thead>
        <tr>
          <th class="th-sm">#</th>
          <th>Description</th>
          <th>HSN/SAC</th>
          <th>Qty</th>
          <th>Rate</th>
          <th>Discount</th>
          <th>Taxable</th>
          <th>GST %</th>
          <th>GST Amt</th>
          <th class="right">Amount</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of invoiceData?.items; let i = index">
          <td>{{ i+1 }}</td>
          <td class="wrap">{{ item.customTitle || invoiceData?.itemDetails[i]?.title }}</td>
          <td>{{ item.hsnSac || 'â€”' }}</td>
          <td>{{ item.quantity }}</td>
          <td>{{ item.rate | currency:'INR' }}</td>
          <td>{{ item.discount | currency:'INR' }}</td>
          <td>{{ item.taxableValue | currency:'INR' }}</td>
          <td>{{ item.gstRate }}%</td>
          <td>{{ item.gstAmount | currency:'INR' }}</td>
          <td class="right strong">{{ item.amount | currency:'INR' }}</td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="9" class="right strong">Sub Total</td>
          <td class="right">{{ invoiceData?.subTotal | currency:'INR' }}</td>
        </tr>
        <tr>
          <td colspan="9" class="right strong">Discount</td>
          <td class="right">{{ invoiceData?.totalDiscount | currency:'INR' }}</td>
        </tr>
        <tr>
          <td colspan="9" class="right strong">GST</td>
          <td class="right" >{{ invoiceData?.gst | currency:'INR' }}</td>
        </tr>
        <tr class="grand">
          <td colspan="9" class="right strong">TOTAL</td>
          <td class="right">{{ invoiceData?.totalAmount | currency:'INR' }}</td>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- Amount in Words -->
  <div class="amount-words">
    <span>Amount in Words:</span>
    <span class="words">Rupees {{ convertNumberToWords(invoiceData?.totalAmount) }} Only</span>
  </div>

  <!-- Notes & Payment -->
  <div class="notes-pay">
    <div class="notes">
      <h4 class="card-head">Notes</h4>
      <p>{{ invoiceData?.notes || 'Thank you for your business!' }}</p>
    </div>
    <div class="pay">
      <h4 class="card-head">Payment</h4>
      <canvas id="upi-qrcode" class="qr"></canvas>
      <p>Bank: {{ invoiceData?.sellerDetails?.bankDetails?.bankName }}</p>
      <p>A/C: {{ invoiceData?.sellerDetails?.bankDetails?.accountNumber }}</p>
      <p>IFSC: {{ invoiceData?.sellerDetails?.bankDetails?.ifscCode }}</p>
    </div>
  </div>

  <!-- Signature -->
  <div class="signature">
    <div></div>
    <div class="sig-box">
      <div class="sig-line"></div>
      <p class="issuer">Authorised Signatory</p>
    </div>
  </div>
</div>

<!-- Actions -->
<div class="actions">
  <button class="btn-primary" (click)="printInvoice()">Print</button>
  <button class="btn-primary" (click)="downloadPDF()">Download PDF</button>
</div>

