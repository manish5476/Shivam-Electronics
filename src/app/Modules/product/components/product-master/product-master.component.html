<div class="product-form-container">
  <div class="main-card-v2">

    <div class="form-header">
      <h2 class="form-title"><i class="pi pi-box"></i> Manage Product</h2>
      <div class="form-controls">
        <p-select [options]="productsForDropdown" [(ngModel)]="selectedProductId" optionLabel="title" optionValue="_id"
          placeholder="Select a Product to Edit" [showClear]="true" (onChange)="fetchProductDetails()"
          styleClass="themed-select product-selector">
        </p-select>
        <button pButton type="button" icon="pi pi-search" (click)="fetchProductDetails()"
          [disabled]="!selectedProductId" pTooltip="Load Product" tooltipPosition="bottom"></button>
        <button pButton type="button" label="New" icon="pi pi-plus" (click)="resetForm()"
          class="p-button-outlined"></button>
      </div>
    </div>

    <form (ngSubmit)="submitProduct()">
      <div class="form-section-card">
        <h3 class="section-header"><i class="pi pi-info-circle"></i> Basic Information</h3>
        <div class="responsive-grid">
          <div class="form-group">
            <label for="title">Product Title <span class="required">*</span></label>
            <input id="title" type="text" pInputText class="themed-input" [(ngModel)]="product.title" name="title"
              required maxlength="200" placeholder="Enter product title..." />
          </div>
          <div class="form-group">
            <label for="description">Product Description <span class="required">*</span></label>
            <textarea id="description" pInputTextarea rows="4" class="themed-input" [(ngModel)]="product.description"
              name="description" required maxlength="500" placeholder="Describe your product in detail..."></textarea>
          </div>
        </div>
      </div>

      <div class="form-section-card">
        <h3 class="section-header"><i class="pi pi-tags"></i> Identification & Categorization</h3>
        <div class="responsive-grid">
          <div class="form-group">
            <label for="category">Category <span class="required">*</span></label>
            <input id="category" type="text" pInputText class="themed-input" [(ngModel)]="product.category"
              name="category" required placeholder="e.g., Electronics, Clothing..." />
          </div>
          <div class="form-group">
            <label for="brand">Brand <span class="required">*</span></label>
            <input id="brand" type="text" pInputText class="themed-input" [(ngModel)]="product.brand" name="brand"
              required placeholder="Brand name..." />
          </div>
          <div class="form-group">
            <label for="sku">SKU <span class="required">*</span></label>
            <input id="sku" type="text" pInputText class="themed-input" [(ngModel)]="product.sku" name="sku" required
              placeholder="Unique product code..." />
          </div>
        </div>
      </div>

      <div class="form-section-card">
        <h3 class="section-header"><i class="pi pi-dollar"></i> Pricing Configuration</h3>
        <div class="responsive-grid">
          <div class="form-group">
            <label for="rate">Base Rate (Pre-GST) <span class="required">*</span></label>
            <input id="rate" type="number" pInputText (change)="calculatePrice()" class="themed-input"
              [(ngModel)]="product.rate" name="rate" required min="0" placeholder="0.00" />
          </div>
          <div class="form-group">
            <label for="gstRate">GST Rate (%) <span class="required">*</span></label>
            <input id="gstRate" type="number" pInputText (change)="calculatePrice()" class="themed-input"
              [(ngModel)]="product.gstRate" name="gstRate" required min="0" max="100" placeholder="18" />
          </div>
          <div class="form-group">
            <label for="price">Price (Post-GST)</label>
            <input id="price" type="number" pInputText class="themed-input" [(ngModel)]="product.price" name="price"
              min="0" readonly placeholder="Auto-calculated" />
            <small class="form-hint">Auto-calculated when rate or GST changes.</small>
          </div>
          <div class="form-group">
            <label for="discountPercentage">Discount (%)</label>
            <input id="discountPercentage" type="number" pInputText class="themed-input"
              [(ngModel)]="product.discountPercentage" name="discountPercentage" min="0" max="100" placeholder="0" />
          </div>
        </div>
        <div *ngIf="product.price != null" class="price-display">
          <span>Final Price (After Discount)</span>
          <strong class="final-price-value">
            {{ (product.price || 0) - ((product.price || 0) * (product.discountPercentage || 0) / 100) |
            currency:'INR':'symbol':'1.2-2' }}
          </strong>
        </div>
      </div>

      <div class="form-section-card">
        <h3 class="section-header"><i class="pi pi-warehouse"></i> Inventory & Media</h3>
        <div class="responsive-grid">
          <div class="form-group">
            <label for="stock">Stock Quantity <span class="required">*</span></label>
            <input id="stock" type="number" pInputText class="themed-input" [(ngModel)]="product.stock" name="stock"
              required min="0" placeholder="Available quantity..." />
          </div>
          <div class="form-group">
            <label for="availabilityStatus">Availability Status <span class="required">*</span></label>
            <p-select id="availabilityStatus" [options]="availabilityOptions" styleClass="themed-select"
              [(ngModel)]="product.availabilityStatus" name="availabilityStatus" optionLabel="label" optionValue="value"
              required placeholder="Select availability status"></p-select>
          </div>
          <div class="form-group">
            <label for="tags">Tags (comma-separated)</label>
            <input id="tags" type="text" pInputText class="themed-input" [(ngModel)]="product.tags" name="tags"
              placeholder="tag1, tag2, tag3..." />
          </div>
          <div class="form-group">
            <label for="thumbnail">Thumbnail Image URL <span class="required">*</span></label>
            <input id="thumbnail" type="text" pInputText class="themed-input" [(ngModel)]="product.thumbnail"
              name="thumbnail" required placeholder="https://example.com/image.jpg" />
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button pButton type="button" label="Cancel" icon="pi pi-times" class="p-button-outlined"></button>
        <button pButton type="submit" [label]="selectedProductId ? 'Update Product' : 'Create New Product'"
          [icon]="selectedProductId ? 'pi pi-refresh' : 'pi pi-plus'"
          [disabled]="!product.title || !product.category || !product.brand || !product.sku"></button>
      </div>
    </form>

    <p-toast></p-toast>
  </div>
</div>

<!-- <div class="bg-white text-gray-900 w-full mx-auto p-2 shadow-md rounded-lg font-roboto">
    <div class="p-0px flex justify-center mb-1 p-0 items-center">
        <p-select styleClass="gradient-border" [options]="productsForDropdown" [(ngModel)]="selectedProductId"
            optionLabel="title" optionValue="_id" placeholder="Select a Product to Edit" [showClear]="true"
            (onChange)="fetchProductDetails()" class="w-full md:w-1/2">
        </p-select>
        <button pButton type="button" (click)="fetchProductDetails()"
            [disabled]="!selectedProductId">Search/Load</button>
        <button pButton type="button" label="New Product" (click)="resetForm()" class="p-button-outlined"></button>
    </div>

    <div class="container mx-auto p-4">
        <h1
            class="bg-gradient-to-r from-pink-500 to-violet-500 bg-clip-text text-4xl md:text-5xl font-extrabold text-transparent mb-1 text-center">
            Product Management
        </h1>

        <div
            class="bg-[var(--theme-bg-primary)]  border-2 border-sky-900 dark:border-sky-700 p-4 rounded-lg shadow-lg mb-1">
            <h2 class="text-xl font-semibold mb-1 text-gray-900 dark:text-gray-100">Basic Information</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <p-floatLabel>
                        <input pInputText type="text" id="title" [(ngModel)]="product.title" name="title"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required maxlength="200" />
                        <label for="title" class="text-gray-700 dark:text-gray-300">Title*</label>
                    </p-floatLabel>
                </div>
                <div>
                    <p-floatLabel>
                        <textarea id="description" name="description" pInputTextarea autoResize="true" rows="3"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required maxlength="500" [(ngModel)]="product.description"></textarea>
                        <label for="description" class="text-gray-700 dark:text-gray-300">Description*</label>
                    </p-floatLabel>
                </div>
            </div>
        </div>

        <div
            class="bg-[var(--theme-bg-primary)]  border-2 border-sky-900 dark:border-sky-700 p-4 rounded-lg shadow-lg mb-1">
            <h2 class="text-xl font-semibold mb-1 text-gray-900 dark:text-gray-100">Identification & Categorization</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <p-floatLabel>
                        <input pInputText id="category" [(ngModel)]="product.category" name="category"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required />
                        <label for="category" class="text-gray-700 dark:text-gray-300">Category*</label>
                    </p-floatLabel>
                </div>
                <div>
                    <p-floatLabel>
                        <input pInputText id="brand" [(ngModel)]="product.brand" name="brand"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required />
                        <label for="brand" class="text-gray-700 dark:text-gray-300">Brand*</label>
                    </p-floatLabel>
                </div>
                <div>
                    <p-floatLabel>
                        <input pInputText type="text" id="sku" [(ngModel)]="product.sku" name="sku"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required />
                        <label for="sku" class="text-gray-700 dark:text-gray-300">SKU*</label>
                    </p-floatLabel>
                </div>
            </div>
        </div>

        <div
            class="bg-[var(--theme-bg-primary)]  border-2 border-sky-900 dark:border-sky-700 p-4 rounded-lg shadow-lg mb-1">
            <h2 class="text-xl font-semibold mb-1 text-gray-900 dark:text-gray-100">Pricing</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div>
                    <p-floatLabel>
                        <input pInputText type="number" id="rate" [(ngModel)]="product.rate" name="rate"
                            (change)="calculatePrice()"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required min="0" />
                        <label for="rate" class="text-gray-700 dark:text-gray-300">Base Rate* (Pre-GST)</label>
                    </p-floatLabel>
                </div>
                <div>
                    <p-floatLabel>
                        <input pInputText type="number" id="gstRate" [(ngModel)]="product.gstRate" name="gstRate"
                            (change)="calculatePrice()"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required min="0" max="100" />
                        <label for="gstRate" class="text-gray-700 dark:text-gray-300">GST Rate (%)*</label>
                    </p-floatLabel>
                </div>
                <div>
                    <p-floatLabel>
                        <input pInputText type="number" id="price" [(ngModel)]="product.price" name="price"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            min="0" /> <label for="price" class="text-gray-700 dark:text-gray-300">Price
                            (Post-GST)</label>
                    </p-floatLabel>
                    <small class="text-xs text-gray-500 dark:text-gray-400">Auto-calculated on save if rate/GST
                        changes.</small>
                </div>
                <div>
                    <p-floatLabel>
                        <input pInputText type="number" id="discountPercentage" [(ngModel)]="product.discountPercentage"
                            name="discountPercentage"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            min="0" max="100" />
                        <label for="discountPercentage" class="text-gray-700 dark:text-gray-300">Discount (%)</label>
                    </p-floatLabel>
                </div>
            </div>
            <div *ngIf="product.price && product.discountPercentage" class="mt-4">
                <p class="text-gray-700 dark:text-gray-300">
                    Final Price (after discount):
                    <strong class="text-lg">{{ (product.price || 0) - (((product.price || 0) *
                        (product.discountPercentage || 0)) / 100) | currency:'USD':'symbol':'1.2-2' }}</strong>
                </p>
                <small class="text-xs text-gray-500 dark:text-gray-400">Backend calculates finalPrice based on its
                    logic.</small>
            </div>
        </div>

        <div
            class="bg-[var(--theme-bg-primary)]  border-2 border-sky-900 dark:border-sky-700 p-4 rounded-lg shadow-lg mb-1">
            <h2 class="text-xl font-semibold mb-1 text-gray-900 dark:text-gray-100">Inventory & Media</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div>
                    <p-floatLabel>
                        <input pInputText type="number" id="stock" [(ngModel)]="product.stock" name="stock"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required min="0" />
                        <label for="stock" class="text-gray-700 dark:text-gray-300">Stock Quantity*</label>
                    </p-floatLabel>
                </div>
                <div>
                    <p-floatLabel>
                        <p-dropdown id="availabilityStatus" [options]="availabilityOptions" name="availabilityStatus"
                            [(ngModel)]="product.availabilityStatus" optionLabel="label" optionValue="value"
                            styleClass="w-full"
                            inputStyleClass="p-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 border-gray-300 dark:border-gray-600"
                            panelStyleClass="dark:bg-gray-700" required>
                        </p-dropdown>
                        <label for="stock" class="text-gray-700 dark:text-gray-300">Availability
                            Status*</label>
                    </p-floatLabel>
                </div>
                <div>
                    <p-floatLabel>
                        <input pInputText type="text" id="tags" [(ngModel)]="product.tags" name="tags"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700" />
                        <label for="tags" class="text-gray-700 dark:text-gray-300">Tags (comma-separated)</label>
                    </p-floatLabel>
                </div>
                <div>
                    <p-floatLabel>
                        <input pInputText type="text" id="thumbnail" [(ngModel)]="product.thumbnail" name="thumbnail"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required />
                        <label for="thumbnail" class="text-gray-700 dark:text-gray-300">Thumbnail Image URL*</label>
                    </p-floatLabel>
                </div>
            </div>
        </div>

        <div class="flex justify-end space-x-4 mt-8">
            <button pButton type="submit" (click)="submitProduct()" label="Create New Product" icon="pi pi-plus"
                class="p-button-success"></button>
            <button pButton type="button" (click)="updateProduct()" label="Update Selected Product" icon="pi pi-save"
                class="p-button-info" [disabled]="!selectedProductId"></button>
        </div>
    </div>
</div> -->