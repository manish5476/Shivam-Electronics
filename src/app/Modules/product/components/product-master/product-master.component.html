<div class="flex flex-wrap md:-m-2 -m-1 w-full"
    style="background: linear-gradient(to bottom, var(--theme-body-gradient-start), var(--theme-body-gradient-end));">

    <div class="w-full p-1 md:p-2">
        <div
            class="card p-6 rounded-xl border border-[var(--theme-border-primary)] shadow-lg transition-all duration-300 hover:shadow-[0_4px_20px_var(--theme-shadow-color)]">

            <h2
                class="text-2xl font-bold text-[var(--theme-text-heading)] mb-1 border-b border-[var(--theme-border-secondary)] pb-0">
                <i class="pi pi-box mr-2"></i>Manage Product
            </h2>

            <!-- Form Start -->
            <form (ngSubmit)="submitProduct()">

                <!-- Basic Information Section -->
                <div class="gradient-card p-5 rounded-lg border border-[var(--theme-border-secondary)] mb-6">
                    <h3
                        class="text-lg font-semibold text-[var(--theme-text-heading)] mb-2 border-b border-[var(--theme-border-secondary)] pb-2">
                        Basic Information
                    </h3>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <!-- Title -->
                        <div class="form-group">
                            <label for="title"
                                class="block text-sm font-medium text-[var(--theme-text-secondary)] mb-1">
                                Title <span class="text-[var(--theme-error-primary)]">*</span>
                            </label>
                            <input id="title" type="text" pInputText class="w-full h-10 px-3 py-2 bg-[var(--theme-bg-tertiary)] text-[var(--theme-text-primary)]
                            border border-[var(--theme-border-secondary)] rounded-md
                            focus:ring-2 focus:ring-[var(--theme-accent-primary)]
                            focus:border-[var(--theme-accent-primary)] sm:text-sm" [(ngModel)]="product.title"
                                name="title" required maxlength="200" />
                        </div>

                        <!-- Description -->
                        <div class="form-group">
                            <label for="description"
                                class="block text-sm font-medium text-[var(--theme-text-secondary)] mb-1">
                                Description <span class="text-[var(--theme-error-primary)]">*</span>
                            </label>
                            <textarea id="description" pInputTextarea rows="3" class="w-full px-3 py-2 bg-[var(--theme-bg-tertiary)] text-[var(--theme-text-primary)]
                               border border-[var(--theme-border-secondary)] rounded-md
                               focus:ring-2 focus:ring-[var(--theme-accent-primary)]
                               focus:border-[var(--theme-accent-primary)] sm:text-sm resize-none"
                                [(ngModel)]="product.description" name="description" required
                                maxlength="500"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Identification & Categorization Section -->
                <div class="gradient-card p-5 rounded-lg border border-[var(--theme-border-secondary)] mb-6">
                    <h3
                        class="text-lg font-semibold text-[var(--theme-text-heading)] mb-2 border-b border-[var(--theme-border-secondary)] pb-2">
                        Identification & Categorization
                    </h3>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Category -->
                        <div class="form-group">
                            <label for="category"
                                class="block text-sm font-medium text-[var(--theme-text-secondary)] mb-1">
                                Category <span class="text-[var(--theme-error-primary)]">*</span>
                            </label>
                            <input id="category" type="text" pInputText class="w-full h-10 px-3 py-2 bg-[var(--theme-bg-tertiary)] text-[var(--theme-text-primary)]
                            border border-[var(--theme-border-secondary)] rounded-md
                            focus:ring-2 focus:ring-[var(--theme-accent-primary)]
                            focus:border-[var(--theme-accent-primary)] sm:text-sm" [(ngModel)]="product.category"
                                name="category" required />
                        </div>

                        <!-- Brand -->
                        <div class="form-group">
                            <label for="brand"
                                class="block text-sm font-medium text-[var(--theme-text-secondary)] mb-1">
                                Brand <span class="text-[var(--theme-error-primary)]">*</span>
                            </label>
                            <input id="brand" type="text" pInputText class="w-full h-10 px-3 py-2 bg-[var(--theme-bg-tertiary)] text-[var(--theme-text-primary)]
                            border border-[var(--theme-border-secondary)] rounded-md
                            focus:ring-2 focus:ring-[var(--theme-accent-primary)]
                            focus:border-[var(--theme-accent-primary)] sm:text-sm" [(ngModel)]="product.brand"
                                name="brand" required />
                        </div>

                        <!-- SKU -->
                        <div class="form-group">
                            <label for="sku" class="block text-sm font-medium text-[var(--theme-text-secondary)] mb-1">
                                SKU <span class="text-[var(--theme-error-primary)]">*</span>
                            </label>
                            <input id="sku" type="text" pInputText class="w-full h-10 px-3 py-2 bg-[var(--theme-bg-tertiary)] text-[var(--theme-text-primary)]
                            border border-[var(--theme-border-secondary)] rounded-md
                            focus:ring-2 focus:ring-[var(--theme-accent-primary)]
                            focus:border-[var(--theme-accent-primary)] sm:text-sm" [(ngModel)]="product.sku" name="sku"
                                required />
                        </div>
                    </div>
                </div>

                <!-- Pricing Section -->
                <div class="gradient-card p-5 rounded-lg border border-[var(--theme-border-secondary)] mb-6">
                    <h3
                        class="text-lg font-semibold text-[var(--theme-text-heading)] mb-2 border-b border-[var(--theme-border-secondary)] pb-2">
                        Pricing
                    </h3>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <!-- Base Rate -->
                        <div class="form-group">
                            <label for="rate" class="block text-sm font-medium text-[var(--theme-text-secondary)] mb-1">
                                Base Rate* (Pre‑GST)
                            </label>
                            <input id="rate" type="number" pInputText (change)="calculatePrice()" class="w-full h-10 px-3 py-2 bg-[var(--theme-bg-tertiary)] text-[var(--theme-text-primary)]
                            border border-[var(--theme-border-secondary)] rounded-md
                            focus:ring-2 focus:ring-[var(--theme-accent-primary)]
                            focus:border-[var(--theme-accent-primary)] sm:text-sm" [(ngModel)]="product.rate"
                                name="rate" required min="0" />
                        </div>

                        <!-- GST Rate -->
                        <div class="form-group">
                            <label for="gstRate"
                                class="block text-sm font-medium text-[var(--theme-text-secondary)] mb-1">
                                GST Rate (%)*
                            </label>
                            <input id="gstRate" type="number" pInputText (change)="calculatePrice()" class="w-full h-10 px-3 py-2 bg-[var(--theme-bg-tertiary)] text-[var(--theme-text-primary)]
                            border border-[var(--theme-border-secondary)] rounded-md
                            focus:ring-2 focus:ring-[var(--theme-accent-primary)]
                            focus:border-[var(--theme-accent-primary)] sm:text-sm" [(ngModel)]="product.gstRate"
                                name="gstRate" required min="0" max="100" />
                        </div>

                        <!-- Post‑GST Price -->
                        <div class="form-group">
                            <label for="price"
                                class="block text-sm font-medium text-[var(--theme-text-secondary)] mb-1">
                                Price (Post‑GST)
                            </label>
                            <input id="price" type="number" pInputText class="w-full h-10 px-3 py-2 bg-[var(--theme-bg-tertiary)] text-[var(--theme-text-primary)]
                            border border-[var(--theme-border-secondary)] rounded-md
                            focus:ring-2 focus:ring-[var(--theme-accent-primary)]
                            focus:border-[var(--theme-accent-primary)] sm:text-sm" [(ngModel)]="product.price"
                                name="price" min="0" readonly />
                            <small class="text-xs text-[var(--theme-text-secondary)]">Auto-calculated on save if rate or
                                GST changes.</small>
                        </div>

                        <!-- Discount -->
                        <div class="form-group">
                            <label for="discountPercentage"
                                class="block text-sm font-medium text-[var(--theme-text-secondary)] mb-1">
                                Discount (%)
                            </label>
                            <input id="discountPercentage" type="number" pInputText class="w-full h-10 px-3 py-2 bg-[var(--theme-bg-tertiary)] text-[var(--theme-text-primary)]
                            border border-[var(--theme-border-secondary)] rounded-md
                            focus:ring-2 focus:ring-[var(--theme-accent-primary)]
                            focus:border-[var(--theme-accent-primary)] sm:text-sm"
                                [(ngModel)]="product.discountPercentage" name="discountPercentage" min="0" max="100" />
                        </div>
                    </div>

                    <!-- Final Price Display -->
                    <div *ngIf="product.price != null && product.discountPercentage != null" class="mt-4">
                        <p class="text-[var(--theme-text-primary)] text-sm">
                            Final Price (after discount):
                            <strong class="text-lg">
                                {{ (product.price || 0) - ((product.price || 0) * (product.discountPercentage || 0) /
                                100) | currency:'USD':'symbol':'1.2-2' }}
                            </strong>
                        </p>
                        <small class="text-xs text-[var(--theme-text-secondary)]">
                            Backend calculates finalPrice based on its logic.
                        </small>
                    </div>
                </div>

                <!-- Inventory & Media Section -->
                <div class="gradient-card p-5 rounded-lg border border-[var(--theme-border-secondary)] mb-6">
                    <h3
                        class="text-lg font-semibold text-[var(--theme-text-heading)] mb-2 border-b border-[var(--theme-border-secondary)] pb-2">
                        Inventory & Media
                    </h3>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <!-- Stock Quantity -->
                        <div class="form-group">
                            <label for="stock"
                                class="block text-sm font-medium text-[var(--theme-text-secondary)] mb-1">
                                Stock Quantity*
                            </label>
                            <input id="stock" type="number" pInputText class="w-full h-10 px-3 py-2 bg-[var(--theme-bg-tertiary)] text-[var(--theme-text-primary)]
                            border border-[var(--theme-border-secondary)] rounded-md
                            focus:ring-2 focus:ring-[var(--theme-accent-primary)]
                            focus:border-[var(--theme-accent-primary)] sm:text-sm" [(ngModel)]="product.stock"
                                name="stock" required min="0" />
                        </div>

                        <!-- Availability Status -->
                        <div class="form-group">
                            <label for="availabilityStatus"
                                class="block text-sm font-medium text-[var(--theme-text-secondary)] mb-1">
                                Availability Status*
                            </label>
                            <p-select id="availabilityStatus" [options]="availabilityOptions" class="w-full h-10 px-3 py-2 bg-[var(--theme-bg-tertiary)] text-[var(--theme-text-primary)]
                               border border-[var(--theme-border-secondary)] rounded-md focus:ring-2 focus:ring-[var(--theme-accent-primary)]
                               focus:border-[var(--theme-accent-primary)] sm:text-sm"
                                [(ngModel)]="product.availabilityStatus" name="availabilityStatus" optionLabel="label"
                                optionValue="value" required>
                            </p-select>
                        </div>

                        <!-- Tags -->
                        <div class="form-group">
                            <label for="tags" class="block text-sm font-medium text-[var(--theme-text-secondary)] mb-1">
                                Tags (comma‑separated)
                            </label>
                            <input id="tags" type="text" pInputText class="w-full h-10 px-3 py-2 bg-[var(--theme-bg-tertiary)] text-[var(--theme-text-primary)]
                            border border-[var(--theme-border-secondary)] rounded-md
                            focus:ring-2 focus:ring-[var(--theme-accent-primary)]
                            focus:border-[var(--theme-accent-primary)] sm:text-sm" [(ngModel)]="product.tags"
                                name="tags" />
                        </div>

                        <!-- Thumbnail URL -->
                        <div class="form-group">
                            <label for="thumbnail"
                                class="block text-sm font-medium text-[var(--theme-text-secondary)] mb-1">
                                Thumbnail Image URL*
                            </label>
                            <input id="thumbnail" type="text" pInputText class="w-full h-10 px-3 py-2 bg-[var(--theme-bg-tertiary)] text-[var(--theme-text-primary)]
                            border border-[var(--theme-border-secondary)] rounded-md
                            focus:ring-2 focus:ring-[var(--theme-accent-primary)]
                            focus:border-[var(--theme-accent-primary)] sm:text-sm" [(ngModel)]="product.thumbnail"
                                name="thumbnail" required />
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="mt-6 flex justify-end gap-4">
                    <button pButton type="button" label="Cancel" icon="pi pi-times"
                        class="p-button-text text-[var(--theme-text-secondary)] hover:bg-[var(--theme-border-secondary)]/20">
                    </button>

                    <button pButton type="submit"
                        label="{{ selectedProductId ? 'Update Product' : 'Create New Product' }}" icon="pi pi-check"
                        [disabled]="!product.title || !product.category || !product.brand || !product.sku" class="p-button bg-[var(--theme-button-bg-primary)] text-[var(--theme-button-text-primary-btn)]
                             hover:bg-[var(--theme-button-hover-bg-primary)] rounded-md">
                    </button>
                </div>

            </form>
            <!-- Form End -->
            <p-toast></p-toast>
        </div>
    </div>
</div>

<!-- <div class="bg-white text-gray-900 w-full mx-auto p-2 shadow-md rounded-lg font-roboto">
    <div class="p-0px flex justify-center mb-1 p-0 items-center">
        <p-select styleClass="gradient-border" [options]="productsForDropdown" [(ngModel)]="selectedProductId"
            optionLabel="title" optionValue="_id" placeholder="Select a Product to Edit" [showClear]="true"
            (onChange)="fetchProductDetails()" class="w-full md:w-1/2">
        </p-select>
        <button pButton type="button" (click)="fetchProductDetails()"
            [disabled]="!selectedProductId">Search/Load</button>
        <button pButton type="button" label="New Product" (click)="resetForm()" class="p-button-outlined"></button>
    </div>

    <div class="container mx-auto p-4">
        <h1
            class="bg-gradient-to-r from-pink-500 to-violet-500 bg-clip-text text-4xl md:text-5xl font-extrabold text-transparent mb-1 text-center">
            Product Management
        </h1>

        <div
            class="bg-[var(--theme-bg-primary)]  border-2 border-sky-900 dark:border-sky-700 p-4 rounded-lg shadow-lg mb-1">
            <h2 class="text-xl font-semibold mb-1 text-gray-900 dark:text-gray-100">Basic Information</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <p-floatLabel>
                        <input pInputText type="text" id="title" [(ngModel)]="product.title" name="title"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required maxlength="200" />
                        <label for="title" class="text-gray-700 dark:text-gray-300">Title*</label>
                    </p-floatLabel>
                </div>
                <div>
                    <p-floatLabel>
                        <textarea id="description" name="description" pInputTextarea autoResize="true" rows="3"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required maxlength="500" [(ngModel)]="product.description"></textarea>
                        <label for="description" class="text-gray-700 dark:text-gray-300">Description*</label>
                    </p-floatLabel>
                </div>
            </div>
        </div>

        <div
            class="bg-[var(--theme-bg-primary)]  border-2 border-sky-900 dark:border-sky-700 p-4 rounded-lg shadow-lg mb-1">
            <h2 class="text-xl font-semibold mb-1 text-gray-900 dark:text-gray-100">Identification & Categorization</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <p-floatLabel>
                        <input pInputText id="category" [(ngModel)]="product.category" name="category"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required />
                        <label for="category" class="text-gray-700 dark:text-gray-300">Category*</label>
                    </p-floatLabel>
                </div>
                <div>
                    <p-floatLabel>
                        <input pInputText id="brand" [(ngModel)]="product.brand" name="brand"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required />
                        <label for="brand" class="text-gray-700 dark:text-gray-300">Brand*</label>
                    </p-floatLabel>
                </div>
                <div>
                    <p-floatLabel>
                        <input pInputText type="text" id="sku" [(ngModel)]="product.sku" name="sku"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required />
                        <label for="sku" class="text-gray-700 dark:text-gray-300">SKU*</label>
                    </p-floatLabel>
                </div>
            </div>
        </div>

        <div
            class="bg-[var(--theme-bg-primary)]  border-2 border-sky-900 dark:border-sky-700 p-4 rounded-lg shadow-lg mb-1">
            <h2 class="text-xl font-semibold mb-1 text-gray-900 dark:text-gray-100">Pricing</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div>
                    <p-floatLabel>
                        <input pInputText type="number" id="rate" [(ngModel)]="product.rate" name="rate"
                            (change)="calculatePrice()"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required min="0" />
                        <label for="rate" class="text-gray-700 dark:text-gray-300">Base Rate* (Pre-GST)</label>
                    </p-floatLabel>
                </div>
                <div>
                    <p-floatLabel>
                        <input pInputText type="number" id="gstRate" [(ngModel)]="product.gstRate" name="gstRate"
                            (change)="calculatePrice()"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required min="0" max="100" />
                        <label for="gstRate" class="text-gray-700 dark:text-gray-300">GST Rate (%)*</label>
                    </p-floatLabel>
                </div>
                <div>
                    <p-floatLabel>
                        <input pInputText type="number" id="price" [(ngModel)]="product.price" name="price"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            min="0" /> <label for="price" class="text-gray-700 dark:text-gray-300">Price
                            (Post-GST)</label>
                    </p-floatLabel>
                    <small class="text-xs text-gray-500 dark:text-gray-400">Auto-calculated on save if rate/GST
                        changes.</small>
                </div>
                <div>
                    <p-floatLabel>
                        <input pInputText type="number" id="discountPercentage" [(ngModel)]="product.discountPercentage"
                            name="discountPercentage"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            min="0" max="100" />
                        <label for="discountPercentage" class="text-gray-700 dark:text-gray-300">Discount (%)</label>
                    </p-floatLabel>
                </div>
            </div>
            <div *ngIf="product.price && product.discountPercentage" class="mt-4">
                <p class="text-gray-700 dark:text-gray-300">
                    Final Price (after discount):
                    <strong class="text-lg">{{ (product.price || 0) - (((product.price || 0) *
                        (product.discountPercentage || 0)) / 100) | currency:'USD':'symbol':'1.2-2' }}</strong>
                </p>
                <small class="text-xs text-gray-500 dark:text-gray-400">Backend calculates finalPrice based on its
                    logic.</small>
            </div>
        </div>

        <div
            class="bg-[var(--theme-bg-primary)]  border-2 border-sky-900 dark:border-sky-700 p-4 rounded-lg shadow-lg mb-1">
            <h2 class="text-xl font-semibold mb-1 text-gray-900 dark:text-gray-100">Inventory & Media</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div>
                    <p-floatLabel>
                        <input pInputText type="number" id="stock" [(ngModel)]="product.stock" name="stock"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required min="0" />
                        <label for="stock" class="text-gray-700 dark:text-gray-300">Stock Quantity*</label>
                    </p-floatLabel>
                </div>
                <div>
                    <p-floatLabel>
                        <p-dropdown id="availabilityStatus" [options]="availabilityOptions" name="availabilityStatus"
                            [(ngModel)]="product.availabilityStatus" optionLabel="label" optionValue="value"
                            styleClass="w-full"
                            inputStyleClass="p-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 border-gray-300 dark:border-gray-600"
                            panelStyleClass="dark:bg-gray-700" required>
                        </p-dropdown>
                        <label for="stock" class="text-gray-700 dark:text-gray-300">Availability
                            Status*</label>
                    </p-floatLabel>
                </div>
                <div>
                    <p-floatLabel>
                        <input pInputText type="text" id="tags" [(ngModel)]="product.tags" name="tags"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700" />
                        <label for="tags" class="text-gray-700 dark:text-gray-300">Tags (comma-separated)</label>
                    </p-floatLabel>
                </div>
                <div>
                    <p-floatLabel>
                        <input pInputText type="text" id="thumbnail" [(ngModel)]="product.thumbnail" name="thumbnail"
                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700"
                            required />
                        <label for="thumbnail" class="text-gray-700 dark:text-gray-300">Thumbnail Image URL*</label>
                    </p-floatLabel>
                </div>
            </div>
        </div>

        <div class="flex justify-end space-x-4 mt-8">
            <button pButton type="submit" (click)="submitProduct()" label="Create New Product" icon="pi pi-plus"
                class="p-button-success"></button>
            <button pButton type="button" (click)="updateProduct()" label="Update Selected Product" icon="pi pi-save"
                class="p-button-info" [disabled]="!selectedProductId"></button>
        </div>
    </div>
</div> -->