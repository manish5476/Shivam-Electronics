<div class="product-form-container">
  <div class="main-card-v2">
    <div class="form-header">
      <h2 class="form-title">
        <i class="pi pi-box"></i> Manage Product
      </h2>

      <!-- Product Image Upload + Preview -->
      <div class="product-image-wrapper">
        <!-- If product has an image -->
        <p-avatar *ngIf="product.thumbnail; else productPlaceholder" [image]="this.product.thumbnail" shape="circle"
          styleClass="product-avatar-large">
        </p-avatar>

        <!-- Placeholder if no image -->
        <ng-template #productPlaceholder>
          <p-avatar label="P" shape="circle" styleClass="product-avatar-large"></p-avatar>
        </ng-template>

        <!-- Upload Button -->
        <button pButton pRipple type="button" icon="pi pi-camera"
          class="p-button-rounded p-button-sm avatar-edit-button" (click)="productFileUploader.choose()"
          pTooltip="Change Product Image" tooltipPosition="top">
        </button>

        <!-- File Upload -->
        <p-fileUpload #productFileUploader name="productImage" [hidden]="true" [customUpload]="true"
          (onSelect)="handleProductFileUpload($event)" accept="image/png,image/jpeg" [maxFileSize]="2000000"
          [multiple]="false" [showUploadButton]="false" [showCancelButton]="false">
        </p-fileUpload>
      </div>
      <!-- End Product Image Upload -->

      <!-- Product Controls -->
      <div class="form-controls">
       <p-select appendTo="body"  [options]="productsForDropdown" [(ngModel)]="selectedProductId" optionLabel="title" optionValue="_id"
          placeholder="Select a Product to Edit" [showClear]="true" (onChange)="fetchProductDetails()"
          styleClass="themed-select product-selector">
        </p-select>

        <button pButton type="button" icon="pi pi-search" (click)="fetchProductDetails()"
          [disabled]="!selectedProductId" pTooltip="Load Product" tooltipPosition="bottom">
        </button>

        <button pButton type="button" label="New" icon="pi pi-plus" (click)="resetForm()" class="p-button-outlined">
        </button>
      </div>
    </div>

    <form (ngSubmit)="submitProduct()">
      <div class="form-section-card">
        <h3 class="section-header"><i class="pi pi-info-circle"></i> Basic Information</h3>
        <div class="responsive-grid">
          <div class="form-group">
            <label for="title">Product Title <span class="required">*</span></label>
            <input id="title" type="text" pInputText class="themed-input" [(ngModel)]="product.title" name="title"
              required maxlength="200" placeholder="Enter product title..." />
          </div>
          <div class="form-group">
            <label for="description">Product Description <span class="required">*</span></label>
            <textarea id="description" pInputTextarea rows="4" class="themed-input" [(ngModel)]="product.description"
              name="description" required maxlength="500" placeholder="Describe your product in detail..."></textarea>
          </div>
        </div>
      </div>

      <div class="form-section-card">
        <h3 class="section-header"><i class="pi pi-tags"></i> Identification & Categorization</h3>
        <div class="responsive-grid">
          <div class="form-group">
            <label for="category">Category <span class="required">*</span></label>
            <input id="category" type="text" pInputText class="themed-input" [(ngModel)]="product.category"
              name="category" required placeholder="e.g., Electronics, Clothing..." />
          </div>
          <div class="form-group">
            <label for="brand">Brand <span class="required">*</span></label>
            <input id="brand" type="text" pInputText class="themed-input" [(ngModel)]="product.brand" name="brand"
              required placeholder="Brand name..." />
          </div>
          <div class="form-group">
            <label for="sku">SKU <span class="required">*</span></label>
            <input id="sku" type="text" pInputText class="themed-input" [(ngModel)]="product.sku" name="sku" required
              placeholder="Unique product code..." />
          </div>
        </div>
      </div>

      <div class="form-section-card">
        <h3 class="section-header"><i class="pi pi-dollar"></i> Pricing Configuration</h3>
        <div class="responsive-grid">
          <div class="form-group">
            <label for="rate">Base Rate (Pre-GST) <span class="required">*</span></label>
            <input id="rate" type="number" pInputText (change)="calculatePrice()" class="themed-input"
              [(ngModel)]="product.rate" name="rate" required min="0" placeholder="0.00" />
          </div>
          <div class="form-group">
            <label for="gstRate">GST Rate (%) <span class="required">*</span></label>
            <input id="gstRate" type="number" pInputText (change)="calculatePrice()" class="themed-input"
              [(ngModel)]="product.gstRate" name="gstRate" required min="0" max="100" placeholder="18" />
          </div>
          <div class="form-group">
            <label for="price">Price (Post-GST)</label>
            <input id="price" type="number" pInputText class="themed-input" [(ngModel)]="product.price" name="price"
              min="0" readonly placeholder="Auto-calculated" />
            <small class="form-hint">Auto-calculated when rate or GST changes.</small>
          </div>
          <div class="form-group">
            <label for="discountPercentage">Discount (%)</label>
            <input id="discountPercentage" type="number" pInputText class="themed-input"
              [(ngModel)]="product.discountPercentage" name="discountPercentage" min="0" max="100" placeholder="0" />
          </div>
        </div>
        <div *ngIf="product.price != null" class="price-display">
          <span>Final Price (After Discount)</span>
          <strong class="final-price-value">
            {{ (product.price || 0) - ((product.price || 0) * (product.discountPercentage || 0) / 100) |
            currency:'INR':'symbol':'1.2-2' }}
          </strong>
        </div>
      </div>

      <div class="form-section-card">
        <h3 class="section-header"><i class="pi pi-warehouse"></i> Inventory & Media</h3>
        <div class="responsive-grid">
          <div class="form-group">
            <label for="stock">Stock Quantity <span class="required">*</span></label>
            <input id="stock" type="number" pInputText class="themed-input" [(ngModel)]="product.stock" name="stock"
              required min="0" placeholder="Available quantity..." />
          </div>
          <div class="form-group">
            <label for="availabilityStatus">Availability Status <span class="required">*</span></label>
           <p-select appendTo="body"  id="availabilityStatus" [options]="availabilityOptions" styleClass="themed-select"
              [(ngModel)]="product.availabilityStatus" name="availabilityStatus" optionLabel="label" optionValue="value"
              required placeholder="Select availability status"></p-select>
          </div>
          <div class="form-group">
            <label for="tags">Tags (comma-separated)</label>
            <input id="tags" type="text" pInputText class="themed-input" [(ngModel)]="product.tags" name="tags"
              placeholder="tag1, tag2, tag3..." />
          </div>
          <div class="form-group">
            <label for="thumbnail">Thumbnail Image URL <span class="required">*</span></label>
            <input id="thumbnail" type="text" pInputText class="themed-input" [(ngModel)]="product.thumbnail"
              name="thumbnail" required placeholder="https://example.com/image.jpg" />
          </div>
        </div>
      </div>
      <div class="form-actions">
        <button pButton type="button" label="Cancel" icon="pi pi-times" class="p-button-outlined"></button>
        <button pButton type="submit" [label]="selectedProductId ? 'Update Product' : 'Create New Product'"
          [icon]="selectedProductId ? 'pi pi-refresh' : 'pi pi-plus'"
          [disabled]="!product.title || !product.category || !product.brand || !product.sku"></button>
      </div>
    </form>

    <p-toast></p-toast>
  </div>
</div>

<!-- <div class="product-form-container">
  <div class="main-card-v2">
    <div class="form-header">
      <h2 class="form-title">
        <i class="pi pi-box"></i> Manage Product
      </h2>

      Product Image Upload + Preview
      <div class="product-image-wrapper">
        If product has an image
        <p-avatar *ngIf="product.thumbnail; else productPlaceholder" [image]="this.product.thumbnail" shape="circle"
          styleClass="product-avatar-large">
        </p-avatar>

        Placeholder if no image
        <ng-template #productPlaceholder>
          <p-avatar label="P" shape="circle" styleClass="product-avatar-large"></p-avatar>
        </ng-template>

        Upload Button
        <button pButton pRipple type="button" icon="pi pi-camera"
          class="p-button-rounded p-button-sm avatar-edit-button" (click)="productFileUploader.choose()"
          pTooltip="Change Product Image" tooltipPosition="top">
        </button>

        File Upload
        <p-fileUpload #productFileUploader name="productImage" [hidden]="true" [customUpload]="true"
          (onSelect)="handleProductFileUpload($event)" accept="image/png,image/jpeg" [maxFileSize]="2000000"
          [multiple]="false" [showUploadButton]="false" [showCancelButton]="false">
        </p-fileUpload>
      </div>
      End Product Image Upload

      Product Controls
      <div class="form-controls">
       <p-select appendTo="body"  [options]="productsForDropdown" [(ngModel)]="selectedProductId" optionLabel="title" optionValue="_id"
          placeholder="Select a Product to Edit" [showClear]="true" (onChange)="fetchProductDetails()"
          styleClass="themed-select product-selector">
        </p-select>

        <button pButton type="button" icon="pi pi-search" (click)="fetchProductDetails()"
          [disabled]="!selectedProductId" pTooltip="Load Product" tooltipPosition="bottom">
        </button>

        <button pButton type="button" label="New" icon="pi pi-plus" (click)="resetForm()" class="p-button-outlined">
        </button>
      </div>
    </div>

    <form (ngSubmit)="submitProduct()">
      <div class="form-section-card">
        <h3 class="section-header"><i class="pi pi-info-circle"></i> Basic Information</h3>
        <div class="responsive-grid">
          <div class="form-group">
            <label for="title">Product Title <span class="required">*</span></label>
            <input id="title" type="text" pInputText class="themed-input" [(ngModel)]="product.title" name="title"
              required maxlength="200" placeholder="Enter product title..." />
          </div>
          <div class="form-group">
            <label for="description">Product Description <span class="required">*</span></label>
            <textarea id="description" pInputTextarea rows="4" class="themed-input" [(ngModel)]="product.description"
              name="description" required maxlength="500" placeholder="Describe your product in detail..."></textarea>
          </div>
        </div>
      </div>

      <div class="form-section-card">
        <h3 class="section-header"><i class="pi pi-tags"></i> Identification & Categorization</h3>
        <div class="responsive-grid">
          <div class="form-group">
            <label for="category">Category <span class="required">*</span></label>
            <input id="category" type="text" pInputText class="themed-input" [(ngModel)]="product.category"
              name="category" required placeholder="e.g., Electronics, Clothing..." />
          </div>
          <div class="form-group">
            <label for="brand">Brand <span class="required">*</span></label>
            <input id="brand" type="text" pInputText class="themed-input" [(ngModel)]="product.brand" name="brand"
              required placeholder="Brand name..." />
          </div>
          <div class="form-group">
            <label for="sku">SKU <span class="required">*</span></label>
            <input id="sku" type="text" pInputText class="themed-input" [(ngModel)]="product.sku" name="sku" required
              placeholder="Unique product code..." />
          </div>
        </div>
      </div>

      <div class="form-section-card">
        <h3 class="section-header"><i class="pi pi-dollar"></i> Pricing Configuration</h3>
        <div class="responsive-grid">
          <div class="form-group">
            <label for="rate">Base Rate (Pre-GST) <span class="required">*</span></label>
            <input id="rate" type="number" pInputText (change)="calculatePrice()" class="themed-input"
              [(ngModel)]="product.rate" name="rate" required min="0" placeholder="0.00" />
          </div>
          <div class="form-group">
            <label for="gstRate">GST Rate (%) <span class="required">*</span></label>
            <input id="gstRate" type="number" pInputText (change)="calculatePrice()" class="themed-input"
              [(ngModel)]="product.gstRate" name="gstRate" required min="0" max="100" placeholder="18" />
          </div>
          <div class="form-group">
            <label for="price">Price (Post-GST)</label>
            <input id="price" type="number" pInputText class="themed-input" [(ngModel)]="product.price" name="price"
              min="0" readonly placeholder="Auto-calculated" />
            <small class="form-hint">Auto-calculated when rate or GST changes.</small>
          </div>
          <div class="form-group">
            <label for="discountPercentage">Discount (%)</label>
            <input id="discountPercentage" type="number" pInputText class="themed-input"
              [(ngModel)]="product.discountPercentage" name="discountPercentage" min="0" max="100" placeholder="0" />
          </div>
        </div>
        <div *ngIf="product.price != null" class="price-display">
          <span>Final Price (After Discount)</span>
          <strong class="final-price-value">
            {{ (product.price || 0) - ((product.price || 0) * (product.discountPercentage || 0) / 100) |
            currency:'INR':'symbol':'1.2-2' }}
          </strong>
        </div>
      </div>

      <div class="form-section-card">
        <h3 class="section-header"><i class="pi pi-warehouse"></i> Inventory & Media</h3>
        <div class="responsive-grid">
          <div class="form-group">
            <label for="stock">Stock Quantity <span class="required">*</span></label>
            <input id="stock" type="number" pInputText class="themed-input" [(ngModel)]="product.stock" name="stock"
              required min="0" placeholder="Available quantity..." />
          </div>
          <div class="form-group">
            <label for="availabilityStatus">Availability Status <span class="required">*</span></label>
           <p-select appendTo="body"  id="availabilityStatus" [options]="availabilityOptions" styleClass="themed-select"
              [(ngModel)]="product.availabilityStatus" name="availabilityStatus" optionLabel="label" optionValue="value"
              required placeholder="Select availability status"></p-select>
          </div>
          <div class="form-group">
            <label for="tags">Tags (comma-separated)</label>
            <input id="tags" type="text" pInputText class="themed-input" [(ngModel)]="product.tags" name="tags"
              placeholder="tag1, tag2, tag3..." />
          </div>
          <div class="form-group">
            <label for="thumbnail">Thumbnail Image URL <span class="required">*</span></label>
            <input id="thumbnail" type="text" pInputText class="themed-input" [(ngModel)]="product.thumbnail"
              name="thumbnail" required placeholder="https://example.com/image.jpg" />
          </div>
        </div>
      </div>
      <div class="form-actions">
        <button pButton type="button" label="Cancel" icon="pi pi-times" class="p-button-outlined"></button>
        <button pButton type="submit" [label]="selectedProductId ? 'Update Product' : 'Create New Product'"
          [icon]="selectedProductId ? 'pi pi-refresh' : 'pi pi-plus'"
          [disabled]="!product.title || !product.category || !product.brand || !product.sku"></button>
      </div>
    </form>

    <p-toast></p-toast>
  </div>
</div> -->