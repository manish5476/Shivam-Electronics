<!-- Main container with themed background, text color, rounded corners, and shadow -->
<div class="bg-[var(--theme-bg-secondary)] text-[var(--theme-text-primary)] rounded-lg shadow-md p-4">
  <!-- Toolbar uses themed colors for background, border, and text -->
  <p-toolbar styleClass="bg-[var(--theme-bg-secondary)] mb-2 p-2 rounded-lg border border-[var(--theme-border-primary)]">
    <ng-template pTemplate="start">
      <p-iconfield class="mr-2">
        <p-inputicon styleClass="pi pi-search text-[var(--theme-text-secondary)]" />
        <input
          pInputText
          type="text"
          (input)="filterSearch($event)"
          placeholder="Search..."
          class="bg-[var(--theme-bg-tertiary)] text-[var(--theme-text-primary)] border border-[var(--theme-border-primary)] rounded-md p-1.5 text-xs w-48 focus:outline-none focus:ring-2 focus:ring-[var(--theme-accent-primary)]"
        />
      </p-iconfield>
      <p-button
        label="New"
        icon="pi pi-plus"
        styleClass="mr-2 bg-[var(--theme-brand-primary)] text-[var(--theme-text-inverted)] hover:bg-[var(--theme-brand-primary-hover)] rounded-md px-3 py-1.5 text-xs transition-colors duration-200"
        (onClick)="openNew()"
      />
      <p-button
        severity="danger"
        label="Delete"
        icon="pi pi-trash"
        styleClass="bg-transparent border border-[var(--theme-error-primary)] text-[var(--theme-error-primary)] hover:bg-[var(--theme-error-primary)] hover:text-white rounded-md px-3 py-1.5 text-xs transition-colors duration-200"
        (onClick)="deleteSelectedProducts()"
        [disabled]="!selectedProducts || !selectedProducts.length"
      />
    </ng-template>

    <ng-template pTemplate="end">
      <p-fileUpload
        mode="basic"
        accept="image/*"
        [maxFileSize]="1000000"
        label="Import"
        chooseLabel="Import"
        auto
        customUpload
        styleClass="mr-2 inline-block bg-[var(--theme-bg-tertiary)] text-[var(--theme-text-primary)] hover:bg-[var(--theme-hover-bg)] rounded-md px-3 py-1.5 text-xs transition-colors duration-200"
        [chooseButtonProps]="{ severity: 'secondary' }"
      />
      <p-button
        label="Export"
        icon="pi pi-upload"
        styleClass="bg-[var(--theme-bg-tertiary)] text-[var(--theme-text-primary)] hover:bg-[var(--theme-hover-bg)] rounded-md px-3 py-1.5 text-xs transition-colors duration-200"
        (onClick)="exportCSV()"
      />
    </ng-template>
  </p-toolbar>

  <div
    class="bg-[var(--theme-bg-secondary)] text-[var(--theme-text-primary)] rounded-lg shadow-md flex flex-col overflow-hidden"
    [style]="{ height: 'calc(100vh - 172px)' }"
  >
  <!-- [paginator]="true" -->
    <p-table
      #dt
      [value]="products"
      [rows]="30"
      [columns]="cols"
      [globalFilterFields]="['title', 'country.name', 'representative.name', 'status']"
      [tableStyle]="{ 'min-width': '75rem' }"
      [(selection)]="selectedProducts"
      [rowHover]="true"
      dataKey="id"
      [scrollable]="true"
      scrollHeight="flex"
      styleClass="bg-[var(--theme-bg-secondary)] flex-1"
    >
      <ng-template pTemplate="header">
        <!-- Themed header styling with a strong background color and rounded top corners -->
        <tr class="bg-[var(--theme-bg-main)] text-[var(--theme-text-inverted)] text-xs font-semibold overflow-hidden">
          <th style="width: 3rem; padding: 0.5rem" class="rounded-tl-lg">
            <p-tableHeaderCheckbox />
          </th>
          <th style="min-width: 16rem; padding: 0.5rem">SKU</th>
          <th pSortableColumn="title" style="min-width: 16rem; padding: 0.5rem">
            Name
            <p-sortIcon field="title" />
          </th>
          <th pSortableColumn="price" style="min-width: 8rem; padding: 0.5rem">
            Price
            <p-sortIcon field="price" />
          </th>
          <th pSortableColumn="category" style="min-width: 10rem; padding: 0.5rem">
            Category
            <p-sortIcon field="category" />
          </th>
          <th pSortableColumn="ratingAverage" style="min-width: 12rem; padding: 0.5rem">
            Rating
            <p-sortIcon field="ratingAverage" />
          </th>
          <th pSortableColumn="availabilityStatus" style="min-width: 12rem; padding: 0.5rem">
            Status
            <p-sortIcon field="availabilityStatus" />
          </th>
          <th style="min-width: 12rem; padding: 0.5rem" class="rounded-tr-lg"></th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-product>
        <tr
          class="hover:bg-[var(--theme-hover-bg)] text-[var(--theme-text-primary)] text-xs"
          style="height: 40px;"
        >
          <td style="width: 3rem; padding: 0.5rem">
            <p-tableCheckbox [value]="product" />
          </td>
          <td style="min-width: 16rem; padding: 0.5rem">{{ product.sku }}</td>
          <td style="min-width: 16rem; padding: 0.5rem">{{ product.title }}</td>
          <td style="padding: 0.5rem">{{ product.price | currency: 'INR' }}</td>
          <td style="padding: 0.5rem">{{ product.category }}</td>
          <td style="padding: 0.5rem">
            <p-rating [(ngModel)]="product.ratingAverage" [readonly]="true"></p-rating>
          </td>
          <td style="padding: 0.5rem">
            <p-tag [value]="product.availabilityStatus" [severity]="getSeverity(product.availabilityStatus)" />
          </td>
          <td style="padding: 0.5rem">
            <p-button
              icon="pi pi-pencil"
              styleClass="mr-2 bg-[var(--theme-brand-primary)] text-[var(--theme-text-inverted)] hover:bg-[var(--theme-brand-primary-hover)] rounded-full w-7 h-7 flex items-center justify-center shadow-md hover:shadow-lg transition-all duration-200"
              [rounded]="true"
              [outlined]="true"
              (click)="editProduct(product)"
            />
            <p-button
              icon="pi pi-trash"
              styleClass="bg-transparent border border-[var(--theme-error-primary)] text-[var(--theme-error-primary)] hover:bg-[var(--theme-error-primary)] hover:text-[var(--theme-text-inverted)] rounded-full w-7 h-7 flex items-center justify-center shadow-md hover:shadow-lg transition-all duration-200"
              [rounded]="true"
              [outlined]="true"
              (click)="deleteProduct(product)"
            />
          </td>
        </tr>
      </ng-template>
    </p-table>

    <p-dialog
      [(visible)]="productDialog"
      [style]="{ width: '32rem' }"
      header="Product Details"
      [modal]="true"
      styleClass="rounded-lg shadow-lg"
    >
      <ng-template pTemplate="content">
        <app-product-master [redirectedData]="redirectedProduct"></app-product-master>
      </ng-template>
    </p-dialog>

    <p-confirmDialog
      [style]="{ width: '450px' }"
      styleClass="rounded-lg shadow-lg"
    />
  </div>
</div>
