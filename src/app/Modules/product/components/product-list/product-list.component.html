<div class="bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 rounded-lg shadow-md p-4">
    <p-toolbar styleClass="bg-white dark:bg-gray-800 mb-2 p-2 rounded-lg border border-gray-200 dark:border-gray-700">
        <ng-template pTemplate="start">
            <p-iconfield class="mr-2">
                <p-inputicon styleClass="pi pi-search text-gray-500 dark:text-gray-400" />
                <input pInputText type="text" (input)="filterSearch($event)" placeholder="Search..."
                    class="bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600 rounded-md p-1.5 text-xs w-48 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400" />
            </p-iconfield>
            <p-button label="New" icon="pi pi-plus"
                styleClass="mr-2 bg-blue-600 text-white hover:bg-blue-700 rounded-md px-3 py-1.5 text-xs transition-colors duration-200"
                (onClick)="openNew()" />
            <p-button severity="danger" label="Delete" icon="pi pi-trash"
                styleClass="bg-transparent border border-red-500 text-red-500 hover:bg-red-500 hover:text-white rounded-md px-3 py-1.5 text-xs transition-colors duration-200"
                (onClick)="deleteSelectedProducts()" [disabled]="!selectedProducts || !selectedProducts.length" />
        </ng-template>
        <ng-template pTemplate="end">
            <p-fileUpload mode="basic" accept="image/*" [maxFileSize]="1000000" label="Import" chooseLabel="Import" auto
                customUpload
                styleClass="mr-2 inline-block bg-gray-200 dark:bg-gray-600 text-gray-900 dark:text-gray-100 hover:bg-gray-300 dark:hover:bg-gray-500 rounded-md px-3 py-1.5 text-xs transition-colors duration-200"
                [chooseButtonProps]="{ severity: 'secondary' }" />
            <p-button label="Export" icon="pi pi-upload"
                styleClass="bg-gray-200 dark:bg-gray-600 text-gray-900 dark:text-gray-100 hover:bg-gray-300 dark:hover:bg-gray-500 rounded-md px-3 py-1.5 text-xs transition-colors duration-200"
                (onClick)="exportCSV()" />
        </ng-template>
    </p-toolbar>
    <div class="bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 rounded-lg shadow-md flex flex-col"
         [style]="{'height': 'calc(100vh - 172px)'}">
        <p-table #dt [value]="products" [rows]="30" [columns]="cols" [paginator]="true" 
            [globalFilterFields]="['title', 'country.name', 'representative.name', 'status']"
            [tableStyle]="{'min-width': '75rem'}" [(selection)]="selectedProducts" [rowHover]="true" dataKey="id"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
            [showCurrentPageReport]="true" [scrollable]="true" scrollHeight="flex"
            styleClass="bg-white dark:bg-gray-800 rounded-lg flex-1">
            <ng-template pTemplate="header">
                <tr class="bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 text-xs font-medium">
                    <th style="width: 3rem; padding: 0.5rem">
                        <p-tableHeaderCheckbox />
                    </th>
                    <th style="min-width: 16rem; padding: 0.5rem">SKU</th>
                    <th pSortableColumn="title" style="min-width: 16rem; padding: 0.5rem">
                        Name
                        <p-sortIcon field="title" />
                    </th>
                    <th pSortableColumn="price" style="min-width: 8rem; padding: 0.5rem">
                        Price
                        <p-sortIcon field="price" />
                    </th>
                    <th pSortableColumn="category" style="min-width: 10rem; padding: 0.5rem">
                        Category
                        <p-sortIcon field="category" />
                    </th>
                    <th pSortableColumn="ratingAverage" style="min-width: 12rem; padding: 0.5rem">
                        Rating
                        <p-sortIcon field="ratingAverage" />
                    </th>
                    <th pSortableColumn="availabilityStatus" style="min-width: 12rem; padding: 0.5rem">
                        Status
                        <p-sortIcon field="availabilityStatus" />
                    </th>
                    <th style="min-width: 12rem; padding: 0.5rem"></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-product>
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-900 dark:text-gray-100 text-xs"
                    style="height: 40px;">
                    <td style="width: 3rem; padding: 0.5rem">
                        <p-tableCheckbox [value]="product" />
                    </td>
                    <td style="min-width: 16rem; padding: 0.5rem">{{ product.sku }}</td>
                    <td style="min-width: 16rem; padding: 0.5rem">{{ product.title }}</td>
                    <td style="padding: 0.5rem">{{ product.price | currency: 'INR' }}</td>
                    <td style="padding: 0.5rem">{{ product.category }}</td>
                    <td style="padding: 0.5rem">
                        <p-rating [(ngModel)]="product.ratingAverage" [readonly]="true" />
                    </td>
                    <td style="padding: 0.5rem">
                        <p-tag [value]="product.availabilityStatus"
                            [severity]="getSeverity(product.availabilityStatus)" />
                    </td>
                    <td style="padding: 0.5rem">
                        <p-button icon="pi pi-pencil"
                            styleClass="mr-2 bg-blue-500 text-white hover:bg-blue-600 rounded-full w-7 h-7 flex items-center justify-center shadow-md hover:shadow-lg transition-all duration-200"
                            [rounded]="true" [outlined]="true" (click)="editProduct(product)" />
                        <p-button icon="pi pi-trash"
                            styleClass="bg-transparent border border-red-500 text-red-500 hover:bg-red-500 hover:text-white rounded-full w-7 h-7 flex items-center justify-center shadow-md hover:shadow-lg transition-all duration-200"
                            [rounded]="true" [outlined]="true" (click)="deleteProduct(product)" />
                    </td>
                </tr>
            </ng-template>
            <!-- <ng-template pTemplate="paginator">
                <div class="sticky bottom-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 p-2">
                    <p-paginator [rows]="30" [totalRecords]="products?.length || 0"
                        [showCurrentPageReport]="true"
                        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                        styleClass="bg-transparent text-gray-700 dark:text-gray-200 text-xs">
                    </p-paginator>
                </div>
            </ng-template> -->
        </p-table>
        <p-dialog [(visible)]="productDialog" [style]="{ width: '32rem' }" header="Product Details" [modal]="true"
            styleClass="bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 rounded-lg shadow-lg">
            <ng-template pTemplate="content">
                <app-product-master [redirectedData]="redirectedProduct"></app-product-master>
            </ng-template>
            <ng-template pTemplate="footer">
            </ng-template>
        </p-dialog>
        <p-confirmDialog [style]="{ width: '450px' }"
            styleClass="bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 rounded-lg shadow-lg" />
    </div>