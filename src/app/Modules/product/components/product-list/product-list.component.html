<div class="bg-[var(--theme-bg-secondary)] text-[var(--theme-text-primary)] rounded-lg shadow-md ">

  <!-- Toolbar -->
  <p-toolbar styleClass="toolbar">
    <ng-template pTemplate="start">
      <p-iconfield class="mr-2">
        <p-inputicon styleClass="pi pi-search text-[var(--theme-text-secondary)]" />
        <input pInputText type="text" (input)="filterSearch($event)" placeholder="Search..." class="toolbar-search" />
      </p-iconfield>

      <p-button label="New" icon="pi pi-plus" styleClass="btn-primary mr-2" (onClick)="openNew()" />
      <p-button label="Delete" icon="pi pi-trash" styleClass="btn-danger" (onClick)="deleteSelectedProducts()"
        [disabled]="!selectedProducts || !selectedProducts.length" />
    </ng-template>

    <ng-template pTemplate="end">
      <p-fileUpload mode="basic" accept="image/*" [maxFileSize]="1000000" label="Import" chooseLabel="Import" auto
        customUpload styleClass="btn-secondary mr-2 inline-block" [chooseButtonProps]="{ severity: 'secondary' }" />
      <p-button label="Export" icon="pi pi-upload" styleClass="btn-secondary" (onClick)="exportCSV()" />
    </ng-template>
  </p-toolbar>

  <!-- Data Table Container -->
  <div class="card flex mt-2 flex-col overflow-hidden" [style]="{ height: 'calc(100vh - 178px)' }">
    <p-table #dt [value]="products" [rows]="30" [columns]="cols"
      [globalFilterFields]="['title', 'country.name', 'representative.name', 'status']"
      [tableStyle]="{ 'min-width': '75rem' }" [(selection)]="selectedProducts" [rowHover]="true" dataKey="id"
      [scrollable]="true" scrollHeight="flex" styleClass="flex-1">
      <!-- Header -->
      <ng-template pTemplate="header">
        <tr class="bg-[var(--theme-bg-main)] text-[var(--theme-text-inverted)] text-xs font-semibold">
          <th style="width: 3rem; padding: 0.5rem" class="rounded-tl-lg">
            <p-tableHeaderCheckbox />
          </th>
          <th style="min-width: 16rem; padding: 0.5rem">SKU</th>
          <th pSortableColumn="title" style="min-width: 16rem; padding: 0.5rem">
            Name <p-sortIcon field="title" />
          </th>
          <th pSortableColumn="price" style="min-width: 8rem; padding: 0.5rem">
            Price <p-sortIcon field="price" />
          </th>
          <th pSortableColumn="category" style="min-width: 10rem; padding: 0.5rem">
            Category <p-sortIcon field="category" />
          </th>
          <th pSortableColumn="ratingAverage" style="min-width: 12rem; padding: 0.5rem">
            Rating <p-sortIcon field="ratingAverage" />
          </th>
          <th pSortableColumn="availabilityStatus" style="min-width: 12rem; padding: 0.5rem">
            Status <p-sortIcon field="availabilityStatus" />
          </th>
          <th style="min-width: 12rem; padding: 0.5rem" class="rounded-tr-lg"></th>
        </tr>
      </ng-template>

      <!-- Body -->
      <ng-template pTemplate="body" let-product>
        <tr class="hover:bg-[var(--theme-hover-bg)] text-[var(--theme-text-primary)] text-xs" style="height: 40px;">
          <td style="width: 3rem; padding: 0.5rem">
            <p-tableCheckbox [value]="product" />
          </td>
          <td style="min-width: 16rem; padding: 0.5rem">{{ product.sku }}</td>
          <td style="min-width: 16rem; padding: 0.5rem">{{ product.title }}</td>
          <td style="padding: 0.5rem">{{ product.price | currency: 'INR' }}</td>
          <td style="padding: 0.5rem">{{ product.category }}</td>
          <td style="padding: 0.5rem">
            <p-rating [(ngModel)]="product.ratingAverage" [readonly]="true"></p-rating>
          </td>
          <td style="padding: 0.5rem">
            <p-tag [value]="product.availabilityStatus" [severity]="getSeverity(product.availabilityStatus)" />
          </td>
          <td style="padding: 0.5rem">
            <p-button icon="pi pi-pencil" styleClass="btn-primary icon-btn mr-2" (click)="editProduct(product)" />
            <p-button icon="pi pi-trash" styleClass="btn-danger icon-btn" (click)="deleteProduct(product)" />
          </td>
        </tr>
      </ng-template>
    </p-table>

    <!-- Dialogs -->
    <p-dialog [(visible)]="productDialog" [style]="{ width: '95rem' }" header="Product Details" [modal]="true"
      styleClass="rounded-lg shadow-lg">
      <ng-template pTemplate="content">
        <app-product-master [redirectedData]="redirectedProduct"></app-product-master>
      </ng-template>
    </p-dialog>

    <p-confirmDialog [style]="{ width: '450px' }" styleClass="rounded-lg shadow-lg" />
  </div>
</div>
